<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>trace — Follow Program Flow &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="https://feeds.feedburner.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="https://feeds.feedburner.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@pymotw" />
    <meta name="twitter:title" content="trace — Follow Program Flow" />
    <meta name="twitter:image" content="https://pymotw.com/3/_static/logo-large.png" />

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../dev_tools.html"><i class="fa fa-arrow-circle-up"></i> Developer Tools</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-trace">
<span id="trace-follow-program-flow"></span><h1>trace — Follow Program Flow<a class="headerlink" href="#module-trace" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Monitor which statements and functions are executed as a
program runs to produce coverage and call-graph information.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">trace</span></code> module is useful for understanding the way a program
runs.  It watches the statements executed, produces coverage reports,
and helps investigate the relationships between functions that call
each other.</p>
<div class="section" id="example-program">
<h2>Example Program<a class="headerlink" href="#example-program" title="Permalink to this headline">¶</a></h2>
<p>This program will be used in the examples in the rest of the section.
It imports another module called <code class="docutils literal notranslate"><span class="pre">recurse</span></code> and then runs a function
from it.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">trace_example/main.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">recurse</span> <span class="k">import</span> <span class="n">recurse</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This is the main program.&#39;</span><span class="p">)</span>
    <span class="n">recurse</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">recurse()</span></code> function invokes itself until the level argument
reaches <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">trace_example/recurse.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recurse(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">level</span><span class="p">:</span>
        <span class="n">recurse</span><span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">not_called</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This function is never called.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tracing-execution">
<h2>Tracing Execution<a class="headerlink" href="#tracing-execution" title="Permalink to this headline">¶</a></h2>
<p>It is easy use <code class="docutils literal notranslate"><span class="pre">trace</span></code> directly from the command line.  The
statements being executed as the program runs are printed when the
<code class="docutils literal notranslate"><span class="pre">--trace</span></code> option is given. This example also ignores the location of
the Python standard library to avoid tracing into <a class="reference internal" href="../importlib/index.html#module-importlib" title="importlib: Interface to module import mechanism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> and
other modules that might be more interesting in another example, but
that clutter up the output in this simple example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m trace --ignore-dir=.../lib/python3.7 \
--trace trace_example/main.py

 --- modulename: main, funcname: &lt;module&gt;
main.py(7): &quot;&quot;&quot;
main.py(10): from recurse import recurse
 --- modulename: recurse, funcname: &lt;module&gt;
recurse.py(7): &quot;&quot;&quot;
recurse.py(11): def recurse(level):
recurse.py(17): def not_called():
main.py(13): def main():
main.py(18): if __name__ == &#39;__main__&#39;:
main.py(19):     main()
 --- modulename: main, funcname: main
main.py(14):     print(&#39;This is the main program.&#39;)
This is the main program.
main.py(15):     recurse(2)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(2)
recurse.py(13):     if level:
recurse.py(14):         recurse(level - 1)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(1)
recurse.py(13):     if level:
recurse.py(14):         recurse(level - 1)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(0)
recurse.py(13):     if level:
</pre></div>
</div>
<p>The first part of the output shows the setup operations performed by
<code class="docutils literal notranslate"><span class="pre">trace</span></code>.  The rest of the output shows the entry into each
function, including the module where the function is located, and then
the lines of the source file as they are executed.  <code class="docutils literal notranslate"><span class="pre">recurse()</span></code>
is entered three times, as expected based on the way it is called in
<code class="docutils literal notranslate"><span class="pre">main()</span></code>.</p>
</div>
<div class="section" id="code-coverage">
<h2>Code Coverage<a class="headerlink" href="#code-coverage" title="Permalink to this headline">¶</a></h2>
<p>Running <code class="docutils literal notranslate"><span class="pre">trace</span></code> from the command line with the <code class="docutils literal notranslate"><span class="pre">--count</span></code>
option will produce code coverage report information, detailing which
lines are run and which are skipped.  Since a complex program is
usually made up of multiple files, a separate coverage report is
produced for each.  By default the coverage report files are written
to the same directory as the module, named after the module but with a
<code class="docutils literal notranslate"><span class="pre">.cover</span></code> extension instead of <code class="docutils literal notranslate"><span class="pre">.py</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m trace --count trace_example/main.py

This is the main program.
recurse(2)
recurse(1)
recurse(0)
</pre></div>
</div>
<p>Two output files are produced, <code class="docutils literal notranslate"><span class="pre">trace_example/main.cover</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">trace_example/main.cover</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>    <span class="mi">1</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">recurse</span> <span class="k">import</span> <span class="n">recurse</span>
       
       
    <span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="mi">1</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This is the main program.&#39;</span><span class="p">)</span>
    <span class="mi">1</span><span class="p">:</span>     <span class="n">recurse</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
       
       
    <span class="mi">1</span><span class="p">:</span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="mi">1</span><span class="p">:</span>     <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">trace_example/recurse.cover</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">trace_example/recurse.cover</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>       
    <span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
    <span class="mi">3</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recurse(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
    <span class="mi">3</span><span class="p">:</span>     <span class="k">if</span> <span class="n">level</span><span class="p">:</span>
    <span class="mi">2</span><span class="p">:</span>         <span class="n">recurse</span><span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
       
       
    <span class="mi">1</span><span class="p">:</span> <span class="k">def</span> <span class="nf">not_called</span><span class="p">():</span>
           <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This function is never called.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the line <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">recurse(level):</span></code> has a count of <code class="docutils literal notranslate"><span class="pre">1</span></code>,
that does not mean the function was only run once.  It means the
function <em>definition</em> was only executed once. The same applies to
<code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">not_called():</span></code>, because the function definition is
evaluated even though the function itself is never called.</p>
</div>
<p>It is also possible to run the program several times, perhaps with
different options, to save the coverage data and produce a combined
report. The first time <code class="docutils literal notranslate"><span class="pre">trace</span></code> is run with an output file, it
reports an error when it tries to load any existing data to merge with
the new results before creating the file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m trace --coverdir coverdir1 --count \
--file coverdir1/coverage_report.dat trace_example/main.py

This is the main program.
recurse(2)
recurse(1)
recurse(0)
Skipping counts file &#39;coverdir1/coverage_report.dat&#39;: [Errno 2]
No such file or directory: &#39;coverdir1/coverage_report.dat&#39;

$ python3 -m trace --coverdir coverdir1 --count \
--file coverdir1/coverage_report.dat trace_example/main.py

This is the main program.
recurse(2)
recurse(1)
recurse(0)

$ python3 -m trace --coverdir coverdir1 --count \
--file coverdir1/coverage_report.dat trace_example/main.py

This is the main program.
recurse(2)
recurse(1)
recurse(0)

$ ls coverdir1

coverage_report.dat
main.cover
recurse.cover
</pre></div>
</div>
<p>To produce reports once the coverage information is recorded to the
<code class="docutils literal notranslate"><span class="pre">.cover</span></code> files, use the <code class="docutils literal notranslate"><span class="pre">--report</span></code> option.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m trace --coverdir coverdir1 --report --summary \
--missing --file coverdir1/coverage_report.dat \
trace_example/main.py

lines   cov%   module   (path)
    7   100%   trace_example.main   (trace_example/main.py)
    7    85%   trace_example.recurse
(trace_example/recurse.py)
</pre></div>
</div>
<p>Since the program ran three times, the coverage report shows values
three times higher than the first report.  The <code class="docutils literal notranslate"><span class="pre">--summary</span></code>
option adds the percent covered information to the output.  The
<code class="docutils literal notranslate"><span class="pre">recurse</span></code> module is only 87% covered.  Looking at the cover file for
<code class="docutils literal notranslate"><span class="pre">recurse</span></code> shows that the body of <code class="docutils literal notranslate"><span class="pre">not_called</span></code> is indeed never
run, indicated by the <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;&gt;&gt;&gt;</span></code> prefix.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">coverdir1/trace_example.recurse.cover</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>       
    <span class="mi">3</span><span class="p">:</span> <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
    <span class="mi">9</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recurse(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
    <span class="mi">9</span><span class="p">:</span>     <span class="k">if</span> <span class="n">level</span><span class="p">:</span>
    <span class="mi">6</span><span class="p">:</span>         <span class="n">recurse</span><span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
       
       
    <span class="mi">3</span><span class="p">:</span> <span class="k">def</span> <span class="nf">not_called</span><span class="p">():</span>
<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This function is never called.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="calling-relationships">
<h2>Calling Relationships<a class="headerlink" href="#calling-relationships" title="Permalink to this headline">¶</a></h2>
<p>In addition to coverage information, <code class="docutils literal notranslate"><span class="pre">trace</span></code> will collect and
report on the relationships between functions that call each other.</p>
<p>For a simple list of the functions called, use <code class="docutils literal notranslate"><span class="pre">--listfuncs</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m trace --listfuncs trace_example/main.py | \
grep -v importlib

This is the main program.
recurse(2)
recurse(1)
recurse(0)

functions called:
filename: trace_example/main.py, modulename: main, funcname:
&lt;module&gt;
filename: trace_example/main.py, modulename: main, funcname:
main
filename: trace_example/recurse.py, modulename: recurse,
funcname: &lt;module&gt;
filename: trace_example/recurse.py, modulename: recurse,
funcname: recurse
</pre></div>
</div>
<p>For more details about who is doing the calling, use <code class="docutils literal notranslate"><span class="pre">--trackcalls</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 -m trace --listfuncs --trackcalls \
trace_example/main.py | grep -v importlib

This is the main program.
recurse(2)
recurse(1)
recurse(0)

calling relationships:

*** .../lib/python3.7/trace.py ***
  --&gt; trace_example/main.py
    trace.Trace.runctx -&gt; main.&lt;module&gt;

  --&gt; trace_example/recurse.py


*** trace_example/main.py ***
    main.&lt;module&gt; -&gt; main.main
  --&gt; trace_example/recurse.py
    main.main -&gt; recurse.recurse

*** trace_example/recurse.py ***
    recurse.recurse -&gt; recurse.recurse
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Neither <code class="docutils literal notranslate"><span class="pre">--listfuncs</span></code> nor <code class="docutils literal notranslate"><span class="pre">--trackcalls</span></code> honors the
<code class="docutils literal notranslate"><span class="pre">--ignore-dirs</span></code> or <code class="docutils literal notranslate"><span class="pre">--ignore-mods</span></code> arguments, so part of the
output from this example is stripped using <code class="docutils literal notranslate"><span class="pre">grep</span></code> instead.</p>
</div>
</div>
<div class="section" id="programming-interface">
<h2>Programming Interface<a class="headerlink" href="#programming-interface" title="Permalink to this headline">¶</a></h2>
<p>For more control over the <code class="docutils literal notranslate"><span class="pre">trace</span></code> interface, it can be
invoked from within a program using a <code class="docutils literal notranslate"><span class="pre">Trace</span></code> object.
<code class="docutils literal notranslate"><span class="pre">Trace</span></code> supports setting up fixtures and other dependencies
before running a single function or executing a Python command to be
traced.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">trace_run.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">trace</span>
<span class="kn">from</span> <span class="nn">trace_example.recurse</span> <span class="k">import</span> <span class="n">recurse</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tracer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;recurse(2)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Since the example only traces into the <code class="docutils literal notranslate"><span class="pre">recurse()</span></code> function, no
information from <code class="docutils literal notranslate"><span class="pre">main.py</span></code> is included in the output.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 trace_run.py

 --- modulename: trace_run, funcname: &lt;module&gt;
&lt;string&gt;(1):  --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(2)
recurse.py(13):     if level:
recurse.py(14):         recurse(level - 1)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(1)
recurse.py(13):     if level:
recurse.py(14):         recurse(level - 1)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(0)
recurse.py(13):     if level:
</pre></div>
</div>
<p>That same output can be produced with the <code class="docutils literal notranslate"><span class="pre">runfunc()</span></code> method,
too.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">trace_runfunc.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">trace</span>
<span class="kn">from</span> <span class="nn">trace_example.recurse</span> <span class="k">import</span> <span class="n">recurse</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tracer</span><span class="o">.</span><span class="n">runfunc</span><span class="p">(</span><span class="n">recurse</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">runfunc()</span></code> accepts arbitrary positional and keyword arguments,
which are passed to the function when it is called by the tracer.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 trace_runfunc.py

 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(2)
recurse.py(13):     if level:
recurse.py(14):         recurse(level - 1)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(1)
recurse.py(13):     if level:
recurse.py(14):         recurse(level - 1)
 --- modulename: recurse, funcname: recurse
recurse.py(12):     print(&#39;recurse({})&#39;.format(level))
recurse(0)
recurse.py(13):     if level:
</pre></div>
</div>
</div>
<div class="section" id="saving-result-data">
<h2>Saving Result Data<a class="headerlink" href="#saving-result-data" title="Permalink to this headline">¶</a></h2>
<p>Counts and coverage information can be recorded as well, just as with
the command line interface.  The data must be saved explicitly, using
the <code class="docutils literal notranslate"><span class="pre">CoverageResults</span></code> instance from the <code class="docutils literal notranslate"><span class="pre">Trace</span></code> object.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">trace_CoverageResults.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">trace</span>
<span class="kn">from</span> <span class="nn">trace_example.recurse</span> <span class="k">import</span> <span class="n">recurse</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tracer</span><span class="o">.</span><span class="n">runfunc</span><span class="p">(</span><span class="n">recurse</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">tracer</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">write_results</span><span class="p">(</span><span class="n">coverdir</span><span class="o">=</span><span class="s1">&#39;coverdir2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This example saves the coverage results to the directory
<code class="docutils literal notranslate"><span class="pre">coverdir2</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 trace_CoverageResults.py

recurse(2)
recurse(1)
recurse(0)

$ find coverdir2

coverdir2
coverdir2/trace_example.recurse.cover
</pre></div>
</div>
<p>The output file contains</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>       <span class="c1">#!/usr/bin/env python</span>
       <span class="c1"># encoding: utf-8</span>
       <span class="c1">#</span>
       <span class="c1"># Copyright (c) 2008 Doug Hellmann All rights reserved.</span>
       <span class="c1">#</span>
       <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&gt;&gt;&gt;&gt;&gt;&gt; &quot;&quot;&quot;</span>
       
       <span class="c1">#end_pymotw_header</span>
       
<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
    <span class="mi">3</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recurse(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
    <span class="mi">3</span><span class="p">:</span>     <span class="k">if</span> <span class="n">level</span><span class="p">:</span>
    <span class="mi">2</span><span class="p">:</span>         <span class="n">recurse</span><span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
       
       
<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">not_called</span><span class="p">():</span>
<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This function is never called.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To save the counts data for generating reports, use the <code class="docutils literal notranslate"><span class="pre">infile</span></code> and
<code class="docutils literal notranslate"><span class="pre">outfile</span></code> arguments to <code class="docutils literal notranslate"><span class="pre">Trace</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">trace_report.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">trace</span>
<span class="kn">from</span> <span class="nn">trace_example.recurse</span> <span class="k">import</span> <span class="n">recurse</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;trace_report.dat&#39;</span><span class="p">)</span>
<span class="n">tracer</span><span class="o">.</span><span class="n">runfunc</span><span class="p">(</span><span class="n">recurse</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">report_tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">infile</span><span class="o">=</span><span class="s1">&#39;trace_report.dat&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">tracer</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">write_results</span><span class="p">(</span><span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coverdir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Pass a filename to <code class="docutils literal notranslate"><span class="pre">infile</span></code> to read previously stored data, and a
filename to <code class="docutils literal notranslate"><span class="pre">outfile</span></code> to write new results after tracing.  If <code class="docutils literal notranslate"><span class="pre">infile</span></code>
and <code class="docutils literal notranslate"><span class="pre">outfile</span></code> are the same, it has the effect of updating the file
with cumulative data.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 trace_report.py

recurse(2)
recurse(1)
recurse(0)
lines   cov%   module   (path)
    7    42%   trace_example.recurse
(.../trace_example/recurse.py)
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p>The constructor for <code class="docutils literal notranslate"><span class="pre">Trace</span></code> takes several optional parameters
to control runtime behavior.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt>
<dd>Boolean.  Turns on line number counting.  Defaults to True.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">countfuncs</span></code></dt>
<dd>Boolean.  Turns on list of functions called during the run.
Defaults to False.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">countcallers</span></code></dt>
<dd>Boolean.  Turns on tracking for callers and callees.  Defaults to
False.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ignoremods</span></code></dt>
<dd>Sequence.  List of modules or packages to ignore when tracking
coverage.  Defaults to an empty tuple.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ignoredirs</span></code></dt>
<dd>Sequence.  List of directories containing modules or packages to be
ignored.  Defaults to an empty tuple.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">infile</span></code></dt>
<dd>Name of the file containing cached count values.  Defaults to None.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">outfile</span></code></dt>
<dd>Name of the file to use for storing cached count files.  Defaults to
None, and data is not stored.</dd>
</dl>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/trace.html">Standard library documentation for trace</a></li>
<li><a class="reference internal" href="../sys/tracing.html#sys-tracing"><span class="std std-ref">Tracing a Program As It Runs</span></a> – The <code class="docutils literal notranslate"><span class="pre">sys</span></code> module includes facilities for
adding a custom tracing function to the interpreter at run-time.</li>
<li><a class="reference external" href="http://nedbatchelder.com/code/modules/coverage.html">coverage.py</a> – Ned
Batchelder’s coverage module.</li>
<li><a class="reference external" href="http://darcs.idyll.org/~t/projects/figleaf/doc/">figleaf</a> –
Titus Brown’s coverage application.</li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../unittest/index.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> unittest — Automated Testing Framework</a>
<a id="next-link" href="../traceback/index.html"
   title="next chapter">traceback — Exceptions and Stack Traces <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#example-program"><i class="fa fa-caret-right"></i>Example Program</a></li>
    
    <li><a href="#tracing-execution"><i class="fa fa-caret-right"></i>Tracing Execution</a></li>
    
    <li><a href="#code-coverage"><i class="fa fa-caret-right"></i>Code Coverage</a></li>
    
    <li><a href="#calling-relationships"><i class="fa fa-caret-right"></i>Calling Relationships</a></li>
    
    <li><a href="#programming-interface"><i class="fa fa-caret-right"></i>Programming Interface</a></li>
    
    <li><a href="#saving-result-data"><i class="fa fa-caret-right"></i>Saving Result Data</a></li>
    
    <li><a href="#options"><i class="fa fa-caret-right"></i>Options</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2018-12-09.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../unittest/index.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>unittest — Automated Testing Framework</a></li>
    <li><a href="../traceback/index.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>traceback — Exceptions and Stack Traces</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,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"/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>