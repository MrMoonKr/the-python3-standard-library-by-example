<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>imaplib — IMAP4 Client Library &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="https://feeds.feedburner.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="https://feeds.feedburner.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@pymotw" />
    <meta name="twitter:title" content="imaplib — IMAP4 Client Library" />
    <meta name="twitter:image" content="https://pymotw.com/3/_static/logo-large.png" />

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../email.html"><i class="fa fa-arrow-circle-up"></i> Email</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-imaplib">
<span id="imaplib-imap4-client-library"></span><h1>imaplib — IMAP4 Client Library<a class="headerlink" href="#module-imaplib" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Client library for IMAP4 communication.</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">imaplib</span></code> implements a client for communicating with Internet
Message Access Protocol (IMAP) version 4 servers.  The IMAP protocol
defines a set of commands sent to the server and the responses
delivered back to the client.  Most of the commands are available as
methods of the <code class="docutils literal notranslate"><span class="pre">IMAP4</span></code> object used to communicate with the
server.</p>
<p>These examples discuss part of the IMAP protocol, but are by no means
complete.  Refer to RFC 3501 for complete details.</p>
<div class="section" id="variations">
<h2>Variations<a class="headerlink" href="#variations" title="Permalink to this headline">¶</a></h2>
<p>There are three client classes for communicating with servers using
various mechanisms.  The first, <code class="docutils literal notranslate"><span class="pre">IMAP4</span></code>, uses clear text
sockets; <code class="docutils literal notranslate"><span class="pre">IMAP4_SSL</span></code> uses encrypted communication over SSL
sockets; and <code class="docutils literal notranslate"><span class="pre">IMAP4_stream</span></code> uses the standard input and
standard output of an external command.  All of the examples here
will use <code class="docutils literal notranslate"><span class="pre">IMAP4_SSL</span></code>, but the APIs for the other classes are
similar.</p>
</div>
<div class="section" id="connecting-to-a-server">
<h2>Connecting to a Server<a class="headerlink" href="#connecting-to-a-server" title="Permalink to this headline">¶</a></h2>
<p>There are two steps for establishing a connection with an IMAP server.
First, set up the socket connection itself.  Second, authenticate as a
user with an account on the server.  The following example code will
read server and user information from a configuration file.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">imaplib_connect.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">open_connection</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Read the config file</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.pymotw&#39;</span><span class="p">)])</span>

    <span class="c1"># Connect to the server</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;hostname&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Connecting to&#39;</span><span class="p">,</span> <span class="n">hostname</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>

    <span class="c1"># Login to our account</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logging in as&#39;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">connection</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">open_connection</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>When run, <code class="docutils literal notranslate"><span class="pre">open_connection()</span></code> reads the configuration
information from a file in the user’s home directory, then opens the
<code class="docutils literal notranslate"><span class="pre">IMAP4_SSL</span></code> connection and authenticates.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_connect.py

Connecting to pymotw.hellfly.net
Logging in as example
&lt;imaplib.IMAP4_SSL object at 0x10421e320&gt;
</pre></div>
</div>
<p>The other examples in this section reuse this module, to avoid
duplicating the code.</p>
<div class="section" id="authentication-failure">
<h3>Authentication Failure<a class="headerlink" href="#authentication-failure" title="Permalink to this headline">¶</a></h3>
<p>If the connection is established but authentication fails, an
exception is raised.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">imaplib_connect_fail.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Read the config file</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.pymotw&#39;</span><span class="p">)])</span>

<span class="c1"># Connect to the server</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;hostname&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Connecting to&#39;</span><span class="p">,</span> <span class="n">hostname</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>

<span class="c1"># Login to our account</span>
<span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;this_is_the_wrong_password&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logging in as&#39;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This example uses the wrong password on purpose to trigger the
exception.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_connect_fail.py

Connecting to pymotw.hellfly.net
Logging in as example
ERROR: b&#39;[AUTHENTICATIONFAILED] Authentication failed.&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-configuration">
<h2>Example Configuration<a class="headerlink" href="#example-configuration" title="Permalink to this headline">¶</a></h2>
<p>The example account has several mailboxes in a hierarchy:</p>
<ul class="simple">
<li>INBOX</li>
<li>Deleted Messages</li>
<li>Archive</li>
<li>Example<ul>
<li>2016</li>
</ul>
</li>
</ul>
<p>There is one unread message in the <code class="docutils literal notranslate"><span class="pre">INBOX</span></code> folder, and one read
message in <code class="docutils literal notranslate"><span class="pre">Example/2016</span></code>.</p>
</div>
<div class="section" id="listing-mailboxes">
<h2>Listing Mailboxes<a class="headerlink" href="#listing-mailboxes" title="Permalink to this headline">¶</a></h2>
<p>To retrieve the mailboxes available for an account, use the
<code class="docutils literal notranslate"><span class="pre">list()</span></code> method.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">imaplib_list.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">imaplib_connect</span> <span class="k">import</span> <span class="n">open_connection</span>

<span class="k">with</span> <span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Response code:&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Response:&#39;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The return value is a <code class="docutils literal notranslate"><span class="pre">tuple</span></code> containing a response code and
the data returned by the server.  The response code is <code class="docutils literal notranslate"><span class="pre">OK</span></code>, unless
there has been an error.  The data for <code class="docutils literal notranslate"><span class="pre">list()</span></code> is a sequence of
strings containing <em>flags</em>, the <em>hierarchy delimiter</em>, and <em>mailbox
name</em> for each mailbox.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_list.py

Response code: OK
Response:
[b&#39;(\\HasChildren) &quot;.&quot; Example&#39;,
 b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;,
 b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;,
 b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;,
 b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;]
</pre></div>
</div>
<p>Each response string can be split into three parts using <a class="reference internal" href="../re/index.html#module-re" title="re: Searching within and changing text using formal patterns."><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> or
<a class="reference internal" href="../csv/index.html#module-csv" title="csv: Read and write comma separated value files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code></a> (see <em>IMAP Backup Script</em> in the references at the end of
this section for an example using <code class="docutils literal notranslate"><span class="pre">csv</span></code>).</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">imaplib_list_parse.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">imaplib_connect</span> <span class="k">import</span> <span class="n">open_connection</span>

<span class="n">list_response_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;\((?P&lt;flags&gt;.*?)\) &quot;(?P&lt;delimiter&gt;.*)&quot; (?P&lt;name&gt;.*)&#39;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">parse_list_response</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">list_response_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mailbox_name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="n">mailbox_name</span> <span class="o">=</span> <span class="n">mailbox_name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mailbox_name</span><span class="p">)</span>


<span class="k">with</span> <span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Response code:&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server response:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mailbox_name</span> <span class="o">=</span> <span class="n">parse_list_response</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parsed response:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mailbox_name</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The server quotes the mailbox name if it includes spaces, but those
quotes need to be stripped out to use the mailbox name in other calls
back to the server later.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_list_parse.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Parsed response: (&#39;\\HasChildren&#39;, &#39;.&#39;, &#39;Example&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.2016&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Archive&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Deleted Messages&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;INBOX&#39;)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">list()</span></code> takes arguments to specify mailboxes in part of the
hierarchy.  For example, to list sub-folders of <code class="docutils literal notranslate"><span class="pre">Example</span></code>, pass
<code class="docutils literal notranslate"><span class="pre">&quot;Example&quot;</span></code> as the <code class="docutils literal notranslate"><span class="pre">directory</span></code> argument.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">imaplib_list_subfolders.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>

<span class="kn">from</span> <span class="nn">imaplib_connect</span> <span class="k">import</span> <span class="n">open_connection</span>

<span class="k">with</span> <span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Response code:&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server response:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The parent and subfolder are returned.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_list_subfolders.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
</pre></div>
</div>
<p>Alternately, to list folders matching a pattern pass the <code class="docutils literal notranslate"><span class="pre">pattern</span></code>
argument.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">imaplib_list_pattern.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>

<span class="kn">from</span> <span class="nn">imaplib_connect</span> <span class="k">import</span> <span class="n">open_connection</span>

<span class="k">with</span> <span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;*Example*&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Response code:&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Server response:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this case, both <code class="docutils literal notranslate"><span class="pre">Example</span></code> and <code class="docutils literal notranslate"><span class="pre">Example.2016</span></code> are included in
the response.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_list_pattern.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
</pre></div>
</div>
</div>
<div class="section" id="mailbox-status">
<h2>Mailbox Status<a class="headerlink" href="#mailbox-status" title="Permalink to this headline">¶</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">status()</span></code> to ask for aggregated information about the
contents.  the table below lists the status
conditions defined by the standard.</p>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-text">IMAP 4 Mailbox Status Conditions</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Condition</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MESSAGES</td>
<td>The number of messages in the mailbox.</td>
</tr>
<tr class="row-odd"><td>RECENT</td>
<td>The number of messages with the <code class="docutils literal notranslate"><span class="pre">\Recent</span></code> flag set.</td>
</tr>
<tr class="row-even"><td>UIDNEXT</td>
<td>The next unique identifier value of the mailbox.</td>
</tr>
<tr class="row-odd"><td>UIDVALIDITY</td>
<td>The unique identifier validity value of the mailbox.</td>
</tr>
<tr class="row-even"><td>UNSEEN</td>
<td>The number of messages which do not have the <code class="docutils literal notranslate"><span class="pre">\Seen</span></code> flag set.</td>
</tr>
</tbody>
</table>
<p>The status conditions must be formatted as a space separated string
enclosed in parentheses, the encoding for a “list” in the IMAP4
specification. The mailbox name is wrapped in <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> in case any of the
names include spaces or other characters that would throw of the
parser.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">imaplib_status.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">imaplib_connect</span> <span class="k">import</span> <span class="n">open_connection</span>
<span class="kn">from</span> <span class="nn">imaplib_list_parse</span> <span class="k">import</span> <span class="n">parse_list_response</span>

<span class="k">with</span> <span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mailbox</span> <span class="o">=</span> <span class="n">parse_list_response</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mailbox:&#39;</span><span class="p">,</span> <span class="n">mailbox</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">status</span><span class="p">(</span>
            <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mailbox</span><span class="p">),</span>
            <span class="s1">&#39;(MESSAGES RECENT UIDNEXT UIDVALIDITY UNSEEN)&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The return value is the usual <code class="docutils literal notranslate"><span class="pre">tuple</span></code> containing a response
code and a list of information from the server.  In this case, the
list contains a single string formatted with the name of the mailbox
in quotes, then the status conditions and values in parentheses.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_status.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Parsed response: (&#39;\\HasChildren&#39;, &#39;.&#39;, &#39;Example&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.2016&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Archive&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Deleted Messages&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;INBOX&#39;)
Mailbox: Example
(&#39;OK&#39;, [b&#39;Example (MESSAGES 0 RECENT 0 UIDNEXT 2 UIDVALIDITY 145
7297771 UNSEEN 0)&#39;])
Mailbox: Example.2016
(&#39;OK&#39;, [b&#39;Example.2016 (MESSAGES 1 RECENT 0 UIDNEXT 3 UIDVALIDIT
Y 1457297772 UNSEEN 0)&#39;])
Mailbox: Archive
(&#39;OK&#39;, [b&#39;Archive (MESSAGES 0 RECENT 0 UIDNEXT 1 UIDVALIDITY 145
7297770 UNSEEN 0)&#39;])
Mailbox: Deleted Messages
(&#39;OK&#39;, [b&#39;&quot;Deleted Messages&quot; (MESSAGES 3 RECENT 0 UIDNEXT 4 UIDV
ALIDITY 1457297773 UNSEEN 0)&#39;])
Mailbox: INBOX
(&#39;OK&#39;, [b&#39;INBOX (MESSAGES 2 RECENT 0 UIDNEXT 6 UIDVALIDITY 14572
97769 UNSEEN 1)&#39;])
</pre></div>
</div>
</div>
<div class="section" id="selecting-a-mailbox">
<h2>Selecting a Mailbox<a class="headerlink" href="#selecting-a-mailbox" title="Permalink to this headline">¶</a></h2>
<p>The basic mode of operation, once the client is authenticated, is to
select a mailbox, then interrogate the server regarding messages in
the mailbox.  The connection is stateful, so after a mailbox is
selected all commands operate on messages in that mailbox until a new
mailbox is selected.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">imaplib_select.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">num_msgs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are </span><span class="si">{}</span><span class="s1"> messages in INBOX&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_msgs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The response data contains the total number of messages in the
mailbox.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_select.py

OK [b&#39;1&#39;]
There are 1 messages in INBOX
</pre></div>
</div>
<p>If an invalid mailbox is specified, the response code is <code class="docutils literal notranslate"><span class="pre">NO</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">imaplib_select_invalid.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Does-Not-Exist&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The data contains an error message describing the problem.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_select_invalid.py

NO [b&quot;Mailbox doesn&#39;t exist: Does-Not-Exist&quot;]
</pre></div>
</div>
</div>
<div class="section" id="searching-for-messages">
<h2>Searching for Messages<a class="headerlink" href="#searching-for-messages" title="Permalink to this headline">¶</a></h2>
<p>After selecting the mailbox, use <code class="docutils literal notranslate"><span class="pre">search()</span></code> to retrieve the IDs
of messages in the mailbox.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">imaplib_search_all.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>
<span class="kn">from</span> <span class="nn">imaplib_list_parse</span> <span class="k">import</span> <span class="n">parse_list_response</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">mbox_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mbox_data</span><span class="p">:</span>
        <span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mbox_name</span> <span class="o">=</span> <span class="n">parse_list_response</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mbox_name</span><span class="p">),</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">typ</span><span class="p">,</span> <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mbox_name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Message IDs are assigned by the server, and are implementation
dependent.  The IMAP4 protocol makes a distinction between sequential
IDs for messages at a given point in time during a transaction and UID
identifiers for messages, but not all servers implement both.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_search_all.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Parsed response: (&#39;\\HasChildren&#39;, &#39;.&#39;, &#39;Example&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.2016&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Archive&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Deleted Messages&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;INBOX&#39;)
Example OK [b&#39;&#39;]
Example.2016 OK [b&#39;1&#39;]
Archive OK [b&#39;&#39;]
Deleted Messages OK [b&#39;&#39;]
INBOX OK [b&#39;1&#39;]
</pre></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">INBOX</span></code> and <code class="docutils literal notranslate"><span class="pre">Example.2016</span></code> each have a different
message with id <code class="docutils literal notranslate"><span class="pre">1</span></code>. The other mailboxes are empty.</p>
</div>
<div class="section" id="search-criteria">
<h2>Search Criteria<a class="headerlink" href="#search-criteria" title="Permalink to this headline">¶</a></h2>
<p>A variety of other search criteria can be used, including looking at
dates for the message, flags, and other headers.  Refer to section
6.4.4. of RFC 3501 for complete details.</p>
<p>To look for messages with <code class="docutils literal notranslate"><span class="pre">'Example</span> <span class="pre">message</span> <span class="pre">2'</span></code> in the subject, the
search criteria should be constructed as:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">SUBJECT</span> <span class="s2">&quot;Example message 2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This example finds all messages with the title “Example message 2” in all
mailboxes:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">imaplib_search_subject.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>
<span class="kn">from</span> <span class="nn">imaplib_list_parse</span> <span class="k">import</span> <span class="n">parse_list_response</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">mbox_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mbox_data</span><span class="p">:</span>
        <span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mbox_name</span> <span class="o">=</span> <span class="n">parse_list_response</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mbox_name</span><span class="p">),</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">typ</span><span class="p">,</span> <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;(SUBJECT &quot;Example message 2&quot;)&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mbox_name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>There is only one such message in the account, and it is in the
<code class="docutils literal notranslate"><span class="pre">INBOX</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_search_subject.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Parsed response: (&#39;\\HasChildren&#39;, &#39;.&#39;, &#39;Example&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.2016&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Archive&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Deleted Messages&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;INBOX&#39;)
Example OK [b&#39;&#39;]
Example.2016 OK [b&#39;&#39;]
Archive OK [b&#39;&#39;]
Deleted Messages OK [b&#39;&#39;]
INBOX OK [b&#39;1&#39;]
</pre></div>
</div>
<p>Search criteria can also be combined.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">imaplib_search_from.py</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>
<span class="kn">from</span> <span class="nn">imaplib_list_parse</span> <span class="k">import</span> <span class="n">parse_list_response</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">mbox_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mbox_data</span><span class="p">:</span>
        <span class="n">flags</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">mbox_name</span> <span class="o">=</span> <span class="n">parse_list_response</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mbox_name</span><span class="p">),</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">typ</span><span class="p">,</span> <span class="n">msg_ids</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;(FROM &quot;Doug&quot; SUBJECT &quot;Example message 2&quot;)&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mbox_name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The criteria are combined with a logical <code class="docutils literal notranslate"><span class="pre">and</span></code> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_search_from.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Parsed response: (&#39;\\HasChildren&#39;, &#39;.&#39;, &#39;Example&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.2016&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Archive&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Deleted Messages&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;INBOX&#39;)
Example OK [b&#39;&#39;]
Example.2016 OK [b&#39;&#39;]
Archive OK [b&#39;&#39;]
Deleted Messages OK [b&#39;&#39;]
INBOX OK [b&#39;1&#39;]
</pre></div>
</div>
</div>
<div class="section" id="fetching-messages">
<h2>Fetching Messages<a class="headerlink" href="#fetching-messages" title="Permalink to this headline">¶</a></h2>
<p>The identifiers returned by <code class="docutils literal notranslate"><span class="pre">search()</span></code> are used to retrieve the
contents, or partial contents, of messages for further processing
using the <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> method.  It takes two arguments, the message
IDs to fetch and the portion(s) of the message to retrieve.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">message_ids</span></code> argument is a comma separated list of ids (e.g.,
<code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;1,2&quot;</span></code>) or ID ranges (e.g., <code class="docutils literal notranslate"><span class="pre">1:2</span></code>).  The <code class="docutils literal notranslate"><span class="pre">message_parts</span></code>
argument is an IMAP list of message segment names.  As with search
criteria for <code class="docutils literal notranslate"><span class="pre">search()</span></code>, the IMAP protocol specifies named
message segments so clients can efficiently retrieve only the parts of
the message they actually need.  For example, to retrieve the headers
of the messages in a mailbox, use <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> with the argument
<code class="docutils literal notranslate"><span class="pre">BODY.PEEK[HEADER]</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Another way to fetch the headers is <code class="docutils literal notranslate"><span class="pre">BODY[HEADERS]</span></code>, but that form
has a side-effect of implicitly marking the message as read, which
is undesirable in many cases.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">imaplib_fetch_raw.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>

<span class="n">imaplib</span><span class="o">.</span><span class="n">Debug</span> <span class="o">=</span> <span class="mi">4</span>
<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;(BODY.PEEK[HEADER] FLAGS)&#39;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The return value of <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> has been partially parsed so it is
somewhat harder to work with than the return value of <code class="docutils literal notranslate"><span class="pre">list()</span></code>.
Turning on debugging shows the complete interaction between the client
and server to understand why this is so.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_fetch_raw.py

  19:40.68 imaplib version 2.58
  19:40.68 new IMAP4 connection, tag=b&#39;IIEN&#39;
  19:40.70 &lt; b&#39;* OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN
-REFERRALS ID ENABLE IDLE AUTH=PLAIN] Dovecot (Ubuntu) ready.&#39;
  19:40.70 &gt; b&#39;IIEN0 CAPABILITY&#39;
  19:40.73 &lt; b&#39;* CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REF
ERRALS ID ENABLE IDLE AUTH=PLAIN&#39;
  19:40.73 &lt; b&#39;IIEN0 OK Pre-login capabilities listed, post-logi
n capabilities have more.&#39;
  19:40.73 CAPABILITIES: (&#39;IMAP4REV1&#39;, &#39;LITERAL+&#39;, &#39;SASL-IR&#39;, &#39;L
OGIN-REFERRALS&#39;, &#39;ID&#39;, &#39;ENABLE&#39;, &#39;IDLE&#39;, &#39;AUTH=PLAIN&#39;)
  19:40.73 &gt; b&#39;IIEN1 LOGIN example &quot;TMFw00fpymotw&quot;&#39;
  19:40.79 &lt; b&#39;* CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REF
ERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD
=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNS
ELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDS
TORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-
STATUS SPECIAL-USE BINARY MOVE&#39;
  19:40.79 &lt; b&#39;IIEN1 OK Logged in&#39;
  19:40.79 &gt; b&#39;IIEN2 EXAMINE INBOX&#39;
  19:40.82 &lt; b&#39;* FLAGS (\\Answered \\Flagged \\Deleted \\Seen \\
Draft)&#39;
  19:40.82 &lt; b&#39;* OK [PERMANENTFLAGS ()] Read-only mailbox.&#39;
  19:40.82 &lt; b&#39;* 2 EXISTS&#39;
  19:40.82 &lt; b&#39;* 0 RECENT&#39;
  19:40.82 &lt; b&#39;* OK [UNSEEN 1] First unseen.&#39;
  19:40.82 &lt; b&#39;* OK [UIDVALIDITY 1457297769] UIDs valid&#39;
  19:40.82 &lt; b&#39;* OK [UIDNEXT 6] Predicted next UID&#39;
  19:40.82 &lt; b&#39;* OK [HIGHESTMODSEQ 20] Highest&#39;
  19:40.82 &lt; b&#39;IIEN2 OK [READ-ONLY] Examine completed (0.000 sec
s).&#39;
  19:40.82 &gt; b&#39;IIEN3 FETCH 1 (BODY.PEEK[HEADER] FLAGS)&#39;
  19:40.86 &lt; b&#39;* 1 FETCH (FLAGS () BODY[HEADER] {3108}&#39;
  19:40.86 read literal size 3108
  19:40.86 &lt; b&#39;)&#39;
  19:40.89 &lt; b&#39;IIEN3 OK Fetch completed.&#39;
  19:40.89 &gt; b&#39;IIEN4 LOGOUT&#39;
  19:40.93 &lt; b&#39;* BYE Logging out&#39;
  19:40.93 BYE response: b&#39;Logging out&#39;
[(b&#39;1 (FLAGS () BODY[HEADER] {3108}&#39;,
  b&#39;Return-Path: &lt;doug@doughellmann.com&gt;\r\nReceived: from compu
te4.internal (&#39;
  b&#39;compute4.nyi.internal [10.202.2.44])\r\n\t by sloti26t01 (Cy
rus 3.0.0-beta1&#39;
  b&#39;-git-fastmail-12410) with LMTPA;\r\n\t Sun, 06 Mar 2016 16:1
6:03 -0500\r&#39;
  b&#39;\nX-Sieve: CMU Sieve 2.4\r\nX-Spam-known-sender: yes, fadd1c
f2-dc3a-4984-a0&#39;
  b&#39;8b-02cef3cf1221=&quot;doug&quot;,\r\n  ea349ad0-9299-47b5-b632-6ff1e39
4cc7d=&quot;both he&#39;
  b&#39;llfly&quot;\r\nX-Spam-score: 0.0\r\nX-Spam-hits: ALL_TRUSTED -1,
BAYES_00 -1.&#39;
  b&#39;9, LANGUAGES unknown, BAYES_USED global,\r\n  SA_VERSION 3.3
.2\r\nX-Spam&#39;
  b&quot;-source: IP=&#39;127.0.0.1&#39;, Host=&#39;unk&#39;, Country=&#39;unk&#39;, FromHead
er=&#39;com&#39;,\r\n &quot;
  b&quot; MailFrom=&#39;com&#39;\r\nX-Spam-charsets: plain=&#39;us-ascii&#39;\r\nX-Re
solved-to: d&quot;
  b&#39;oughellmann@fastmail.fm\r\nX-Delivered-to: doug@doughellmann
.com\r\nX-Ma&#39;
  b&#39;il-from: doug@doughellmann.com\r\nReceived: from mx5 ([10.20
2.2.204])\r&#39;
  b&#39;\n  by compute4.internal (LMTPProxy); Sun, 06 Mar 2016 16:16
:03 -0500\r\nRe&#39;
  b&#39;ceived: from mx5.nyi.internal (localhost [127.0.0.1])\r\n\tb
y mx5.nyi.inter&#39;
  b&#39;nal (Postfix) with ESMTP id 47CBA280DB3\r\n\tfor &lt;doug@dough
ellmann.com&gt;; S&#39;
  b&#39;un,  6 Mar 2016 16:16:03 -0500 (EST)\r\nReceived: from mx5.n
yi.internal (l&#39;
  b&#39;ocalhost [127.0.0.1])\r\n    by mx5.nyi.internal (Authentica
tion Milter) w&#39;
  b&#39;ith ESMTP\r\n    id A717886846E.30BA4280D81;\r\n    Sun, 6 M
ar 2016 16:1&#39;
  b&#39;6:03 -0500\r\nAuthentication-Results: mx5.nyi.internal;\r\n
   dkim=pass&#39;
  b&#39; (1024-bit rsa key) header.d=messagingengine.com header.i=@m
essagingengi&#39;
  b&#39;ne.com header.b=Jrsm+pCo;\r\n    x-local-ip=pass\r\nReceived
: from mailo&#39;
  b&#39;ut.nyi.internal (gateway1.nyi.internal [10.202.2.221])\r\n\t
(using TLSv1.2 &#39;
  b&#39;with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))\r\n\
t(No client cer&#39;
  b&#39;tificate requested)\r\n\tby mx5.nyi.internal (Postfix) with
ESMTPS id 30BA4&#39;
  b&#39;280D81\r\n\tfor &lt;doug@doughellmann.com&gt;; Sun,  6 Mar 2016 16
:16:03 -0500 (E&#39;
  b&#39;ST)\r\nReceived: from compute2.internal (compute2.nyi.intern
al [10.202.2.4&#39;
  b&#39;2])\r\n\tby mailout.nyi.internal (Postfix) with ESMTP id 174
0420D0A\r\n\tf&#39;
  b&#39;or &lt;doug@doughellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -0500
(EST)\r\nRecei&#39;
  b&#39;ved: from frontend2 ([10.202.2.161])\r\n  by compute2.intern
al (MEProxy); &#39;
  b&#39;Sun, 06 Mar 2016 16:16:03 -0500\r\nDKIM-Signature: v=1; a=rs
a-sha1; c=rela&#39;
  b&#39;xed/relaxed; d=\r\n\tmessagingengine.com; h=content-transfer
-encoding:conte&#39;
  b&#39;nt-type\r\n\t:date:from:message-id:mime-version:subject:to:x
-sasl-enc\r\n&#39;
  b&#39;\t:x-sasl-enc; s=smtpout; bh=P98NTsEo015suwJ4gk71knAWLa4=; b
=Jrsm+\r\n\t&#39;
  b&#39;pCovRIoQIRyp8Fl0L6JHOI8sbZy2obx7O28JF2iTlTWmX33Rhlq9403XRklw
N3JA\r\n\t7KSPq&#39;
  b&#39;MTp30Qdx6yIUaADwQqlO+QMuQq/QxBHdjeebmdhgVfjhqxrzTbSMww/ZNhL\
r\n\tYwv/QM/oDH&#39;
  b&#39;bXiLSUlB3Qrg+9wsE/0jU/EOisiU=\r\nX-Sasl-enc: 8ZJ+4ZRE8AGPzdL
RWQFivGymJb8pa&#39;
  b&#39;4G9JGcb7k4xKn+I 1457298962\r\nReceived: from [192.168.1.14]
(75-137-1-34.d&#39;
  b&#39;hcp.nwnn.ga.charter.com [75.137.1.34])\r\n\tby mail.messagin
gengine.com (Po&#39;
  b&#39;stfix) with ESMTPA id C0B366801CD\r\n\tfor &lt;doug@doughellman
n.com&gt;; Sun,  6&#39;
  b&#39; Mar 2016 16:16:02 -0500 (EST)\r\nFrom: Doug Hellmann &lt;doug@
doughellmann.c&#39;
  b&#39;om&gt;\r\nContent-Type: text/plain; charset=us-ascii\r\nContent
-Transfer-En&#39;
  b&#39;coding: 7bit\r\nSubject: PyMOTW Example message 2\r\nMessage
-Id: &lt;00ABCD&#39;
  b&#39;46-DADA-4912-A451-D27165BC3A2F@doughellmann.com&gt;\r\nDate: Su
n, 6 Mar 2016 &#39;
  b&#39;16:16:02 -0500\r\nTo: Doug Hellmann &lt;doug@doughellmann.com&gt;\
r\nMime-Vers&#39;
  b&#39;ion: 1.0 (Mac OS X Mail 9.2 \\(3112\\))\r\nX-Mailer: Apple M
ail (2.3112)&#39;
  b&#39;\r\n\r\n&#39;),
 b&#39;)&#39;]
</pre></div>
</div>
<p>The response from the <code class="docutils literal notranslate"><span class="pre">FETCH</span></code> command starts with the flags, then
indicates that there are 595 bytes of header data.  The client
constructs a tuple with the response for the message, and then closes
the sequence with a single string containing the right parenthesis
(“<code class="docutils literal notranslate"><span class="pre">)</span></code>”) the server sends at the end of the fetch response.  Because of
this formatting, it may be easier to fetch different pieces of
information separately, or to recombine the response and parse it in
the client.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">imaplib_fetch_separately.py</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HEADER:&#39;</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;(BODY.PEEK[HEADER])&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">response_part</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_part</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">response_part</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">BODY TEXT:&#39;</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;(BODY.PEEK[TEXT])&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">response_part</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_part</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">response_part</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">FLAGS:&#39;</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;(FLAGS)&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">response_part</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">response_part</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">imaplib</span><span class="o">.</span><span class="n">ParseFlags</span><span class="p">(</span><span class="n">response_part</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Fetching values separately has the added benefit of making it easy to
use <code class="docutils literal notranslate"><span class="pre">ParseFlags()</span></code> to parse the flags from the response.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_fetch_separately.py

HEADER:
b&#39;Return-Path: &lt;doug@doughellmann.com&gt;\r\nReceived: from compute
4.internal (compute4.nyi.internal [10.202.2.44])\r\n\t by sloti2
6t01 (Cyrus 3.0.0-beta1-git-fastmail-12410) with LMTPA;\r\n\t Su
n, 06 Mar 2016 16:16:03 -0500\r\nX-Sieve: CMU Sieve 2.4\r\nX-Spa
m-known-sender: yes, fadd1cf2-dc3a-4984-a08b-02cef3cf1221=&quot;doug&quot;
,\r\n  ea349ad0-9299-47b5-b632-6ff1e394cc7d=&quot;both hellfly&quot;\r\nX-
Spam-score: 0.0\r\nX-Spam-hits: ALL_TRUSTED -1, BAYES_00 -1.9, L
ANGUAGES unknown, BAYES_USED global,\r\n  SA_VERSION 3.3.2\r\nX-
Spam-source: IP=\&#39;127.0.0.1\&#39;, Host=\&#39;unk\&#39;, Country=\&#39;unk\&#39;, Fr
omHeader=\&#39;com\&#39;,\r\n  MailFrom=\&#39;com\&#39;\r\nX-Spam-charsets: plai
n=\&#39;us-ascii\&#39;\r\nX-Resolved-to: doughellmann@fastmail.fm\r\nX-D
elivered-to: doug@doughellmann.com\r\nX-Mail-from: doug@doughell
mann.com\r\nReceived: from mx5 ([10.202.2.204])\r\n  by compute4
.internal (LMTPProxy); Sun, 06 Mar 2016 16:16:03 -0500\r\nReceiv
ed: from mx5.nyi.internal (localhost [127.0.0.1])\r\n\tby mx5.ny
i.internal (Postfix) with ESMTP id 47CBA280DB3\r\n\tfor &lt;doug@do
ughellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -0500 (EST)\r\nReceiv
ed: from mx5.nyi.internal (localhost [127.0.0.1])\r\n    by mx5.
nyi.internal (Authentication Milter) with ESMTP\r\n    id A71788
6846E.30BA4280D81;\r\n    Sun, 6 Mar 2016 16:16:03 -0500\r\nAuth
entication-Results: mx5.nyi.internal;\r\n    dkim=pass (1024-bit
 rsa key) header.d=messagingengine.com header.i=@messagingengine
.com header.b=Jrsm+pCo;\r\n    x-local-ip=pass\r\nReceived: from
 mailout.nyi.internal (gateway1.nyi.internal [10.202.2.221])\r\n
\t(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/25
6 bits))\r\n\t(No client certificate requested)\r\n\tby mx5.nyi.
internal (Postfix) with ESMTPS id 30BA4280D81\r\n\tfor &lt;doug@dou
ghellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -0500 (EST)\r\nReceive
d: from compute2.internal (compute2.nyi.internal [10.202.2.42])\
r\n\tby mailout.nyi.internal (Postfix) with ESMTP id 1740420D0A\
r\n\tfor &lt;doug@doughellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -050
0 (EST)\r\nReceived: from frontend2 ([10.202.2.161])\r\n  by com
pute2.internal (MEProxy); Sun, 06 Mar 2016 16:16:03 -0500\r\nDKI
M-Signature: v=1; a=rsa-sha1; c=relaxed/relaxed; d=\r\n\tmessagi
ngengine.com; h=content-transfer-encoding:content-type\r\n\t:dat
e:from:message-id:mime-version:subject:to:x-sasl-enc\r\n\t:x-sas
l-enc; s=smtpout; bh=P98NTsEo015suwJ4gk71knAWLa4=; b=Jrsm+\r\n\t
pCovRIoQIRyp8Fl0L6JHOI8sbZy2obx7O28JF2iTlTWmX33Rhlq9403XRklwN3JA
\r\n\t7KSPqMTp30Qdx6yIUaADwQqlO+QMuQq/QxBHdjeebmdhgVfjhqxrzTbSMw
w/ZNhL\r\n\tYwv/QM/oDHbXiLSUlB3Qrg+9wsE/0jU/EOisiU=\r\nX-Sasl-en
c: 8ZJ+4ZRE8AGPzdLRWQFivGymJb8pa4G9JGcb7k4xKn+I 1457298962\r\nRe
ceived: from [192.168.1.14] (75-137-1-34.dhcp.nwnn.ga.charter.co
m [75.137.1.34])\r\n\tby mail.messagingengine.com (Postfix) with
 ESMTPA id C0B366801CD\r\n\tfor &lt;doug@doughellmann.com&gt;; Sun,  6
 Mar 2016 16:16:02 -0500 (EST)\r\nFrom: Doug Hellmann &lt;doug@doug
hellmann.com&gt;\r\nContent-Type: text/plain; charset=us-ascii\r\nC
ontent-Transfer-Encoding: 7bit\r\nSubject: PyMOTW Example messag
e 2\r\nMessage-Id: &lt;00ABCD46-DADA-4912-A451-D27165BC3A2F@doughel
lmann.com&gt;\r\nDate: Sun, 6 Mar 2016 16:16:02 -0500\r\nTo: Doug H
ellmann &lt;doug@doughellmann.com&gt;\r\nMime-Version: 1.0 (Mac OS X M
ail 9.2 \\(3112\\))\r\nX-Mailer: Apple Mail (2.3112)\r\n\r\n&#39;

BODY TEXT:
b&#39;This is the second example message.\r\n&#39;

FLAGS:
b&#39;1 (FLAGS ())&#39;
()
</pre></div>
</div>
</div>
<div class="section" id="whole-messages">
<h2>Whole Messages<a class="headerlink" href="#whole-messages" title="Permalink to this headline">¶</a></h2>
<p>As illustrated earlier, the client can ask the server for individual
parts of the message separately.  It is also possible to retrieve the
entire message as an RFC 822 formatted mail message and parse it
with classes from the <code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code> module.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">imaplib_fetch_rfc822.py</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">email</span>
<span class="kn">import</span> <span class="nn">email.parser</span>

<span class="kn">import</span> <span class="nn">imaplib_connect</span>


<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">typ</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;(RFC822)&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">response_part</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_part</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">email_parser</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">BytesFeedParser</span><span class="p">()</span>
            <span class="n">email_parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">response_part</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">email_parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:^8}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">header</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">msg</span><span class="p">[</span><span class="n">header</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<p>The parser in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code> module make it very easy to access and
manipulate messages.  This example prints just a few of the headers
for each message.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_fetch_rfc822.py

SUBJECT : PyMOTW Example message 2
   TO   : Doug Hellmann &lt;doug@doughellmann.com&gt;
  FROM  : Doug Hellmann &lt;doug@doughellmann.com&gt;
</pre></div>
</div>
</div>
<div class="section" id="uploading-messages">
<h2>Uploading Messages<a class="headerlink" href="#uploading-messages" title="Permalink to this headline">¶</a></h2>
<p>To add a new message to a mailbox, construct a <code class="docutils literal notranslate"><span class="pre">Message</span></code>
instance and pass it to the <code class="docutils literal notranslate"><span class="pre">append()</span></code> method, along with the
timestamp for the message.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">imaplib_append.py</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">email.message</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>

<span class="n">new_message</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">()</span>
<span class="n">new_message</span><span class="o">.</span><span class="n">set_unixfrom</span><span class="p">(</span><span class="s1">&#39;pymotw&#39;</span><span class="p">)</span>
<span class="n">new_message</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;subject goes here&#39;</span>
<span class="n">new_message</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pymotw@example.com&#39;</span>
<span class="n">new_message</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;example@example.com&#39;</span>
<span class="n">new_message</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s1">&#39;This is the body of the message.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">imaplib</span><span class="o">.</span><span class="n">Time2Internaldate</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
             <span class="nb">str</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c1"># Show the headers for all messages in the mailbox</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="n">msg_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">msg_ids</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">typ</span><span class="p">,</span> <span class="n">msg_data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s1">&#39;(BODY.PEEK[HEADER])&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">response_part</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response_part</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">response_part</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">payload</span></code> used in this example is a simple plaintext email body.
<code class="docutils literal notranslate"><span class="pre">Message</span></code> also supports MIME-encoded multi-part messages.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_append.py

Subject: subject goes here
From: pymotw@example.com
To: example@example.com

This is the body of the message.


b&#39;1&#39;:
b&#39;Return-Path: &lt;doug@doughellmann.com&gt;\r\nReceived: from compute
4.internal (compute4.nyi.internal [10.202.2.44])\r\n\t by sloti2
6t01 (Cyrus 3.0.0-beta1-git-fastmail-12410) with LMTPA;\r\n\t Su
n, 06 Mar 2016 16:16:03 -0500\r\nX-Sieve: CMU Sieve 2.4\r\nX-Spa
m-known-sender: yes, fadd1cf2-dc3a-4984-a08b-02cef3cf1221=&quot;doug&quot;
,\r\n  ea349ad0-9299-47b5-b632-6ff1e394cc7d=&quot;both hellfly&quot;\r\nX-
Spam-score: 0.0\r\nX-Spam-hits: ALL_TRUSTED -1, BAYES_00 -1.9, L
ANGUAGES unknown, BAYES_USED global,\r\n  SA_VERSION 3.3.2\r\nX-
Spam-source: IP=\&#39;127.0.0.1\&#39;, Host=\&#39;unk\&#39;, Country=\&#39;unk\&#39;, Fr
omHeader=\&#39;com\&#39;,\r\n  MailFrom=\&#39;com\&#39;\r\nX-Spam-charsets: plai
n=\&#39;us-ascii\&#39;\r\nX-Resolved-to: doughellmann@fastmail.fm\r\nX-D
elivered-to: doug@doughellmann.com\r\nX-Mail-from: doug@doughell
mann.com\r\nReceived: from mx5 ([10.202.2.204])\r\n  by compute4
.internal (LMTPProxy); Sun, 06 Mar 2016 16:16:03 -0500\r\nReceiv
ed: from mx5.nyi.internal (localhost [127.0.0.1])\r\n\tby mx5.ny
i.internal (Postfix) with ESMTP id 47CBA280DB3\r\n\tfor &lt;doug@do
ughellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -0500 (EST)\r\nReceiv
ed: from mx5.nyi.internal (localhost [127.0.0.1])\r\n    by mx5.
nyi.internal (Authentication Milter) with ESMTP\r\n    id A71788
6846E.30BA4280D81;\r\n    Sun, 6 Mar 2016 16:16:03 -0500\r\nAuth
entication-Results: mx5.nyi.internal;\r\n    dkim=pass (1024-bit
 rsa key) header.d=messagingengine.com header.i=@messagingengine
.com header.b=Jrsm+pCo;\r\n    x-local-ip=pass\r\nReceived: from
 mailout.nyi.internal (gateway1.nyi.internal [10.202.2.221])\r\n
\t(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/25
6 bits))\r\n\t(No client certificate requested)\r\n\tby mx5.nyi.
internal (Postfix) with ESMTPS id 30BA4280D81\r\n\tfor &lt;doug@dou
ghellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -0500 (EST)\r\nReceive
d: from compute2.internal (compute2.nyi.internal [10.202.2.42])\
r\n\tby mailout.nyi.internal (Postfix) with ESMTP id 1740420D0A\
r\n\tfor &lt;doug@doughellmann.com&gt;; Sun,  6 Mar 2016 16:16:03 -050
0 (EST)\r\nReceived: from frontend2 ([10.202.2.161])\r\n  by com
pute2.internal (MEProxy); Sun, 06 Mar 2016 16:16:03 -0500\r\nDKI
M-Signature: v=1; a=rsa-sha1; c=relaxed/relaxed; d=\r\n\tmessagi
ngengine.com; h=content-transfer-encoding:content-type\r\n\t:dat
e:from:message-id:mime-version:subject:to:x-sasl-enc\r\n\t:x-sas
l-enc; s=smtpout; bh=P98NTsEo015suwJ4gk71knAWLa4=; b=Jrsm+\r\n\t
pCovRIoQIRyp8Fl0L6JHOI8sbZy2obx7O28JF2iTlTWmX33Rhlq9403XRklwN3JA
\r\n\t7KSPqMTp30Qdx6yIUaADwQqlO+QMuQq/QxBHdjeebmdhgVfjhqxrzTbSMw
w/ZNhL\r\n\tYwv/QM/oDHbXiLSUlB3Qrg+9wsE/0jU/EOisiU=\r\nX-Sasl-en
c: 8ZJ+4ZRE8AGPzdLRWQFivGymJb8pa4G9JGcb7k4xKn+I 1457298962\r\nRe
ceived: from [192.168.1.14] (75-137-1-34.dhcp.nwnn.ga.charter.co
m [75.137.1.34])\r\n\tby mail.messagingengine.com (Postfix) with
 ESMTPA id C0B366801CD\r\n\tfor &lt;doug@doughellmann.com&gt;; Sun,  6
 Mar 2016 16:16:02 -0500 (EST)\r\nFrom: Doug Hellmann &lt;doug@doug
hellmann.com&gt;\r\nContent-Type: text/plain; charset=us-ascii\r\nC
ontent-Transfer-Encoding: 7bit\r\nSubject: PyMOTW Example messag
e 2\r\nMessage-Id: &lt;00ABCD46-DADA-4912-A451-D27165BC3A2F@doughel
lmann.com&gt;\r\nDate: Sun, 6 Mar 2016 16:16:02 -0500\r\nTo: Doug H
ellmann &lt;doug@doughellmann.com&gt;\r\nMime-Version: 1.0 (Mac OS X M
ail 9.2 \\(3112\\))\r\nX-Mailer: Apple Mail (2.3112)\r\n\r\n&#39;

b&#39;2&#39;:
b&#39;Subject: subject goes here\r\nFrom: pymotw@example.com\r\nTo:
example@example.com\r\n\r\n&#39;
</pre></div>
</div>
</div>
<div class="section" id="moving-and-copying-messages">
<h2>Moving and Copying Messages<a class="headerlink" href="#moving-and-copying-messages" title="Permalink to this headline">¶</a></h2>
<p>Once a message is on the server, it can be moved or copied without
downloading it using <code class="docutils literal notranslate"><span class="pre">move()</span></code> or <code class="docutils literal notranslate"><span class="pre">copy()</span></code>.  These methods
operate on message id ranges, just as <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> does.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">imaplib_archive_read.py</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="c1"># Find the &quot;SEEN&quot; messages in INBOX</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="n">response</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;SEEN&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">msg_ids</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>

    <span class="c1"># Create a new mailbox, &quot;Example.Today&quot;</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">create_response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;Example.Today&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CREATED Example.Today:&#39;</span><span class="p">,</span> <span class="n">create_response</span><span class="p">)</span>

    <span class="c1"># Copy the messages</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;COPYING:&#39;</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">,</span> <span class="s1">&#39;Example.Today&#39;</span><span class="p">)</span>

    <span class="c1"># Look at the results</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Example.Today&#39;</span><span class="p">)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="n">response</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;COPIED:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This example script creates a new mailbox under <code class="docutils literal notranslate"><span class="pre">Example</span></code> and copies
the read messages from <code class="docutils literal notranslate"><span class="pre">INBOX</span></code> into it.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_archive_read.py

CREATED Example.Today: [b&#39;Completed&#39;]
COPYING: 2
COPIED: b&#39;1&#39;
</pre></div>
</div>
<p>Running the same script again shows the importance to checking return
codes.  Instead of raising an exception, the call to <code class="docutils literal notranslate"><span class="pre">create()</span></code>
to make the new mailbox reports that the mailbox already exists.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_archive_read.py

CREATED Example.Today: [b&#39;[ALREADYEXISTS] Mailbox already exists
&#39;]
COPYING: 2
COPIED: b&#39;1 2&#39;
</pre></div>
</div>
</div>
<div class="section" id="deleting-messages">
<h2>Deleting Messages<a class="headerlink" href="#deleting-messages" title="Permalink to this headline">¶</a></h2>
<p>Although many modern mail clients use a “Trash folder” model for
working with deleted messages, the messages are not usually moved into
an actual folder.  Instead, their flags are updated to add
<code class="docutils literal notranslate"><span class="pre">\Deleted</span></code>.  The operation for “emptying” the trash is implemented
through the <code class="docutils literal notranslate"><span class="pre">EXPUNGE</span></code> command.  This example script finds the
archived messages with “Lorem ipsum” in the subject, sets the deleted
flag, then shows that the messages are still present in the folder by
querying the server again.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">imaplib_delete_messages.py</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imaplib</span>
<span class="kn">import</span> <span class="nn">imaplib_connect</span>
<span class="kn">from</span> <span class="nn">imaplib_list_parse</span> <span class="k">import</span> <span class="n">parse_list_response</span>

<span class="k">with</span> <span class="n">imaplib_connect</span><span class="o">.</span><span class="n">open_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Example.Today&#39;</span><span class="p">)</span>

    <span class="c1"># What ids are in the mailbox?</span>
    <span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="n">msg_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting messages:&#39;</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>

    <span class="c1"># Find the message(s)</span>
    <span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="n">msg_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;(SUBJECT &quot;subject goes here&quot;)&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">msg_ids</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_ids</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Matching messages:&#39;</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>

    <span class="c1"># What are the current flags?</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">,</span> <span class="s1">&#39;(FLAGS)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Flags before:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="c1"># Change the Deleted flag</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">,</span> <span class="s1">&#39;+FLAGS&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(\Deleted)&#39;</span><span class="p">)</span>

    <span class="c1"># What are the flags now?</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">msg_ids</span><span class="p">,</span> <span class="s1">&#39;(FLAGS)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Flags after:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="c1"># Really delete the message.</span>
    <span class="n">typ</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">expunge</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Expunged:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="c1"># What ids are left in the mailbox?</span>
    <span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="n">msg_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Remaining messages:&#39;</span><span class="p">,</span> <span class="n">msg_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Explicitly calling <code class="docutils literal notranslate"><span class="pre">expunge()</span></code> removes the messages, but calling
<code class="docutils literal notranslate"><span class="pre">close()</span></code> has the same effect.  The difference is the client is
not notified about the deletions when <code class="docutils literal notranslate"><span class="pre">close()</span></code> is called.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 imaplib_delete_messages.py

Response code: OK
Server response: b&#39;(\\HasChildren) &quot;.&quot; Example&#39;
Parsed response: (&#39;\\HasChildren&#39;, &#39;.&#39;, &#39;Example&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.Today&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.Today&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Example.2016&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Example.2016&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; Archive&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Archive&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; &quot;Deleted Messages&quot;&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;Deleted Messages&#39;)
Server response: b&#39;(\\HasNoChildren) &quot;.&quot; INBOX&#39;
Parsed response: (&#39;\\HasNoChildren&#39;, &#39;.&#39;, &#39;INBOX&#39;)
Starting messages: b&#39;1 2&#39;
Matching messages: 1,2
Flags before: [b&#39;1 (FLAGS (\\Seen))&#39;, b&#39;2 (FLAGS (\\Seen))&#39;]
Flags after: [b&#39;1 (FLAGS (\\Deleted \\Seen))&#39;, b&#39;2 (FLAGS (\\Del
eted \\Seen))&#39;]
Expunged: [b&#39;2&#39;, b&#39;1&#39;]
Remaining messages: b&#39;&#39;
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/imaplib.html">Standard library documentation for imaplib</a></li>
<li><code class="xref py py-mod docutils literal notranslate"><span class="pre">rfc822</span></code> – The <code class="docutils literal notranslate"><span class="pre">rfc822</span></code> module includes an RFC 822 / RFC 5322 parser.</li>
<li><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code> – The <code class="docutils literal notranslate"><span class="pre">email</span></code> module for parsing email messages.</li>
<li><a class="reference internal" href="../mailbox/index.html#module-mailbox" title="mailbox: Access and manipulate email archives."><code class="xref py py-mod docutils literal notranslate"><span class="pre">mailbox</span></code></a> – Local mailbox parser.</li>
<li><code class="xref py py-mod docutils literal notranslate"><span class="pre">ConfigParser</span></code> – Read and write configuration files.</li>
<li><a class="reference external" href="http://www.washington.edu/imap/">University of Washington IMAP Information Center</a> – Good resource for IMAP
information, along with source code.</li>
<li><span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3501.html"><strong>RFC 3501</strong></a> – Internet Message Access Protocol</li>
<li><span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5322.html"><strong>RFC 5322</strong></a> – Internet Message Format</li>
<li><a class="reference external" href="http://snipplr.com/view/7955/imap-backup-script/">IMAP Backup Script</a> – A script to backup email from an IMAP
server.</li>
<li><a class="reference external" href="http://imapclient.freshfoo.com/">IMAPClient</a> – A
higher-level client for talking to IMAP servers, written by
Menno Smits.</li>
<li><a class="reference external" href="http://www.offlineimap.org">offlineimap</a> – A Python
application for keeping a local set of mailboxes in sync with an
IMAP server.</li>
<li><a class="reference internal" href="../porting_notes.html#porting-imaplib"><span class="std std-ref">Python 2 to 3 porting notes for imaplib</span></a></li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../mailbox/index.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> mailbox — Manipulate Email Archives</a>
<a id="next-link" href="../frameworks.html"
   title="next chapter">Application Building Blocks <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#variations"><i class="fa fa-caret-right"></i>Variations</a></li>
    
    <li><a href="#connecting-to-a-server"><i class="fa fa-caret-right"></i>Connecting to a Server</a></li>
    
    <li><a href="#authentication-failure"><i class="fa fa-caret-right"></i>Authentication Failure</a></li>
    
    <li><a href="#example-configuration"><i class="fa fa-caret-right"></i>Example Configuration</a></li>
    
    <li><a href="#listing-mailboxes"><i class="fa fa-caret-right"></i>Listing Mailboxes</a></li>
    
    <li><a href="#mailbox-status"><i class="fa fa-caret-right"></i>Mailbox Status</a></li>
    
    <li><a href="#selecting-a-mailbox"><i class="fa fa-caret-right"></i>Selecting a Mailbox</a></li>
    
    <li><a href="#searching-for-messages"><i class="fa fa-caret-right"></i>Searching for Messages</a></li>
    
    <li><a href="#search-criteria"><i class="fa fa-caret-right"></i>Search Criteria</a></li>
    
    <li><a href="#fetching-messages"><i class="fa fa-caret-right"></i>Fetching Messages</a></li>
    
    <li><a href="#whole-messages"><i class="fa fa-caret-right"></i>Whole Messages</a></li>
    
    <li><a href="#uploading-messages"><i class="fa fa-caret-right"></i>Uploading Messages</a></li>
    
    <li><a href="#moving-and-copying-messages"><i class="fa fa-caret-right"></i>Moving and Copying Messages</a></li>
    
    <li><a href="#deleting-messages"><i class="fa fa-caret-right"></i>Deleting Messages</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2016-12-29.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../mailbox/index.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>mailbox — Manipulate Email Archives</a></li>
    <li><a href="../frameworks.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>Application Building Blocks</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAf5QTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gJCQkKCUmKCgoKCkoKSkpKSopKicnKioqLS0tMDAwMS0uMjExMjMxNTY1Pj8+Pzc5Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgY19haGVmbmxscHBwcHJvdXJzdnN0eHV2eXx5en15fH98fX98fnt8f4F+gICAgoWChIGChIWEhIaEh4aHiYyJjIqLjoeLj4+PkY+PkZORkZSRk5iTlZmUlpmWmJaXmpiZnp2dnqCdn5aan5+fn6Oeoqaho6Gho6ijpqqmq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbewsrexsrixs7iytLmztLqztbW1tbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIycjIyc3Iyc3Jys3Jy8rLy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4N/g4+Pj6Ofn7+/v8fHx////rrSdFQAAAAN0Uk5TAAoO5yEBUwAAA+FJREFUSMe1lo9301QUx6uXUmaf0qJ26iTrRoVinUzjQNR1gAyH6Lqx6XTDoVvXbU7qhA5m7CgYWaTDlLa6AiFsba3t+y+9Sdr8OvVMi7zTnLTf5H7ee9/73n11PA1PpDkcADPRWPwKt8YLG2I2n89m7gh8iluJz0dnpqe+HBsdHRn+7w3JyF1cvpbk05mCJG8Xi9uPpMLdNJ9cXV5UyBNjoyMtkR2A3B9Tt8SCfLTTqUzC2XlMvpcRbnA/IPmryYnzoyM9XuWBt8eI21FBcAy5Qk4KtxkGtQ1I+fRNbnk+evHC5NhJDwATDDIAnhNa1ImdFQTHr6WEvNyFPFeATSTYgAu/dl3/I31jNR6bnZ76eDf4yxRb2Q+71aiz/0JB8JXkrZzCdbFVqrUhRHuu54XkytLczAUvBFADUB6ARwnyqEp/t02prK9XdAXBHC9KyPWVqd6qPhyzlOG55dhsL/hLDTD1A3rYAy+dRu6eXaGKruA75wi2hbqigNd+LYSRW6XUSh64l05dXYruA1OPZfAOD3vhObL/ILDvQkRXynSdvPpaiJB+TVHAfEZuA9d9amlVF7TJd3nu+xgwyu8AqNOnDGAM8/obOLhQpWQotPYReZ/SQdKuKQpY2DwKwFJbGwI4VhCSlxchSFUnNC+CCgaV9RAKoZKh1J4le9FmQv5SFQW88aATXGhEws8wrHb7AANc0CndQS+ag5ERaieke0FXvnkxoYL/1MGi7FSmmVBXMDOu3gLK5J2PMjdXv2tmBX6pDdKSkq39DWXh3G1KI4QYVmS3AHCIPnCXE+4hHy6PcfeQ6sV2lufiL2jJ0wasp4p2k/Z2CEXeeqahDBLS1/c8+dBIXq4IkFAiWQ1QtxtnUMz/wsXfBj+1LzdUKn17dvXXzEqfMoFDNWO57QCe22dskKB5g7zXbVN+i0RKumKxonrfzaIVys2wYu7TVrd0PXn1rOnJC4JTFjF5c19/gnXLFwj6jJJz1rOjoi63LnBRfbmNM+qNunG5baSufhu9OPX5my2VTWEzrHrRbIP8dHl+dnpyrIVDBME/q1u6/E9bGmt9i2AsQmeaFaFwIb22soSlfuL8SEtgOCJKB5BsKkNltWyK7zzWMY3X4exDc6GvsljoX5FzR+BxwdCbf3jAdjTJv5/S39H2B2iXpmgXpWB7iVrB0JuVzpgP07CUO2WKqX+oiVL/benKImhgOIzHf7hx/A/IBdHsQ6Nsmruilo4afVFqB8PLn2U2H8hbxeKWjH9YvuiwxNiMaNhALZptCg5d7zh+Sczmclnx0vEOax6ajdjucSMPTcD/97/Cp54Q929ZZbgcR3o0hAAAAABJRU5ErkJggg=="/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>