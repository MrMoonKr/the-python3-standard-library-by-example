<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>sqlite3 — Embedded Relational Database &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="https://feeds.feedburner.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="https://feeds.feedburner.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@pymotw" />
    <meta name="twitter:title" content="sqlite3 — Embedded Relational Database" />
    <meta name="twitter:image" content="https://pymotw.com/3/_static/logo-large.png" />

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../persistence.html"><i class="fa fa-arrow-circle-up"></i> Data Persistence and Exchange</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-sqlite3">
<span id="sqlite3-embedded-relational-database"></span><h1>sqlite3 — Embedded Relational Database<a class="headerlink" href="#module-sqlite3" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Implements an embedded relational database with SQL support.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> module implements a <a class="reference external" href="https://www.python.org/dev/peps/pep-0249/">Python DB-API 2.0</a> compliant
interface to SQLite, an in-process relational database.  SQLite is
designed to be embedded in applications, instead of using a separate
database server program such as MySQL, PostgreSQL, or Oracle.  It is
fast, rigorously tested, and flexible, making it suitable for
prototyping and production deployment for some applications.</p>
<div class="section" id="creating-a-database">
<h2>Creating a Database<a class="headerlink" href="#creating-a-database" title="Permalink to this headline">¶</a></h2>
<p>An SQLite database is stored as a single file on the file system.  The
library manages access to the file, including locking it to prevent
corruption when multiple writers use it.  The database is created the
first time the file is accessed, but the application is responsible
for managing the table definitions, or <em>schema</em>, within the database.</p>
<p>This example looks for the database file before opening it with
<code class="docutils literal notranslate"><span class="pre">connect()</span></code> so it knows when to create the schema for new
databases.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">sqlite3_createdb.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>

<span class="n">db_is_new</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>

<span class="k">if</span> <span class="n">db_is_new</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Need to create schema&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database exists, assume schema does, too.&#39;</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Running the script twice shows that it creates the empty file if it
does not exist.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ls *.db

ls: *.db: No such file or directory

$ python3 sqlite3_createdb.py

Need to create schema

$ ls *.db

todo.db

$ python3 sqlite3_createdb.py

Database exists, assume schema does, too.
</pre></div>
</div>
<p>After creating the new database file, the next step is to create the
schema to define the tables within the database.  The remaining
examples in this section all use the same database schema with tables
for managing tasks.  The details of the database schema are presented
in the table below and the table below.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">The project Table</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="24%" />
<col width="9%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>name</td>
<td>text</td>
<td>Project name</td>
</tr>
<tr class="row-odd"><td>description</td>
<td>text</td>
<td>Long project description</td>
</tr>
<tr class="row-even"><td>deadline</td>
<td>date</td>
<td>Due date for the entire project</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text">The task Table</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="18%" />
<col width="8%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>id</td>
<td>number</td>
<td>Unique task identifier</td>
</tr>
<tr class="row-odd"><td>priority</td>
<td>integer</td>
<td>Numerical priority, lower is more important</td>
</tr>
<tr class="row-even"><td>details</td>
<td>text</td>
<td>Full task details</td>
</tr>
<tr class="row-odd"><td>status</td>
<td>text</td>
<td>Task status (one of ‘new’, ‘pending’, ‘done’, or ‘canceled’).</td>
</tr>
<tr class="row-even"><td>deadline</td>
<td>date</td>
<td>Due date for this task</td>
</tr>
<tr class="row-odd"><td>completed_on</td>
<td>date</td>
<td>When the task was completed.</td>
</tr>
<tr class="row-even"><td>project</td>
<td>text</td>
<td>The name of the project for this task.</td>
</tr>
</tbody>
</table>
<p>The <em>data definition language</em> (DDL) statements to create the tables
are:</p>
<div class="literal-block-wrapper sql-caption docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">todo_schema.sql</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Schema for to-do application examples.</span>

<span class="c1">-- Projects are high-level activities made up of tasks</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">project</span> <span class="p">(</span>
    <span class="n">name</span>        <span class="nb">text</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">description</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">deadline</span>    <span class="nb">date</span>
<span class="p">);</span>

<span class="c1">-- Tasks are steps that can be taken to complete a project</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">task</span> <span class="p">(</span>
    <span class="n">id</span>           <span class="nb">integer</span> <span class="k">primary</span> <span class="k">key</span> <span class="n">autoincrement</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">priority</span>     <span class="nb">integer</span> <span class="k">default</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">details</span>      <span class="nb">text</span><span class="p">,</span>
    <span class="n">status</span>       <span class="nb">text</span><span class="p">,</span>
    <span class="n">deadline</span>     <span class="nb">date</span><span class="p">,</span>
    <span class="n">completed_on</span> <span class="nb">date</span><span class="p">,</span>
    <span class="n">project</span>      <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span> <span class="k">references</span> <span class="n">project</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">executescript()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Connection</span></code> can be
used to run the DDL instructions to create the schema.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">sqlite3_create_schema.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="n">schema_filename</span> <span class="o">=</span> <span class="s1">&#39;todo_schema.sql&#39;</span>

<span class="n">db_is_new</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">db_is_new</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating schema&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inserting initial data&#39;</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        insert into project (name, description, deadline)</span>
<span class="s2">        values (&#39;pymotw&#39;, &#39;Python Module of the Week&#39;,</span>
<span class="s2">                &#39;2016-11-01&#39;);</span>

<span class="s2">        insert into task (details, status, deadline, project)</span>
<span class="s2">        values (&#39;write about select&#39;, &#39;done&#39;, &#39;2016-04-25&#39;,</span>
<span class="s2">                &#39;pymotw&#39;);</span>

<span class="s2">        insert into task (details, status, deadline, project)</span>
<span class="s2">        values (&#39;write about random&#39;, &#39;waiting&#39;, &#39;2016-08-22&#39;,</span>
<span class="s2">                &#39;pymotw&#39;);</span>

<span class="s2">        insert into task (details, status, deadline, project)</span>
<span class="s2">        values (&#39;write about sqlite3&#39;, &#39;active&#39;, &#39;2017-07-31&#39;,</span>
<span class="s2">                &#39;pymotw&#39;);</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database exists, assume schema does, too.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After the tables are created, a few <code class="docutils literal notranslate"><span class="pre">insert</span></code> statements
create a sample project and related tasks.  The <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code>
command line program can be used to examine the contents of the
database.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ rm -f todo.db
$ python3 sqlite3_create_schema.py

Creating schema
Inserting initial data

$ sqlite3 todo.db &#39;select * from task&#39;

1|1|write about select|done|2016-04-25||pymotw
2|1|write about random|waiting|2016-08-22||pymotw
3|1|write about sqlite3|active|2017-07-31||pymotw
</pre></div>
</div>
</div>
<div class="section" id="retrieving-data">
<h2>Retrieving Data<a class="headerlink" href="#retrieving-data" title="Permalink to this headline">¶</a></h2>
<p>To retrieve the values saved in the <code class="docutils literal notranslate"><span class="pre">task</span></code> table from within a
Python program, create a <code class="docutils literal notranslate"><span class="pre">Cursor</span></code> from a database connection.
A cursor produces a consistent view of the data, and is the primary
means of interacting with a transactional database system like SQLite.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">sqlite3_select_tasks.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, priority, details, status, deadline from task</span>
<span class="s2">    where project = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">row</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}</span><span class="s1"> [</span><span class="si">{:d}</span><span class="s1">] </span><span class="si">{:&lt;25}</span><span class="s1"> [</span><span class="si">{:&lt;8}</span><span class="s1">] (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Querying is a two step process.  First, run the query with the
cursor’s <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method to tell the database engine what data
to collect.  Then, use <code class="docutils literal notranslate"><span class="pre">fetchall()</span></code> to retrieve the results.  The
return value is a sequence of tuples containing the values for the
columns included in the <code class="docutils literal notranslate"><span class="pre">select</span></code> clause of the query.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_select_tasks.py

 1 [1] write about select        [done    ] (2016-04-25)
 2 [1] write about random        [waiting ] (2016-08-22)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
<p>The results can be retrieved one at a time with <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code>, or
in fixed-size batches with <code class="docutils literal notranslate"><span class="pre">fetchmany()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">sqlite3_select_variations.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select name, description, deadline from project</span>
<span class="s2">    where name = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Project details for </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">  due </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, priority, details, status, deadline from task</span>
<span class="s2">    where project = &#39;pymotw&#39; order by deadline</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Next 5 tasks:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">row</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}</span><span class="s1"> [</span><span class="si">{:d}</span><span class="s1">] </span><span class="si">{:&lt;25}</span><span class="s1"> [</span><span class="si">{:&lt;8}</span><span class="s1">] (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The value passed to <code class="docutils literal notranslate"><span class="pre">fetchmany()</span></code> is the maximum number of items
to return.  If fewer items are available, the sequence returned will
be smaller than the maximum value.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_select_variations.py

Project details for Python Module of the Week (pymotw)
  due 2016-11-01

Next 5 tasks:
 1 [1] write about select        [done    ] (2016-04-25)
 2 [1] write about random        [waiting ] (2016-08-22)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
</div>
<div class="section" id="query-metadata">
<h2>Query Metadata<a class="headerlink" href="#query-metadata" title="Permalink to this headline">¶</a></h2>
<p>The DB-API 2.0 specification says that after <code class="docutils literal notranslate"><span class="pre">execute()</span></code> has been
called, the <code class="docutils literal notranslate"><span class="pre">Cursor</span></code> should set its <code class="xref py py-attr docutils literal notranslate"><span class="pre">description</span></code>
attribute to hold information about the data that will be returned by
the fetch methods.  The API specification say that the description
value is a sequence of tuples containing the column name, type,
display size, internal size, precision, scale, and a flag that says
whether null values are accepted.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">sqlite3_cursor_description.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select * from task where project = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task table has these columns:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">colinfo</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">colinfo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> does not enforce type or size constraints on
data inserted into a database, only the column name value is filled
in.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_cursor_description.py

Task table has these columns:
(&#39;id&#39;, None, None, None, None, None, None)
(&#39;priority&#39;, None, None, None, None, None, None)
(&#39;details&#39;, None, None, None, None, None, None)
(&#39;status&#39;, None, None, None, None, None, None)
(&#39;deadline&#39;, None, None, None, None, None, None)
(&#39;completed_on&#39;, None, None, None, None, None, None)
(&#39;project&#39;, None, None, None, None, None, None)
</pre></div>
</div>
</div>
<div class="section" id="row-objects">
<h2>Row Objects<a class="headerlink" href="#row-objects" title="Permalink to this headline">¶</a></h2>
<p>By default, the values returned by the fetch methods as “rows” from
the database are tuples.  The caller is responsible for knowing the
order of the columns in the query and extracting individual values
from the tuple.  When the number of values in a query grows, or the
code working with the data is spread out in a library, it is usually
easier to work with an object and access values using their
column names.  That way, the number and order of the tuple
contents can change over time as the query is edited, and code
depending on the query results is less likely to break.</p>
<p><code class="docutils literal notranslate"><span class="pre">Connection</span></code> objects have a <code class="docutils literal notranslate"><span class="pre">row_factory</span></code> property that
allows the calling code to control the type of object created to
represent each row in the query result set.  <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> also
includes a <code class="docutils literal notranslate"><span class="pre">Row</span></code> class intended to be used as a row factory.
Column values can be accessed through <code class="docutils literal notranslate"><span class="pre">Row</span></code> instances by using
the column index or name.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">sqlite3_row_factory.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="c1"># Change the row factory to use Row</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select name, description, deadline from project</span>
<span class="s2">    where name = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Project details for </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">  due </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">description</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, priority, status, deadline, details from task</span>
<span class="s2">    where project = &#39;pymotw&#39; order by deadline</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Next 5 tasks:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}</span><span class="s1"> [</span><span class="si">{:d}</span><span class="s1">] </span><span class="si">{:&lt;25}</span><span class="s1"> [</span><span class="si">{:&lt;8}</span><span class="s1">] (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;deadline&#39;</span><span class="p">],</span>
        <span class="p">))</span>
</pre></div>
</div>
</div>
<p>This version of the <code class="docutils literal notranslate"><span class="pre">sqlite3_select_variations.py</span></code> example has been
re-written using <code class="docutils literal notranslate"><span class="pre">Row</span></code> instances instead of tuples.  The row
from the project table is still printed by accessing the column values
through position, but the <code class="docutils literal notranslate"><span class="pre">print</span></code> statement for tasks uses
keyword lookup instead, so it does not matter that the order of the
columns in the query has been changed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_row_factory.py

Project details for Python Module of the Week (pymotw)
  due 2016-11-01

Next 5 tasks:
 1 [1] write about select        [done    ] (2016-04-25)
 2 [1] write about random        [waiting ] (2016-08-22)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
</div>
<div class="section" id="using-variables-with-queries">
<h2>Using Variables with Queries<a class="headerlink" href="#using-variables-with-queries" title="Permalink to this headline">¶</a></h2>
<p>Using queries defined as literal strings embedded in a program is
inflexible.  For example, when another project is added to the
database the query to show the top five tasks should be updated to
work with either project.  One way to add more flexibility is to build
an SQL statement with the desired query by combining values in Python.
However, building a query string in this way is dangerous, and should
be avoided.  Failing to correctly escape special characters in the
variable parts of the query can result in SQL parsing errors, or
worse, a class of security vulnerabilities known as <em>SQL-injection
attacks</em>, which allow intruders to execute arbitrary SQL statements in
the database.</p>
<p>The proper way to use dynamic values with queries is through <em>host
variables</em> passed to <code class="docutils literal notranslate"><span class="pre">execute()</span></code> along with the SQL instruction.
A placeholder value in the SQL is replaced with the value of the host
variable when the statement is executed.  Using host variables instead
of inserting arbitrary values into the SQL before it is parsed avoids
injection attacks because there is no chance that the untrusted values
will affect how the SQL is parsed.  SQLite supports two forms for
queries with placeholders, positional and named.</p>
<div class="section" id="positional-parameters">
<h3>Positional Parameters<a class="headerlink" href="#positional-parameters" title="Permalink to this headline">¶</a></h3>
<p>A question mark (<code class="docutils literal notranslate"><span class="pre">?</span></code>) denotes a positional argument, passed to
<code class="docutils literal notranslate"><span class="pre">execute()</span></code> as a member of a tuple.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">sqlite3_argument_positional.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="n">project_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, priority, details, status, deadline from task</span>
<span class="s2">    where project = ?</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">project_name</span><span class="p">,))</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">row</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}</span><span class="s1"> [</span><span class="si">{:d}</span><span class="s1">] </span><span class="si">{:&lt;25}</span><span class="s1"> [</span><span class="si">{:&lt;8}</span><span class="s1">] (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The command line argument is passed safely to the query as a
positional argument, and there is no chance for bad data to corrupt
the database.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_argument_positional.py pymotw

 1 [1] write about select        [done    ] (2016-04-25)
 2 [1] write about random        [waiting ] (2016-08-22)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
</div>
<div class="section" id="named-parameters">
<h3>Named Parameters<a class="headerlink" href="#named-parameters" title="Permalink to this headline">¶</a></h3>
<p>Use named parameters for more complex queries with a lot of parameters,
or where some parameters are repeated multiple times within the query.
Named parameters are prefixed with a colon (e.g., <code class="docutils literal notranslate"><span class="pre">:param_name</span></code>).</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">sqlite3_argument_named.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="n">project_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, priority, details, status, deadline from task</span>
<span class="s2">    where project = :project_name</span>
<span class="s2">    order by deadline, priority</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;project_name&#39;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">})</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">row</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}</span><span class="s1"> [</span><span class="si">{:d}</span><span class="s1">] </span><span class="si">{:&lt;25}</span><span class="s1"> [</span><span class="si">{:&lt;8}</span><span class="s1">] (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Neither positional nor named parameters need to be quoted or escaped,
since they are given special treatment by the query parser.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_argument_named.py pymotw

 1 [1] write about select        [done    ] (2016-04-25)
 2 [1] write about random        [waiting ] (2016-08-22)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
<p>Query parameters can be used with <code class="docutils literal notranslate"><span class="pre">select</span></code>,
<code class="docutils literal notranslate"><span class="pre">insert</span></code>, and <code class="docutils literal notranslate"><span class="pre">update</span></code> statements.  They can appear
in any part of the query where a literal value is legal.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">sqlite3_argument_update.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="nb">id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update task set status = :status where id = :id&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">update</span></code> statement uses two named parameters.  The
<code class="docutils literal notranslate"><span class="pre">id</span></code> value is used to find the right row to modify, and the
<code class="docutils literal notranslate"><span class="pre">status</span></code> value is written to the table.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_argument_update.py 2 done
$ python3 sqlite3_argument_named.py pymotw

 1 [1] write about select        [done    ] (2016-04-25)
 2 [1] write about random        [done    ] (2016-08-22)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
</div>
</div>
<div class="section" id="bulk-loading">
<h2>Bulk Loading<a class="headerlink" href="#bulk-loading" title="Permalink to this headline">¶</a></h2>
<p>To apply the same SQL instruction to a large set of data, use
<code class="docutils literal notranslate"><span class="pre">executemany()</span></code>.  This is useful for loading data, since it avoids
looping over the inputs in Python and lets the underlying library
apply loop optimizations.  This example program reads a list of tasks
from a comma-separated value file using the <a class="reference internal" href="../csv/index.html#module-csv" title="csv: Read and write comma separated value files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code></a> module and
loads them into the database.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">sqlite3_load_csv.py</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="n">data_filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">SQL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">insert into task (details, priority, status, deadline, project)</span>
<span class="s2">values (:details, :priority, &#39;active&#39;, :deadline, :project)</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
    <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">SQL</span><span class="p">,</span> <span class="n">csv_reader</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The sample data file <code class="docutils literal notranslate"><span class="pre">tasks.csv</span></code> contains:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">deadline</span><span class="p">,</span><span class="n">project</span><span class="p">,</span><span class="n">priority</span><span class="p">,</span><span class="n">details</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="n">pymotw</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;finish reviewing markup&quot;</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="n">pymotw</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;revise chapter intros&quot;</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span><span class="n">pymotw</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;subtitle&quot;</span>
</pre></div>
</div>
<p>Running the program produces:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_load_csv.py tasks.csv
$ python3 sqlite3_argument_named.py pymotw

 1 [1] write about select        [done    ] (2016-04-25)
 5 [2] revise chapter intros     [active  ] (2016-08-20)
 2 [1] write about random        [done    ] (2016-08-22)
 6 [1] subtitle                  [active  ] (2016-11-01)
 4 [2] finish reviewing markup   [active  ] (2016-11-30)
 3 [1] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
</div>
<div class="section" id="defining-new-column-types">
<h2>Defining New Column Types<a class="headerlink" href="#defining-new-column-types" title="Permalink to this headline">¶</a></h2>
<p>SQLite has native support for integer, floating point, and text
columns.  Data of these types is converted automatically by
<code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> from Python’s representation to a value that can be
stored in the database, and back again, as needed.  Integer values are
loaded from the database into <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">long</span></code> variables,
depending on the size of the value.  Text is saved and retrieved as
<code class="docutils literal notranslate"><span class="pre">str</span></code>, unless the <code class="xref py py-attr docutils literal notranslate"><span class="pre">text_factory</span></code> for the
<code class="docutils literal notranslate"><span class="pre">Connection</span></code> has been changed.</p>
<p>Although SQLite only supports a few data types internally,
<code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> includes facilities for defining custom types to allow
a Python application to store any type of data in a column.
Conversion for types beyond those supported by default is enabled in
the database connection using the <code class="docutils literal notranslate"><span class="pre">detect_types</span></code> flag.  Use
<code class="docutils literal notranslate"><span class="pre">PARSE_DECLTYPES</span></code> if the column was declared using the desired
type when the table was defined.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">sqlite3_date_types.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>

<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;select id, details, deadline from task&quot;</span>


<span class="k">def</span> <span class="nf">show_deadline</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">,</span> <span class="s1">&#39;deadline&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{:&lt;8}</span><span class="s1">  </span><span class="si">{!r:&lt;26}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])))</span>
    <span class="k">return</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Without type detection:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">show_deadline</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">With type detection:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">,</span>
                     <span class="n">detect_types</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_DECLTYPES</span><span class="p">,</span>
                     <span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">show_deadline</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> provides converters for date and timestamp columns,
using the classes <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">datetime</span></code> from the
<a class="reference internal" href="../datetime/index.html#module-datetime" title="datetime: Date and time value manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a> module to represent the values in Python.  Both
date-related converters are enabled automatically when type-detection
is turned on.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_date_types.py

Without type detection:
  id        1                          &lt;class &#39;int&#39;&gt;
  details   &#39;write about select&#39;       &lt;class &#39;str&#39;&gt;
  deadline  &#39;2016-04-25&#39;               &lt;class &#39;str&#39;&gt;

With type detection:
  id        1                          &lt;class &#39;int&#39;&gt;
  details   &#39;write about select&#39;       &lt;class &#39;str&#39;&gt;
  deadline  datetime.date(2016, 4, 25) &lt;class &#39;datetime.date&#39;&gt;
</pre></div>
</div>
<p>Two functions need to be registered to define a new type.  The
<em>adapter</em> takes the Python object as input and returns a byte string
that can be stored in the database.  The <em>converter</em> receives the
string from the database and returns a Python object.  Use
<code class="docutils literal notranslate"><span class="pre">register_adapter()</span></code> to define an adapter function, and
<code class="docutils literal notranslate"><span class="pre">register_converter()</span></code> for a converter function.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">sqlite3_custom_type.py</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">adapter_func</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from in-memory to storage representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;adapter_func(</span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">converter_func</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from storage to in-memory representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;converter_func(</span><span class="si">{!r}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyObj</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;MyObj(</span><span class="si">{!r}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>


<span class="c1"># Register the functions for manipulating the type.</span>
<span class="n">sqlite3</span><span class="o">.</span><span class="n">register_adapter</span><span class="p">(</span><span class="n">MyObj</span><span class="p">,</span> <span class="n">adapter_func</span><span class="p">)</span>
<span class="n">sqlite3</span><span class="o">.</span><span class="n">register_converter</span><span class="p">(</span><span class="s2">&quot;MyObj&quot;</span><span class="p">,</span> <span class="n">converter_func</span><span class="p">)</span>

<span class="c1"># Create some objects to save.  Use a list of tuples so</span>
<span class="c1"># the sequence can be passed directly to executemany().</span>
<span class="n">to_save</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">MyObj</span><span class="p">(</span><span class="s1">&#39;this is a value to save&#39;</span><span class="p">),),</span>
    <span class="p">(</span><span class="n">MyObj</span><span class="p">(</span><span class="mi">42</span><span class="p">),),</span>
<span class="p">]</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">db_filename</span><span class="p">,</span>
        <span class="n">detect_types</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_DECLTYPES</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="c1"># Create a table with column of type &quot;MyObj&quot;</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    create table if not exists obj (</span>
<span class="s2">        id    integer primary key autoincrement not null,</span>
<span class="s2">        data  MyObj</span>
<span class="s2">    )</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="c1"># Insert the objects into the database</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;insert into obj (data) values (?)&quot;</span><span class="p">,</span>
                       <span class="n">to_save</span><span class="p">)</span>

    <span class="c1"># Query the database for the objects just saved</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select id, data from obj&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieved&#39;</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  with type&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>This example uses <a class="reference internal" href="../pickle/index.html#module-pickle" title="pickle: Object serialization"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> to save an object to a string that can
be stored in the database, a useful technique for storing arbitrary
objects, but one that does not allow querying based on object
attributes.  A real <em>object-relational mapper</em>, such as <a class="reference external" href="http://sqlalchemy.org/">SQLAlchemy</a>, that
stores attribute values in their own columns will be more useful for
large amounts of data.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_custom_type.py

adapter_func(MyObj(&#39;this is a value to save&#39;))

adapter_func(MyObj(42))

converter_func(b&#39;\x80\x03c__main__\nMyObj\nq\x00)\x81q\x01}q\x02X\x0
3\x00\x00\x00argq\x03X\x17\x00\x00\x00this is a value to saveq\x04sb
.&#39;)

converter_func(b&#39;\x80\x03c__main__\nMyObj\nq\x00)\x81q\x01}q\x02X\x0
3\x00\x00\x00argq\x03K*sb.&#39;)

Retrieved 1 MyObj(&#39;this is a value to save&#39;)
  with type &lt;class &#39;__main__.MyObj&#39;&gt;

Retrieved 2 MyObj(42)
  with type &lt;class &#39;__main__.MyObj&#39;&gt;
</pre></div>
</div>
</div>
<div class="section" id="determining-types-for-columns">
<h2>Determining Types for Columns<a class="headerlink" href="#determining-types-for-columns" title="Permalink to this headline">¶</a></h2>
<p>There are two sources for types information about the data for a
query.  The original table declaration can be used to identify the
type of a real column, as shown earlier.  A type specifier can also be
included in the <code class="docutils literal notranslate"><span class="pre">select</span></code> clause of the query itself using the
form <code class="docutils literal notranslate"><span class="pre">as</span> <span class="pre">&quot;name</span> <span class="pre">[type]&quot;</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">sqlite3_custom_type_column.py</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">adapter_func</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from in-memory to storage representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;adapter_func(</span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">converter_func</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from storage to in-memory representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;converter_func(</span><span class="si">{!r}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyObj</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;MyObj(</span><span class="si">{!r}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>


<span class="c1"># Register the functions for manipulating the type.</span>
<span class="n">sqlite3</span><span class="o">.</span><span class="n">register_adapter</span><span class="p">(</span><span class="n">MyObj</span><span class="p">,</span> <span class="n">adapter_func</span><span class="p">)</span>
<span class="n">sqlite3</span><span class="o">.</span><span class="n">register_converter</span><span class="p">(</span><span class="s2">&quot;MyObj&quot;</span><span class="p">,</span> <span class="n">converter_func</span><span class="p">)</span>

<span class="c1"># Create some objects to save.  Use a list of tuples so we</span>
<span class="c1"># can pass this sequence directly to executemany().</span>
<span class="n">to_save</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">MyObj</span><span class="p">(</span><span class="s1">&#39;this is a value to save&#39;</span><span class="p">),),</span>
    <span class="p">(</span><span class="n">MyObj</span><span class="p">(</span><span class="mi">42</span><span class="p">),),</span>
<span class="p">]</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">db_filename</span><span class="p">,</span>
        <span class="n">detect_types</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_COLNAMES</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="c1"># Create a table with column of type &quot;text&quot;</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    create table if not exists obj2 (</span>
<span class="s2">        id    integer primary key autoincrement not null,</span>
<span class="s2">        data  text</span>
<span class="s2">    )</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="c1"># Insert the objects into the database</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;insert into obj2 (data) values (?)&quot;</span><span class="p">,</span>
                       <span class="n">to_save</span><span class="p">)</span>

    <span class="c1"># Query the database for the objects just saved,</span>
    <span class="c1"># using a type specifier to convert the text</span>
    <span class="c1"># to objects.</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s1">&#39;select id, data as &quot;pickle [MyObj]&quot; from obj2&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieved&#39;</span><span class="p">,</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  with type&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">detect_types</span></code> flag <code class="docutils literal notranslate"><span class="pre">PARSE_COLNAMES</span></code> when the
type is part of the query instead of the original table definition.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_custom_type_column.py

adapter_func(MyObj(&#39;this is a value to save&#39;))

adapter_func(MyObj(42))

converter_func(b&#39;\x80\x03c__main__\nMyObj\nq\x00)\x81q\x01}q\x02X\x0
3\x00\x00\x00argq\x03X\x17\x00\x00\x00this is a value to saveq\x04sb
.&#39;)

converter_func(b&#39;\x80\x03c__main__\nMyObj\nq\x00)\x81q\x01}q\x02X\x0
3\x00\x00\x00argq\x03K*sb.&#39;)

Retrieved 1 MyObj(&#39;this is a value to save&#39;)
  with type &lt;class &#39;__main__.MyObj&#39;&gt;

Retrieved 2 MyObj(42)
  with type &lt;class &#39;__main__.MyObj&#39;&gt;
</pre></div>
</div>
</div>
<div class="section" id="transactions">
<h2>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h2>
<p>One of the key features of relational databases is the use of
<em>transactions</em> to maintain a consistent internal state.  With
transactions enabled, several changes can be made through one
connection without effecting any other users until the results are
<em>committed</em> and flushed to the actual database.</p>
<div class="section" id="preserving-changes">
<h3>Preserving Changes<a class="headerlink" href="#preserving-changes" title="Permalink to this headline">¶</a></h3>
<p>Changes to the database, either through <code class="docutils literal notranslate"><span class="pre">insert</span></code> or
<code class="docutils literal notranslate"><span class="pre">update</span></code> statements, need to be saved by explicitly calling
<code class="docutils literal notranslate"><span class="pre">commit()</span></code>.  This requirement gives an application an opportunity
to make several related changes together, so they are stored
<em>atomically</em> instead of incrementally, and avoids a situation where
partial updates are seen by different clients connecting to the
database simultaneously.</p>
<p>The effect of calling <code class="docutils literal notranslate"><span class="pre">commit()</span></code> can be seen with a program that
uses several connections to the database.  A new row is inserted with
the first connection, and then two attempts are made to read it back
using separate connections.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">sqlite3_transaction_commit.py</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">show_projects</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select name, description from project&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before changes:&#39;</span><span class="p">)</span>
    <span class="n">show_projects</span><span class="p">(</span><span class="n">conn1</span><span class="p">)</span>

    <span class="c1"># Insert in one cursor</span>
    <span class="n">cursor1</span> <span class="o">=</span> <span class="n">conn1</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor1</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into project (name, description, deadline)</span>
<span class="s2">    values (&#39;virtualenvwrapper&#39;, &#39;Virtualenv Extensions&#39;,</span>
<span class="s2">            &#39;2011-01-01&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After changes in conn1:&#39;</span><span class="p">)</span>
    <span class="n">show_projects</span><span class="p">(</span><span class="n">conn1</span><span class="p">)</span>

    <span class="c1"># Select from another connection, without committing first</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Before commit:&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn2</span><span class="p">:</span>
        <span class="n">show_projects</span><span class="p">(</span><span class="n">conn2</span><span class="p">)</span>

    <span class="c1"># Commit then select from another connection</span>
    <span class="n">conn1</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After commit:&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn3</span><span class="p">:</span>
        <span class="n">show_projects</span><span class="p">(</span><span class="n">conn3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">show_projects()</span></code> is called before <code class="docutils literal notranslate"><span class="pre">conn1</span></code> has been
committed, the results depend on which connection is used.  Since the
change was made through <code class="docutils literal notranslate"><span class="pre">conn1</span></code>, it sees the altered data.
However, <code class="docutils literal notranslate"><span class="pre">conn2</span></code> does not.  After committing, the new connection
<code class="docutils literal notranslate"><span class="pre">conn3</span></code> sees the inserted row.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_transaction_commit.py

Before changes:
   pymotw

After changes in conn1:
   pymotw
   virtualenvwrapper

Before commit:
   pymotw

After commit:
   pymotw
   virtualenvwrapper
</pre></div>
</div>
</div>
<div class="section" id="discarding-changes">
<h3>Discarding Changes<a class="headerlink" href="#discarding-changes" title="Permalink to this headline">¶</a></h3>
<p>Uncommitted changes can also be discarded entirely using
<code class="docutils literal notranslate"><span class="pre">rollback()</span></code>.  The <code class="docutils literal notranslate"><span class="pre">commit()</span></code> and <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> methods are
usually called from different parts of the same <code class="docutils literal notranslate"><span class="pre">try:except</span></code> block,
with errors triggering a rollback.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">sqlite3_transaction_rollback.py</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">show_projects</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select name, description from project&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before changes:&#39;</span><span class="p">)</span>
    <span class="n">show_projects</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="c1"># Insert</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;delete from project</span>
<span class="s2">                       where name = &#39;virtualenvwrapper&#39;</span>
<span class="s2">                       &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Show the settings</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After delete:&#39;</span><span class="p">)</span>
        <span class="n">show_projects</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

        <span class="c1"># Pretend the processing caused an error</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;simulated error&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="c1"># Discard the changes</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Save the changes</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="c1"># Show the results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After rollback:&#39;</span><span class="p">)</span>
    <span class="n">show_projects</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After calling <code class="docutils literal notranslate"><span class="pre">rollback()</span></code>, the changes to the database are no
longer present.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_transaction_rollback.py

Before changes:
   pymotw
   virtualenvwrapper

After delete:
   pymotw
ERROR: simulated error

After rollback:
   pymotw
   virtualenvwrapper
</pre></div>
</div>
</div>
</div>
<div class="section" id="isolation-levels">
<h2>Isolation Levels<a class="headerlink" href="#isolation-levels" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> supports three locking modes, called <em>isolation
levels</em>, that control the technique used to prevent incompatible changes
between connections.  The isolation level is set by passing a string
as the <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> argument when a connection is opened, so
different connections can use different values.</p>
<p>This program demonstrates the effect of different isolation levels on
the order of events in threads using separate connections to the same
database.  Four threads are created.  Two threads write changes to the
database by updating existing rows.  The other two threads attempt to
read all of the rows from the <code class="docutils literal notranslate"><span class="pre">task</span></code> table.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">sqlite3_isolation_levels.py</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> (</span><span class="si">%(threadName)-10s</span><span class="s1">) </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="n">isolation_level</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">writer</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">db_filename</span><span class="p">,</span>
            <span class="n">isolation_level</span><span class="o">=</span><span class="n">isolation_level</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;update task set priority = priority + 1&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;waiting to synchronize&#39;</span><span class="p">)</span>
        <span class="n">ready</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># synchronize threads</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;PAUSING&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;CHANGES COMMITTED&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">reader</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">db_filename</span><span class="p">,</span>
            <span class="n">isolation_level</span><span class="o">=</span><span class="n">isolation_level</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;waiting to synchronize&#39;</span><span class="p">)</span>
        <span class="n">ready</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># synchronize threads</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;wait over&#39;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from task&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;SELECT EXECUTED&#39;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;results fetched&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ready</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

    <span class="n">threads</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reader 1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">reader</span><span class="p">),</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reader 2&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">reader</span><span class="p">),</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writer 1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">writer</span><span class="p">),</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Writer 2&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">writer</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;setting ready&#39;</span><span class="p">)</span>
    <span class="n">ready</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The threads are synchronized using an <code class="docutils literal notranslate"><span class="pre">Event</span></code> object from the
<a class="reference internal" href="../threading/index.html#module-threading" title="threading: Manage concurrent operations"><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> module.  The <code class="docutils literal notranslate"><span class="pre">writer()</span></code> function connects and
make changes to the database, but does not commit before the event
fires.  The <code class="docutils literal notranslate"><span class="pre">reader()</span></code> function connects, then waits to query the
database until after the synchronization event occurs.</p>
<div class="section" id="deferred">
<h3>Deferred<a class="headerlink" href="#deferred" title="Permalink to this headline">¶</a></h3>
<p>The default isolation level is <code class="docutils literal notranslate"><span class="pre">DEFERRED</span></code>.  Using deferred mode
locks the database, but only once a change is begun.  All of the
previous examples use deferred mode.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_isolation_levels.py DEFERRED

2016-08-20 17:46:26,972 (Reader 1  ) waiting to synchronize
2016-08-20 17:46:26,972 (Reader 2  ) waiting to synchronize
2016-08-20 17:46:26,973 (Writer 1  ) waiting to synchronize
2016-08-20 17:46:27,977 (MainThread) setting ready
2016-08-20 17:46:27,979 (Reader 1  ) wait over
2016-08-20 17:46:27,979 (Writer 1  ) PAUSING
2016-08-20 17:46:27,979 (Reader 2  ) wait over
2016-08-20 17:46:27,981 (Reader 1  ) SELECT EXECUTED
2016-08-20 17:46:27,982 (Reader 1  ) results fetched
2016-08-20 17:46:27,982 (Reader 2  ) SELECT EXECUTED
2016-08-20 17:46:27,982 (Reader 2  ) results fetched
2016-08-20 17:46:28,985 (Writer 1  ) CHANGES COMMITTED
2016-08-20 17:46:29,043 (Writer 2  ) waiting to synchronize
2016-08-20 17:46:29,043 (Writer 2  ) PAUSING
2016-08-20 17:46:30,044 (Writer 2  ) CHANGES COMMITTED
</pre></div>
</div>
</div>
<div class="section" id="immediate">
<h3>Immediate<a class="headerlink" href="#immediate" title="Permalink to this headline">¶</a></h3>
<p>Immediate mode locks the database as soon as a change starts and
prevents other cursors from making changes until the transaction is
committed.  It is suitable for a database with complicated writes, but
more readers than writers, since the readers are not blocked while the
transaction is ongoing.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_isolation_levels.py IMMEDIATE

2016-08-20 17:46:30,121 (Reader 1  ) waiting to synchronize
2016-08-20 17:46:30,121 (Reader 2  ) waiting to synchronize
2016-08-20 17:46:30,123 (Writer 1  ) waiting to synchronize
2016-08-20 17:46:31,122 (MainThread) setting ready
2016-08-20 17:46:31,122 (Reader 1  ) wait over
2016-08-20 17:46:31,122 (Reader 2  ) wait over
2016-08-20 17:46:31,122 (Writer 1  ) PAUSING
2016-08-20 17:46:31,124 (Reader 1  ) SELECT EXECUTED
2016-08-20 17:46:31,124 (Reader 2  ) SELECT EXECUTED
2016-08-20 17:46:31,125 (Reader 2  ) results fetched
2016-08-20 17:46:31,125 (Reader 1  ) results fetched
2016-08-20 17:46:32,128 (Writer 1  ) CHANGES COMMITTED
2016-08-20 17:46:32,199 (Writer 2  ) waiting to synchronize
2016-08-20 17:46:32,199 (Writer 2  ) PAUSING
2016-08-20 17:46:33,200 (Writer 2  ) CHANGES COMMITTED
</pre></div>
</div>
</div>
<div class="section" id="exclusive">
<h3>Exclusive<a class="headerlink" href="#exclusive" title="Permalink to this headline">¶</a></h3>
<p>Exclusive mode locks the database to all readers and writers.  Its use
should be limited in situations where database performance is
important, since each exclusive connection blocks all other users.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_isolation_levels.py EXCLUSIVE

2016-08-20 17:46:33,320 (Reader 1  ) waiting to synchronize
2016-08-20 17:46:33,320 (Reader 2  ) waiting to synchronize
2016-08-20 17:46:33,324 (Writer 2  ) waiting to synchronize
2016-08-20 17:46:34,323 (MainThread) setting ready
2016-08-20 17:46:34,323 (Reader 1  ) wait over
2016-08-20 17:46:34,323 (Writer 2  ) PAUSING
2016-08-20 17:46:34,323 (Reader 2  ) wait over
2016-08-20 17:46:35,327 (Writer 2  ) CHANGES COMMITTED
2016-08-20 17:46:35,368 (Reader 2  ) SELECT EXECUTED
2016-08-20 17:46:35,368 (Reader 2  ) results fetched
2016-08-20 17:46:35,369 (Reader 1  ) SELECT EXECUTED
2016-08-20 17:46:35,369 (Reader 1  ) results fetched
2016-08-20 17:46:35,385 (Writer 1  ) waiting to synchronize
2016-08-20 17:46:35,385 (Writer 1  ) PAUSING
2016-08-20 17:46:36,386 (Writer 1  ) CHANGES COMMITTED
</pre></div>
</div>
<p>Because the first writer has started making changes, the readers and
second writer block until it commits.  The <code class="docutils literal notranslate"><span class="pre">sleep()</span></code> call
introduces an artificial delay in the writer thread to highlight the
fact that the other connections are blocking.</p>
</div>
<div class="section" id="autocommit">
<h3>Autocommit<a class="headerlink" href="#autocommit" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> parameter for the connection can also be set to
<code class="docutils literal notranslate"><span class="pre">None</span></code> to enable autocommit mode.  With autocommit enabled, each
<code class="docutils literal notranslate"><span class="pre">execute()</span></code> call is committed immediately when the statement
finishes.  Autocommit mode is suited for short transactions, such as
those that insert a small amount of data into a single table.  The
database is locked for as little time as possible, so there is less
chance of contention between threads.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">sqlite3_autocommit.py</span></code>, the explicit call to <code class="docutils literal notranslate"><span class="pre">commit()</span></code> has
been removed and the isolation level is set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, but otherwise
is the same as <code class="docutils literal notranslate"><span class="pre">sqlite3_isolation_levels.py</span></code>.  The output is
different, however, since both writer threads finish their work before
either reader starts querying.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_autocommit.py

2016-08-20 17:46:36,451 (Reader 1  ) waiting to synchronize
2016-08-20 17:46:36,451 (Reader 2  ) waiting to synchronize
2016-08-20 17:46:36,455 (Writer 1  ) waiting to synchronize
2016-08-20 17:46:36,456 (Writer 2  ) waiting to synchronize
2016-08-20 17:46:37,452 (MainThread) setting ready
2016-08-20 17:46:37,452 (Reader 1  ) wait over
2016-08-20 17:46:37,452 (Writer 2  ) PAUSING
2016-08-20 17:46:37,452 (Reader 2  ) wait over
2016-08-20 17:46:37,453 (Writer 1  ) PAUSING
2016-08-20 17:46:37,453 (Reader 1  ) SELECT EXECUTED
2016-08-20 17:46:37,454 (Reader 2  ) SELECT EXECUTED
2016-08-20 17:46:37,454 (Reader 1  ) results fetched
2016-08-20 17:46:37,454 (Reader 2  ) results fetched
</pre></div>
</div>
</div>
</div>
<div class="section" id="in-memory-databases">
<h2>In-Memory Databases<a class="headerlink" href="#in-memory-databases" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports managing an entire database in RAM, instead of relying
on a disk file.  In-memory databases are useful for automated testing,
where the database does not need to be preserved between test runs, or
when experimenting with a schema or other database features.  To open
an in-memory database, use the string <code class="docutils literal notranslate"><span class="pre">':memory:'</span></code> instead of a
filename when creating the <code class="docutils literal notranslate"><span class="pre">Connection</span></code>.  Each <code class="docutils literal notranslate"><span class="pre">':memory:'</span></code>
connection creates a separate database instance, so changes made by a
cursor in one do not effect other connections.</p>
</div>
<div class="section" id="exporting-the-contents-of-a-database">
<h2>Exporting the Contents of a Database<a class="headerlink" href="#exporting-the-contents-of-a-database" title="Permalink to this headline">¶</a></h2>
<p>The contents of an in-memory database can be saved using the
<code class="docutils literal notranslate"><span class="pre">iterdump()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Connection</span></code>.  The iterator
returned by <code class="docutils literal notranslate"><span class="pre">iterdump()</span></code> produces a series of strings that
together build SQL instructions to recreate the state of the database.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">sqlite3_iterdump.py</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">schema_filename</span> <span class="o">=</span> <span class="s1">&#39;todo_schema.sql&#39;</span>

<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating schema&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inserting initial data&#39;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into project (name, description, deadline)</span>
<span class="s2">    values (&#39;pymotw&#39;, &#39;Python Module of the Week&#39;,</span>
<span class="s2">            &#39;2010-11-01&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;write about select&#39;</span><span class="p">,</span> <span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-10-03&#39;</span><span class="p">,</span>
         <span class="s1">&#39;pymotw&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;write about random&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-10-10&#39;</span><span class="p">,</span>
         <span class="s1">&#39;pymotw&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;write about sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-10-17&#39;</span><span class="p">,</span>
         <span class="s1">&#39;pymotw&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into task (details, status, deadline, project)</span>
<span class="s2">    values (?, ?, ?, ?)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dumping:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">iterdump</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">iterdump()</span></code> can also be used with databases saved to files, but
it is most useful for preserving a database that would not otherwise
be saved.  This output has been edited to fit on the page while
remaining syntactically correct.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_iterdump.py

Creating schema
Inserting initial data
Dumping:
BEGIN TRANSACTION;
CREATE TABLE project (
    name        text primary key,
    description text,
    deadline    date
);
INSERT INTO &quot;project&quot; VALUES(&#39;pymotw&#39;,&#39;Python Module of the
Week&#39;,&#39;2010-11-01&#39;);
DELETE FROM &quot;sqlite_sequence&quot;;
INSERT INTO &quot;sqlite_sequence&quot; VALUES(&#39;task&#39;,3);
CREATE TABLE task (
    id           integer primary key autoincrement not null,
    priority     integer default 1,
    details      text,
    status       text,
    deadline     date,
    completed_on date,
    project      text not null references project(name)
);
INSERT INTO &quot;task&quot; VALUES(1,1,&#39;write about
select&#39;,&#39;done&#39;,&#39;2010-10-03&#39;,NULL,&#39;pymotw&#39;);
INSERT INTO &quot;task&quot; VALUES(2,1,&#39;write about
random&#39;,&#39;waiting&#39;,&#39;2010-10-10&#39;,NULL,&#39;pymotw&#39;);
INSERT INTO &quot;task&quot; VALUES(3,1,&#39;write about
sqlite3&#39;,&#39;active&#39;,&#39;2010-10-17&#39;,NULL,&#39;pymotw&#39;);
COMMIT;
</pre></div>
</div>
</div>
<div class="section" id="using-python-functions-in-sql">
<h2>Using Python Functions in SQL<a class="headerlink" href="#using-python-functions-in-sql" title="Permalink to this headline">¶</a></h2>
<p>SQL syntax supports calling functions during queries, either in
the column list or <code class="docutils literal notranslate"><span class="pre">where</span></code> clause of the <code class="docutils literal notranslate"><span class="pre">select</span></code>
statement.  This feature makes it possible to process data before
returning it from the query, and can be used to convert between
different formats, perform calculations that would be clumsy in pure
SQL, and reuse application code.</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">sqlite3_create_function.py</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Encrypting </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;rot-13&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decrypting </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;rot-13&#39;</span><span class="p">)</span>


<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="s1">&#39;encrypt&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">encrypt</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="s1">&#39;decrypt&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">decrypt</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="c1"># Raw values</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original values:&#39;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select id, details from task&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Encrypting...&#39;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update task set details = encrypt(details)&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Raw encrypted values:&#39;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select id, details from task&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Decrypting in query...&#39;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;select id, decrypt(details) from task&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Decrypting...&#39;</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;update task set details = decrypt(details)&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Functions are exposed using the <code class="docutils literal notranslate"><span class="pre">create_function()</span></code> method of the
<code class="docutils literal notranslate"><span class="pre">Connection</span></code>.  The parameters are the name of the function (as
it should be used from within SQL), the number of arguments the
function takes, and the Python function to expose.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_create_function.py

Original values:
(1, &#39;write about select&#39;)
(2, &#39;write about random&#39;)
(3, &#39;write about sqlite3&#39;)
(4, &#39;finish reviewing markup&#39;)
(5, &#39;revise chapter intros&#39;)
(6, &#39;subtitle&#39;)

Encrypting...
Encrypting &#39;write about select&#39;
Encrypting &#39;write about random&#39;
Encrypting &#39;write about sqlite3&#39;
Encrypting &#39;finish reviewing markup&#39;
Encrypting &#39;revise chapter intros&#39;
Encrypting &#39;subtitle&#39;

Raw encrypted values:
(1, &#39;jevgr nobhg fryrpg&#39;)
(2, &#39;jevgr nobhg enaqbz&#39;)
(3, &#39;jevgr nobhg fdyvgr3&#39;)
(4, &#39;svavfu erivrjvat znexhc&#39;)
(5, &#39;erivfr puncgre vagebf&#39;)
(6, &#39;fhogvgyr&#39;)

Decrypting in query...
Decrypting &#39;jevgr nobhg fryrpg&#39;
Decrypting &#39;jevgr nobhg enaqbz&#39;
Decrypting &#39;jevgr nobhg fdyvgr3&#39;
Decrypting &#39;svavfu erivrjvat znexhc&#39;
Decrypting &#39;erivfr puncgre vagebf&#39;
Decrypting &#39;fhogvgyr&#39;
(1, &#39;write about select&#39;)
(2, &#39;write about random&#39;)
(3, &#39;write about sqlite3&#39;)
(4, &#39;finish reviewing markup&#39;)
(5, &#39;revise chapter intros&#39;)
(6, &#39;subtitle&#39;)

Decrypting...
Decrypting &#39;jevgr nobhg fryrpg&#39;
Decrypting &#39;jevgr nobhg enaqbz&#39;
Decrypting &#39;jevgr nobhg fdyvgr3&#39;
Decrypting &#39;svavfu erivrjvat znexhc&#39;
Decrypting &#39;erivfr puncgre vagebf&#39;
Decrypting &#39;fhogvgyr&#39;
</pre></div>
</div>
</div>
<div class="section" id="querying-with-regular-expressions">
<h2>Querying with Regular Expressions<a class="headerlink" href="#querying-with-regular-expressions" title="Permalink to this headline">¶</a></h2>
<p>Sqlite supports several special user functions that are associated
with SQL syntax. For example, a function <code class="docutils literal notranslate"><span class="pre">regexp</span></code> can be used in a
query to check if a column’s string value matches a regular expression
using the following syntax.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">table</span>
<span class="k">WHERE</span> <span class="k">column</span> <span class="n">REGEXP</span> <span class="s1">&#39;.*pattern.*&#39;</span>
</pre></div>
</div>
<p>This examples associates a function with <code class="docutils literal notranslate"><span class="pre">regexp()</span></code> to test values
using Python’s <a class="reference internal" href="../re/index.html#module-re" title="re: Searching within and changing text using formal patterns."><code class="xref py py-mod docutils literal notranslate"><span class="pre">re</span></code></a> module.</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">sqlite3_regex.py</span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">regexp</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>


<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="s1">&#39;regexp&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">regexp</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;.*[wW]rite [aA]bout.*&#39;</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        select id, priority, details, status, deadline from task</span>
<span class="sd">        where details regexp :pattern</span>
<span class="sd">        order by deadline, priority</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="n">pattern</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span> <span class="o">=</span> <span class="n">row</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2d}</span><span class="s1"> [</span><span class="si">{:d}</span><span class="s1">] </span><span class="si">{:&lt;25}</span><span class="s1"> [</span><span class="si">{:&lt;8}</span><span class="s1">] (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">task_id</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">deadline</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The output is all of the tasks where the details column matches the
pattern.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_regex.py

 1 [9] write about select        [done    ] (2016-04-25)
 2 [9] write about random        [done    ] (2016-08-22)
 3 [9] write about sqlite3       [active  ] (2017-07-31)
</pre></div>
</div>
</div>
<div class="section" id="custom-aggregation">
<h2>Custom Aggregation<a class="headerlink" href="#custom-aggregation" title="Permalink to this headline">¶</a></h2>
<p>An aggregation function collects many pieces of individual data and
summarizes it in some way.  Examples of built-in aggregation functions
are <code class="docutils literal notranslate"><span class="pre">avg()</span></code> (average), <code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">count()</span></code>.</p>
<p>The API for aggregators used by <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> is defined in terms of
a class with two methods.  The <code class="docutils literal notranslate"><span class="pre">step()</span></code> method is called once for
each data value as the query is processed.  The <code class="docutils literal notranslate"><span class="pre">finalize()</span></code>
method is called one time at the end of the query and should return
the aggregate value.  This example implements an aggregator for the
arithmetic <em>mode</em>.  It returns the value that appears most frequently
in the input.</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">sqlite3_create_aggregate.py</span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">class</span> <span class="nc">Mode</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step(</span><span class="si">{!r}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;finalize() -&gt; </span><span class="si">{!r}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> times)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">create_aggregate</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select mode(deadline) from task where project = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mode(deadline) is:&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The aggregator class is registered with the <code class="docutils literal notranslate"><span class="pre">create_aggregate()</span></code>
method of the <code class="docutils literal notranslate"><span class="pre">Connection</span></code>.  The parameters are the name of the
function (as it should be used from within SQL), the number of
arguments the <code class="docutils literal notranslate"><span class="pre">step()</span></code> method takes, and the class to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_create_aggregate.py

step(&#39;2016-04-25&#39;)
step(&#39;2016-08-22&#39;)
step(&#39;2017-07-31&#39;)
step(&#39;2016-11-30&#39;)
step(&#39;2016-08-20&#39;)
step(&#39;2016-11-01&#39;)
finalize() -&gt; &#39;2016-11-01&#39; (1 times)
mode(deadline) is: 2016-11-01
</pre></div>
</div>
</div>
<div class="section" id="threading-and-connection-sharing">
<h2>Threading and Connection Sharing<a class="headerlink" href="#threading-and-connection-sharing" title="Permalink to this headline">¶</a></h2>
<p>For historical reasons having to do with old versions of SQLite,
<code class="docutils literal notranslate"><span class="pre">Connection</span></code> objects cannot be shared between threads.  Each
thread must create its own connection to the database.</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">sqlite3_threading.py</span><a class="headerlink" href="#id24" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>
<span class="n">isolation_level</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># autocommit mode</span>


<span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting thread&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from task&#39;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;results fetched&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">,</span>
                         <span class="n">isolation_level</span><span class="o">=</span><span class="n">isolation_level</span><span class="p">,</span>
                         <span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Reader 1&#39;</span><span class="p">,</span>
                             <span class="n">target</span><span class="o">=</span><span class="n">reader</span><span class="p">,</span>
                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">conn</span><span class="p">,),</span>
                             <span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Attempts to share a connection between threads result in an exception.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_threading.py

Starting thread
ERROR: SQLite objects created in a thread can only be used in that
same thread.The object was created in thread id 140735234088960
and this is thread id 123145307557888
</pre></div>
</div>
</div>
<div class="section" id="restricting-access-to-data">
<h2>Restricting Access to Data<a class="headerlink" href="#restricting-access-to-data" title="Permalink to this headline">¶</a></h2>
<p>Although SQLite does not have user access controls found in other,
larger, relational databases, it does have a mechanism for limiting
access to columns.  Each connection can install an <em>authorizer
function</em> to grant or deny access to columns at runtime based on any
desired criteria.  The authorizer function is invoked during the
parsing of SQL statements, and is passed five arguments.  The first is
an action code indicating the type of operation being performed
(reading, writing, deleting, etc.).  The rest of the arguments depend
on the action code.  For <code class="docutils literal notranslate"><span class="pre">SQLITE_READ</span></code> operations, the
arguments are the name of the table, the name of the column, the
location in the SQL where the access is occurring (main query, trigger,
etc.), and <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">sqlite3_set_authorizer.py</span><a class="headerlink" href="#id25" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;todo.db&#39;</span>


<span class="k">def</span> <span class="nf">authorizer_func</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sql_location</span><span class="p">,</span> <span class="n">ignore</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">authorizer_func(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">action</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sql_location</span><span class="p">,</span> <span class="n">ignore</span><span class="p">))</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">SQLITE_OK</span>  <span class="c1"># be permissive by default</span>

    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">SQLITE_SELECT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;requesting permission to run a select statement&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">SQLITE_OK</span>

    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">SQLITE_READ</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;requesting access to column </span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1"> from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">sql_location</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;details&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  ignoring details column&#39;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">SQLITE_IGNORE</span>
        <span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;priority&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  preventing access to priority column&#39;</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">SQLITE_DENY</span>

    <span class="k">return</span> <span class="n">response</span>


<span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">set_authorizer</span><span class="p">(</span><span class="n">authorizer_func</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using SQLITE_IGNORE to mask a column value:&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, details from task where project = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Using SQLITE_DENY to deny access to a column:&#39;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select id, priority from task where project = &#39;pymotw&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>This example uses <code class="docutils literal notranslate"><span class="pre">SQLITE_IGNORE</span></code> to cause the strings from the
<code class="docutils literal notranslate"><span class="pre">task.details</span></code> column to be replaced with null values in the query
results.  It also prevents all access to the <code class="docutils literal notranslate"><span class="pre">task.priority</span></code> column
by returning <code class="docutils literal notranslate"><span class="pre">SQLITE_DENY</span></code>, which in turn causes SQLite to
raise an exception.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 sqlite3_set_authorizer.py

Using SQLITE_IGNORE to mask a column value:

authorizer_func(21, None, None, None, None)
requesting permission to run a select statement

authorizer_func(20, task, id, main, None)
requesting access to column task.id from main

authorizer_func(20, task, details, main, None)
requesting access to column task.details from main
  ignoring details column

authorizer_func(20, task, project, main, None)
requesting access to column task.project from main
1 None
2 None
3 None
4 None
5 None
6 None

Using SQLITE_DENY to deny access to a column:

authorizer_func(21, None, None, None, None)
requesting permission to run a select statement

authorizer_func(20, task, id, main, None)
requesting access to column task.id from main

authorizer_func(20, task, priority, main, None)
requesting access to column task.priority from main
  preventing access to priority column
Traceback (most recent call last):
  File &quot;sqlite3_set_authorizer.py&quot;, line 53, in &lt;module&gt;
    &quot;&quot;&quot;)
sqlite3.DatabaseError: access to task.priority is prohibited
</pre></div>
</div>
<p>The possible action codes are available as constants in
<code class="docutils literal notranslate"><span class="pre">sqlite3</span></code>, with names prefixed <code class="docutils literal notranslate"><span class="pre">SQLITE_</span></code>.  Each type of SQL
statement can be flagged, and access to individual columns can be
controlled as well.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/sqlite3.html">Standard library documentation for sqlite3</a></li>
<li><span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0249"><strong>PEP 249</strong></a> – DB API 2.0 Specification (A standard interface for
modules that provide access to relational databases.)</li>
<li><a class="reference external" href="http://www.sqlite.org/">SQLite</a> – The official site of the SQLite library.</li>
<li><a class="reference internal" href="../shelve/index.html#module-shelve" title="shelve: Persistent storage of objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">shelve</span></code></a> – Key-value store for saving arbitrary Python objects.</li>
<li><a class="reference external" href="http://sqlalchemy.org/">SQLAlchemy</a> – A popular object-relational mapper that supports
SQLite among many other relational databases.</li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../dbm/index.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> dbm — Unix Key-Value Databases</a>
<a id="next-link" href="../xml.etree.ElementTree/index.html"
   title="next chapter">xml.etree.ElementTree — XML Manipulation API <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#creating-a-database"><i class="fa fa-caret-right"></i>Creating a Database</a></li>
    
    <li><a href="#retrieving-data"><i class="fa fa-caret-right"></i>Retrieving Data</a></li>
    
    <li><a href="#query-metadata"><i class="fa fa-caret-right"></i>Query Metadata</a></li>
    
    <li><a href="#row-objects"><i class="fa fa-caret-right"></i>Row Objects</a></li>
    
    <li><a href="#using-variables-with-queries"><i class="fa fa-caret-right"></i>Using Variables with Queries</a></li>
    
    <li><a href="#positional-parameters"><i class="fa fa-caret-right"></i>Positional Parameters</a></li>
    
    <li><a href="#named-parameters"><i class="fa fa-caret-right"></i>Named Parameters</a></li>
    
    <li><a href="#bulk-loading"><i class="fa fa-caret-right"></i>Bulk Loading</a></li>
    
    <li><a href="#defining-new-column-types"><i class="fa fa-caret-right"></i>Defining New Column Types</a></li>
    
    <li><a href="#determining-types-for-columns"><i class="fa fa-caret-right"></i>Determining Types for Columns</a></li>
    
    <li><a href="#transactions"><i class="fa fa-caret-right"></i>Transactions</a></li>
    
    <li><a href="#preserving-changes"><i class="fa fa-caret-right"></i>Preserving Changes</a></li>
    
    <li><a href="#discarding-changes"><i class="fa fa-caret-right"></i>Discarding Changes</a></li>
    
    <li><a href="#isolation-levels"><i class="fa fa-caret-right"></i>Isolation Levels</a></li>
    
    <li><a href="#deferred"><i class="fa fa-caret-right"></i>Deferred</a></li>
    
    <li><a href="#immediate"><i class="fa fa-caret-right"></i>Immediate</a></li>
    
    <li><a href="#exclusive"><i class="fa fa-caret-right"></i>Exclusive</a></li>
    
    <li><a href="#autocommit"><i class="fa fa-caret-right"></i>Autocommit</a></li>
    
    <li><a href="#in-memory-databases"><i class="fa fa-caret-right"></i>In-Memory Databases</a></li>
    
    <li><a href="#exporting-the-contents-of-a-database"><i class="fa fa-caret-right"></i>Exporting the Contents of a Database</a></li>
    
    <li><a href="#using-python-functions-in-sql"><i class="fa fa-caret-right"></i>Using Python Functions in SQL</a></li>
    
    <li><a href="#querying-with-regular-expressions"><i class="fa fa-caret-right"></i>Querying with Regular Expressions</a></li>
    
    <li><a href="#custom-aggregation"><i class="fa fa-caret-right"></i>Custom Aggregation</a></li>
    
    <li><a href="#threading-and-connection-sharing"><i class="fa fa-caret-right"></i>Threading and Connection Sharing</a></li>
    
    <li><a href="#restricting-access-to-data"><i class="fa fa-caret-right"></i>Restricting Access to Data</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2017-01-06.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../dbm/index.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>dbm — Unix Key-Value Databases</a></li>
    <li><a href="../xml.etree.ElementTree/index.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>xml.etree.ElementTree — XML Manipulation API</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAf5QTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gJCQkKCUmKCgoKCkoKSkpKSopKicnKioqLS0tMDAwMS0uMjExMjMxNTY1Pj8+Pzc5Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgY19haGVmbmxscHBwcHJvdXJzdnN0eHV2eXx5en15fH98fX98fnt8f4F+gICAgoWChIGChIWEhIaEh4aHiYyJjIqLjoeLj4+PkY+PkZORkZSRk5iTlZmUlpmWmJaXmpiZnp2dnqCdn5aan5+fn6Oeoqaho6Gho6ijpqqmq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbewsrexsrixs7iytLmztLqztbW1tbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIycjIyc3Iyc3Jys3Jy8rLy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4N/g4+Pj6Ofn7+/v8fHx////rrSdFQAAAAN0Uk5TAAoO5yEBUwAAA+FJREFUSMe1lo9301QUx6uXUmaf0qJ26iTrRoVinUzjQNR1gAyH6Lqx6XTDoVvXbU7qhA5m7CgYWaTDlLa6AiFsba3t+y+9Sdr8OvVMi7zTnLTf5H7ee9/73n11PA1PpDkcADPRWPwKt8YLG2I2n89m7gh8iluJz0dnpqe+HBsdHRn+7w3JyF1cvpbk05mCJG8Xi9uPpMLdNJ9cXV5UyBNjoyMtkR2A3B9Tt8SCfLTTqUzC2XlMvpcRbnA/IPmryYnzoyM9XuWBt8eI21FBcAy5Qk4KtxkGtQ1I+fRNbnk+evHC5NhJDwATDDIAnhNa1ImdFQTHr6WEvNyFPFeATSTYgAu/dl3/I31jNR6bnZ76eDf4yxRb2Q+71aiz/0JB8JXkrZzCdbFVqrUhRHuu54XkytLczAUvBFADUB6ARwnyqEp/t02prK9XdAXBHC9KyPWVqd6qPhyzlOG55dhsL/hLDTD1A3rYAy+dRu6eXaGKruA75wi2hbqigNd+LYSRW6XUSh64l05dXYruA1OPZfAOD3vhObL/ILDvQkRXynSdvPpaiJB+TVHAfEZuA9d9amlVF7TJd3nu+xgwyu8AqNOnDGAM8/obOLhQpWQotPYReZ/SQdKuKQpY2DwKwFJbGwI4VhCSlxchSFUnNC+CCgaV9RAKoZKh1J4le9FmQv5SFQW88aATXGhEws8wrHb7AANc0CndQS+ag5ERaieke0FXvnkxoYL/1MGi7FSmmVBXMDOu3gLK5J2PMjdXv2tmBX6pDdKSkq39DWXh3G1KI4QYVmS3AHCIPnCXE+4hHy6PcfeQ6sV2lufiL2jJ0wasp4p2k/Z2CEXeeqahDBLS1/c8+dBIXq4IkFAiWQ1QtxtnUMz/wsXfBj+1LzdUKn17dvXXzEqfMoFDNWO57QCe22dskKB5g7zXbVN+i0RKumKxonrfzaIVys2wYu7TVrd0PXn1rOnJC4JTFjF5c19/gnXLFwj6jJJz1rOjoi63LnBRfbmNM+qNunG5baSufhu9OPX5my2VTWEzrHrRbIP8dHl+dnpyrIVDBME/q1u6/E9bGmt9i2AsQmeaFaFwIb22soSlfuL8SEtgOCJKB5BsKkNltWyK7zzWMY3X4exDc6GvsljoX5FzR+BxwdCbf3jAdjTJv5/S39H2B2iXpmgXpWB7iVrB0JuVzpgP07CUO2WKqX+oiVL/benKImhgOIzHf7hx/A/IBdHsQ6Nsmruilo4afVFqB8PLn2U2H8hbxeKWjH9YvuiwxNiMaNhALZptCg5d7zh+Sczmclnx0vEOax6ajdjucSMPTcD/97/Cp54Q929ZZbgcR3o0hAAAAABJRU5ErkJggg=="/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>