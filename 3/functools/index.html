<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>functools — Tools for Manipulating Functions &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="https://feeds.feedburner.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="https://feeds.feedburner.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@pymotw" />
    <meta name="twitter:title" content="functools — Tools for Manipulating Functions" />
    <meta name="twitter:image" content="https://pymotw.com/3/_static/logo-large.png" />

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../algorithm_tools.html"><i class="fa fa-arrow-circle-up"></i> Algorithms</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-functools">
<span id="functools-tools-for-manipulating-functions"></span><h1>functools — Tools for Manipulating Functions<a class="headerlink" href="#module-functools" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Functions that operate on other functions.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">functools</span></code> module provides tools for adapting or extending
functions and other callable objects, without completely rewriting
them.</p>
<div class="section" id="decorators">
<h2>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h2>
<p>The primary tool supplied by the <code class="docutils literal notranslate"><span class="pre">functools</span></code> module is the class
<code class="docutils literal notranslate"><span class="pre">partial</span></code>, which can be used to “wrap” a callable object with
default arguments. The resulting object is itself callable and can be
treated as though it is the original function.  It takes all of the
same arguments as the original, and can be invoked with extra
positional or named arguments as well.  A <code class="docutils literal notranslate"><span class="pre">partial</span></code> can be used
instead of a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> to provide default arguments to a
function, while leaving some arguments unspecified.</p>
<div class="section" id="partial-objects">
<h3>Partial Objects<a class="headerlink" href="#partial-objects" title="Permalink to this headline">¶</a></h3>
<p>This example shows two simple <code class="docutils literal notranslate"><span class="pre">partial</span></code> objects for the
function <code class="docutils literal notranslate"><span class="pre">myfunc()</span></code>.  The output of <code class="docutils literal notranslate"><span class="pre">show_details()</span></code> includes
the <code class="xref py py-attr docutils literal notranslate"><span class="pre">func</span></code>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code>, and <code class="xref py py-attr docutils literal notranslate"><span class="pre">keywords</span></code> attributes of the
partial object.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">functools_partial.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s2">&quot;Docstring for myfunc().&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  called myfunc with:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">is_partial</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Show details of a callable object.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  object:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_partial</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __name__:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_partial</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  func:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  args:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  keywords:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
    <span class="k">return</span>


<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;myfunc&#39;</span><span class="p">,</span> <span class="n">myfunc</span><span class="p">)</span>
<span class="n">myfunc</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Set a different default value for &#39;b&#39;, but require</span>
<span class="c1"># the caller to provide &#39;a&#39;.</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;partial with named default&#39;</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">p1</span><span class="p">(</span><span class="s1">&#39;passing a&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="p">(</span><span class="s1">&#39;override b&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Set default values for both &#39;a&#39; and &#39;b&#39;.</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="s1">&#39;default a&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;partial with defaults&#39;</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">p2</span><span class="p">()</span>
<span class="n">p2</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;override b&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Insufficient arguments:&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>At the end of the example, the first <code class="docutils literal notranslate"><span class="pre">partial</span></code> created is
invoked without passing a value for <code class="docutils literal notranslate"><span class="pre">a</span></code>, causing an exception.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_partial.py

myfunc:
  object: &lt;function myfunc at 0x1007a6a60&gt;
  __name__: myfunc
  called myfunc with: (&#39;a&#39;, 3)

partial with named default:
  object: functools.partial(&lt;function myfunc at 0x1007a6a60&gt;,
b=4)
  func: &lt;function myfunc at 0x1007a6a60&gt;
  args: ()
  keywords: {&#39;b&#39;: 4}
  called myfunc with: (&#39;passing a&#39;, 4)
  called myfunc with: (&#39;override b&#39;, 5)

partial with defaults:
  object: functools.partial(&lt;function myfunc at 0x1007a6a60&gt;,
&#39;default a&#39;, b=99)
  func: &lt;function myfunc at 0x1007a6a60&gt;
  args: (&#39;default a&#39;,)
  keywords: {&#39;b&#39;: 99}
  called myfunc with: (&#39;default a&#39;, 99)
  called myfunc with: (&#39;default a&#39;, &#39;override b&#39;)

Insufficient arguments:
Traceback (most recent call last):
  File &quot;functools_partial.py&quot;, line 51, in &lt;module&gt;
    p1()
TypeError: myfunc() missing 1 required positional argument: &#39;a&#39;
</pre></div>
</div>
</div>
<div class="section" id="acquiring-function-properties">
<h3>Acquiring Function Properties<a class="headerlink" href="#acquiring-function-properties" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">partial</span></code> object does not have <code class="xref py py-attr docutils literal notranslate"><span class="pre">__name__</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">__doc__</span></code>
attributes by default, and without those attributes, decorated
functions are more difficult to debug. Using <code class="docutils literal notranslate"><span class="pre">update_wrapper()</span></code>,
copies or adds attributes from the original function to the
<code class="docutils literal notranslate"><span class="pre">partial</span></code> object.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">functools_update_wrapper.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s2">&quot;Docstring for myfunc().&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  called myfunc with:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Show details of a callable object.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  object:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __name__:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(no __name__)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __doc__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>


<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;myfunc&#39;</span><span class="p">,</span> <span class="n">myfunc</span><span class="p">)</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;raw wrapper&#39;</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updating wrapper:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  assign:&#39;</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">WRAPPER_ASSIGNMENTS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  update:&#39;</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">WRAPPER_UPDATES</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">myfunc</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;updated wrapper&#39;</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The attributes added to the wrapper are defined in
<code class="docutils literal notranslate"><span class="pre">WRAPPER_ASSIGNMENTS</span></code>, while <code class="docutils literal notranslate"><span class="pre">WRAPPER_UPDATES</span></code> lists
values to be modified.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_update_wrapper.py

myfunc:
  object: &lt;function myfunc at 0x1018a6a60&gt;
  __name__: myfunc
  __doc__ &#39;Docstring for myfunc().&#39;

raw wrapper:
  object: functools.partial(&lt;function myfunc at 0x1018a6a60&gt;,
b=4)
  __name__: (no __name__)
  __doc__ &#39;partial(func, *args, **keywords) - new function with
partial application\n    of the given arguments and keywords.\n&#39;

Updating wrapper:
  assign: (&#39;__module__&#39;, &#39;__name__&#39;, &#39;__qualname__&#39;, &#39;__doc__&#39;,
&#39;__annotations__&#39;)
  update: (&#39;__dict__&#39;,)

updated wrapper:
  object: functools.partial(&lt;function myfunc at 0x1018a6a60&gt;,
b=4)
  __name__: myfunc
  __doc__ &#39;Docstring for myfunc().&#39;
</pre></div>
</div>
</div>
<div class="section" id="other-callables">
<h3>Other Callables<a class="headerlink" href="#other-callables" title="Permalink to this headline">¶</a></h3>
<p>Partials work with any callable object, not just with standalone functions.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">functools_callable.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="s2">&quot;Demonstration class for functools&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="s2">&quot;Docstring for MyClass.__call__&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  called object with:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Show details of a callable object.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  object:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __name__:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(no __name__)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __doc__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="k">return</span>


<span class="n">o</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>

<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
<span class="n">o</span><span class="p">(</span><span class="s1">&#39;e goes here&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="s1">&#39;default for e&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;instance wrapper&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>This example creates partials from an instance of a class with a
<code class="docutils literal notranslate"><span class="pre">__call__()</span></code> method.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_callable.py

instance:
  object: &lt;__main__.MyClass object at 0x1011b1cf8&gt;
  __name__: (no __name__)
  __doc__ &#39;Demonstration class for functools&#39;
  called object with: (&lt;__main__.MyClass object at 0x1011b1cf8&gt;,
&#39;e goes here&#39;, 6)

instance wrapper:
  object: functools.partial(&lt;__main__.MyClass object at
0x1011b1cf8&gt;, f=8, e=&#39;default for e&#39;)
  __name__: (no __name__)
  __doc__ &#39;Demonstration class for functools&#39;
  called object with: (&lt;__main__.MyClass object at 0x1011b1cf8&gt;,
&#39;default for e&#39;, 8)
</pre></div>
</div>
</div>
<div class="section" id="methods-and-functions">
<h3>Methods and Functions<a class="headerlink" href="#methods-and-functions" title="Permalink to this headline">¶</a></h3>
<p>While <code class="docutils literal notranslate"><span class="pre">partial()</span></code> returns a callable ready to be used directly,
<code class="docutils literal notranslate"><span class="pre">partialmethod()</span></code> returns a callable ready to be used as an
unbound method of an object. In the following example, the same
standalone function is added as an attribute of <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> twice,
once using <code class="docutils literal notranslate"><span class="pre">partialmethod()</span></code> as <code class="docutils literal notranslate"><span class="pre">method1()</span></code> and again using
<code class="docutils literal notranslate"><span class="pre">partial()</span></code> as <code class="docutils literal notranslate"><span class="pre">method2()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">functools_partialmethod.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">standalone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s2">&quot;Standalone function&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  called standalone with:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  self.attr =&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="s2">&quot;Demonstration class for functools&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;instance attribute&#39;</span>

    <span class="n">method1</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partialmethod</span><span class="p">(</span><span class="n">standalone</span><span class="p">)</span>
    <span class="n">method2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">standalone</span><span class="p">)</span>


<span class="n">o</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;standalone&#39;</span><span class="p">)</span>
<span class="n">standalone</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;method1 as partialmethod&#39;</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">method1</span><span class="p">()</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;method2 as partial&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">o</span><span class="o">.</span><span class="n">method2</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">method1()</span></code> can be called from an instance of <code class="docutils literal notranslate"><span class="pre">MyClass</span></code>, and the
instance is passed as the first argument just as with methods defined
normally. <code class="docutils literal notranslate"><span class="pre">method2()</span></code> is not set up as a bound method, and so the
<code class="docutils literal notranslate"><span class="pre">self</span></code> argument must be passed explicitly, or the call will result
in a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_partialmethod.py

standalone
  called standalone with: (None, 1, 2)

method1 as partialmethod
  called standalone with: (&lt;__main__.MyClass object at
0x1007b1d30&gt;, 1, 2)
  self.attr = instance attribute

method2 as partial
ERROR: standalone() missing 1 required positional argument:
&#39;self&#39;
</pre></div>
</div>
</div>
<div class="section" id="acquiring-function-properties-for-decorators">
<h3>Acquiring Function Properties for Decorators<a class="headerlink" href="#acquiring-function-properties-for-decorators" title="Permalink to this headline">¶</a></h3>
<p>Updating the properties of a wrapped callable is especially useful
when used in a decorator, since the transformed function ends up with
properties of the original “bare” function.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">functools_wraps.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">show_details</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Show details of a callable object.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  object:&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __name__:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(no __name__)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  __doc__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">simple_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;decorated defaults&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  decorated:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>


<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s2">&quot;myfunc() is not complicated&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  myfunc:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span>


<span class="c1"># The raw function</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;myfunc&#39;</span><span class="p">,</span> <span class="n">myfunc</span><span class="p">)</span>
<span class="n">myfunc</span><span class="p">(</span><span class="s1">&#39;unwrapped, default b&#39;</span><span class="p">)</span>
<span class="n">myfunc</span><span class="p">(</span><span class="s1">&#39;unwrapped, passing b&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Wrap explicitly</span>
<span class="n">wrapped_myfunc</span> <span class="o">=</span> <span class="n">simple_decorator</span><span class="p">(</span><span class="n">myfunc</span><span class="p">)</span>
<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;wrapped_myfunc&#39;</span><span class="p">,</span> <span class="n">wrapped_myfunc</span><span class="p">)</span>
<span class="n">wrapped_myfunc</span><span class="p">()</span>
<span class="n">wrapped_myfunc</span><span class="p">(</span><span class="s1">&#39;args to wrapped&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>


<span class="c1"># Wrap with decorator syntax</span>
<span class="nd">@simple_decorator</span>
<span class="k">def</span> <span class="nf">decorated_myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span>


<span class="n">show_details</span><span class="p">(</span><span class="s1">&#39;decorated_myfunc&#39;</span><span class="p">,</span> <span class="n">decorated_myfunc</span><span class="p">)</span>
<span class="n">decorated_myfunc</span><span class="p">()</span>
<span class="n">decorated_myfunc</span><span class="p">(</span><span class="s1">&#39;args to decorated&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">functools</span></code> provides a decorator, <code class="docutils literal notranslate"><span class="pre">wraps()</span></code>, that applies
<code class="docutils literal notranslate"><span class="pre">update_wrapper()</span></code> to the decorated function.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_wraps.py

myfunc:
  object: &lt;function myfunc at 0x101241b70&gt;
  __name__: myfunc
  __doc__ &#39;myfunc() is not complicated&#39;

  myfunc: (&#39;unwrapped, default b&#39;, 2)
  myfunc: (&#39;unwrapped, passing b&#39;, 3)

wrapped_myfunc:
  object: &lt;function myfunc at 0x1012e62f0&gt;
  __name__: myfunc
  __doc__ &#39;myfunc() is not complicated&#39;

  decorated: (&#39;decorated defaults&#39;, 1)
     myfunc: (&#39;decorated defaults&#39;, 1)
  decorated: (&#39;args to wrapped&#39;, 4)
     myfunc: (&#39;args to wrapped&#39;, 4)

decorated_myfunc:
  object: &lt;function decorated_myfunc at 0x1012e6400&gt;
  __name__: decorated_myfunc
  __doc__ None

  decorated: (&#39;decorated defaults&#39;, 1)
     myfunc: (&#39;decorated defaults&#39;, 1)
  decorated: (&#39;args to decorated&#39;, 4)
     myfunc: (&#39;args to decorated&#39;, 4)
</pre></div>
</div>
</div>
</div>
<div class="section" id="comparison">
<h2>Comparison<a class="headerlink" href="#comparison" title="Permalink to this headline">¶</a></h2>
<p>Under Python 2, classes could define a <code class="docutils literal notranslate"><span class="pre">__cmp__()</span></code> method that
returns <code class="docutils literal notranslate"><span class="pre">-1</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, or <code class="docutils literal notranslate"><span class="pre">1</span></code> based on whether the object is less
than, equal to, or greater than the item being compared.  Python 2.1
introduced the <em>rich comparison</em> methods API (<code class="docutils literal notranslate"><span class="pre">__lt__()</span></code>,
<code class="docutils literal notranslate"><span class="pre">__le__()</span></code>, <code class="docutils literal notranslate"><span class="pre">__eq__()</span></code>, <code class="docutils literal notranslate"><span class="pre">__ne__()</span></code>, <code class="docutils literal notranslate"><span class="pre">__gt__()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">__ge__()</span></code>), which perform a single comparison operation and return
a boolean value.  Python 3 deprecated <code class="docutils literal notranslate"><span class="pre">__cmp__()</span></code> in favor of
these new methods and <code class="docutils literal notranslate"><span class="pre">functools</span></code> provides tools to make it
easier to write classes that comply with the new comparison
requirements in Python 3.</p>
<div class="section" id="rich-comparison">
<h3>Rich Comparison<a class="headerlink" href="#rich-comparison" title="Permalink to this headline">¶</a></h3>
<p>The rich comparison API is designed to allow classes with complex
comparisons to implement each test in the most efficient way possible.
However, for classes where comparison is relatively simple, there is
no point in manually creating each of the rich comparison methods.
The <code class="docutils literal notranslate"><span class="pre">total_ordering()</span></code> class decorator takes a class that provides
some of the methods, and adds the rest of them.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">functools_total_ordering.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">total_ordering</span>
<span class="k">class</span> <span class="nc">MyObject</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  testing __eq__(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">val</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  testing __gt__(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">val</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Methods:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">MyObject</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">))</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Comparisons:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a &lt; b&#39;</span><span class="p">,</span> <span class="s1">&#39;a &lt;= b&#39;</span><span class="p">,</span> <span class="s1">&#39;a == b&#39;</span><span class="p">,</span> <span class="s1">&#39;a &gt;= b&#39;</span><span class="p">,</span> <span class="s1">&#39;a &gt; b&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{:&lt;6}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  result of </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The class must provide implementation of <code class="docutils literal notranslate"><span class="pre">__eq__()</span></code> and one other
rich comparison method.  The decorator adds implementations of the
rest of the methods that work by using the comparisons provided. If a
comparison cannot be made, the method should return <code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code>
so the comparison can be tried using the reverse comparison operators
on the other object, before failing entirely.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_total_ordering.py

Methods:

[(&#39;__eq__&#39;, &lt;function MyObject.__eq__ at 0x10139a488&gt;),
 (&#39;__ge__&#39;, &lt;function _ge_from_gt at 0x1012e2510&gt;),
 (&#39;__gt__&#39;, &lt;function MyObject.__gt__ at 0x10139a510&gt;),
 (&#39;__init__&#39;, &lt;function MyObject.__init__ at 0x10139a400&gt;),
 (&#39;__le__&#39;, &lt;function _le_from_gt at 0x1012e2598&gt;),
 (&#39;__lt__&#39;, &lt;function _lt_from_gt at 0x1012e2488&gt;)]

Comparisons:

a &lt; b :
  testing __gt__(1, 2)
  testing __eq__(1, 2)
  result of a &lt; b: True

a &lt;= b:
  testing __gt__(1, 2)
  result of a &lt;= b: True

a == b:
  testing __eq__(1, 2)
  result of a == b: False

a &gt;= b:
  testing __gt__(1, 2)
  testing __eq__(1, 2)
  result of a &gt;= b: False

a &gt; b :
  testing __gt__(1, 2)
  result of a &gt; b: False
</pre></div>
</div>
</div>
<div class="section" id="collation-order">
<h3>Collation Order<a class="headerlink" href="#collation-order" title="Permalink to this headline">¶</a></h3>
<p>Since old-style comparison functions are deprecated in Python 3, the
<code class="docutils literal notranslate"><span class="pre">cmp</span></code> argument to functions like <code class="docutils literal notranslate"><span class="pre">sort()</span></code> are also no longer
supported.  Older programs that use comparison functions can use
<code class="docutils literal notranslate"><span class="pre">cmp_to_key()</span></code> to convert them to a function that returns a
<em>collation key</em>, which is used to determine the position in the final
sequence.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">functools_cmp_to_key.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">class</span> <span class="nc">MyObject</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;MyObject(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compare_obj</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Old-style comparison function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;comparing </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>


<span class="c1"># Make a key function using cmp_to_key()</span>
<span class="n">get_key</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">compare_obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_key_wrapper</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="s2">&quot;Wrapper function for get_key to allow for print statements.&quot;</span>
    <span class="n">new_key</span> <span class="o">=</span> <span class="n">get_key</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;key_wrapper(</span><span class="si">{}</span><span class="s1">) -&gt; </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">new_key</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_key</span>


<span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyObject</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_key_wrapper</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Normally <code class="docutils literal notranslate"><span class="pre">cmp_to_key()</span></code> would be used directly, but in this
example an extra wrapper function is introduced to print out more
information as the key function is being called.</p>
<p>The output shows that <code class="docutils literal notranslate"><span class="pre">sorted()</span></code> starts by calling
<code class="docutils literal notranslate"><span class="pre">get_key_wrapper()</span></code> for each item in the sequence to produce a
key.  The keys returned by <code class="docutils literal notranslate"><span class="pre">cmp_to_key()</span></code> are instances of a class
defined in <code class="docutils literal notranslate"><span class="pre">functools</span></code> that implements the rich comparison API
using the old-style comparison function passed in.  After all of the
keys are created, the sequence is sorted by comparing the keys.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_cmp_to_key.py

key_wrapper(MyObject(5)) -&gt; &lt;functools.KeyWrapper object at
0x1011c5530&gt;
key_wrapper(MyObject(4)) -&gt; &lt;functools.KeyWrapper object at
0x1011c5510&gt;
key_wrapper(MyObject(3)) -&gt; &lt;functools.KeyWrapper object at
0x1011c54f0&gt;
key_wrapper(MyObject(2)) -&gt; &lt;functools.KeyWrapper object at
0x1011c5390&gt;
key_wrapper(MyObject(1)) -&gt; &lt;functools.KeyWrapper object at
0x1011c5710&gt;
comparing MyObject(4) and MyObject(5)
comparing MyObject(3) and MyObject(4)
comparing MyObject(2) and MyObject(3)
comparing MyObject(1) and MyObject(2)
MyObject(1)
MyObject(2)
MyObject(3)
MyObject(4)
MyObject(5)
</pre></div>
</div>
</div>
</div>
<div class="section" id="caching">
<span id="functools-lru-cache"></span><h2>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">lru_cache()</span></code> decorator wraps a function in a
least-recently-used cache. Arguments to the function are used to build
a hash key, which is then mapped to the result. Subsequent calls with
the same arguments will fetch the value from the cache instead of
calling the function. The decorator also adds methods to the function
to examine the state of the cache (<code class="docutils literal notranslate"><span class="pre">cache_info()</span></code>) and empty the
cache (<code class="docutils literal notranslate"><span class="pre">cache_clear()</span></code>).</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">functools_lru_cache.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">expensive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expensive(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>


<span class="n">MAX</span> <span class="o">=</span> <span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First set of calls:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX</span><span class="p">):</span>
        <span class="n">expensive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Second set of calls:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">expensive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Clearing cache:&#39;</span><span class="p">)</span>
<span class="n">expensive</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Third set of calls:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX</span><span class="p">):</span>
        <span class="n">expensive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>This example makes several calls to <code class="docutils literal notranslate"><span class="pre">expensive()</span></code> in a set of nested
loops. The second time those calls are made with the same values the
results appear in the cache. When the cache is cleared and the loops
are run again the values must be recomputed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_lru_cache.py

First set of calls:
expensive(0, 0)
expensive(0, 1)
expensive(1, 0)
expensive(1, 1)
CacheInfo(hits=0, misses=4, maxsize=128, currsize=4)

Second set of calls:
expensive(0, 2)
expensive(1, 2)
expensive(2, 0)
expensive(2, 1)
expensive(2, 2)
CacheInfo(hits=4, misses=9, maxsize=128, currsize=9)

Clearing cache:
CacheInfo(hits=0, misses=0, maxsize=128, currsize=0)

Third set of calls:
expensive(0, 0)
expensive(0, 1)
expensive(1, 0)
expensive(1, 1)
CacheInfo(hits=0, misses=4, maxsize=128, currsize=4)
</pre></div>
</div>
<p>To prevent the cache from growing without bounds in a long-running
process, it is given a maximum size. The default is 128 entries, but
that can be changed for each cache using the <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> argument.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">functools_lru_cache_expire.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">expensive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;called expensive(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>


<span class="k">def</span> <span class="nf">make_call</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">pre_hits</span> <span class="o">=</span> <span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">hits</span>
    <span class="n">expensive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">post_hits</span> <span class="o">=</span> <span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">hits</span>
    <span class="k">if</span> <span class="n">post_hits</span> <span class="o">&gt;</span> <span class="n">pre_hits</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cache hit&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Establish the cache&#39;</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Use cached items&#39;</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Compute a new value, triggering cache expiration&#39;</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cache still contains one old item&#39;</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Oldest item needs to be recomputed&#39;</span><span class="p">)</span>
<span class="n">make_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this example the cache size is set to 2 entries. When the third set
of unique arguments (<code class="docutils literal notranslate"><span class="pre">3,</span> <span class="pre">4</span></code>) is used the oldest item in the cache is
dropped and replaced with the new result.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_lru_cache_expire.py

Establish the cache
(1, 2) called expensive(1, 2)
(2, 3) called expensive(2, 3)

Use cached items
(1, 2) cache hit
(2, 3) cache hit

Compute a new value, triggering cache expiration
(3, 4) called expensive(3, 4)

Cache still contains one old item
(2, 3) cache hit

Oldest item needs to be recomputed
(1, 2) called expensive(1, 2)
</pre></div>
</div>
<p>The keys for the cache managed by <code class="docutils literal notranslate"><span class="pre">lru_cache()</span></code> must be hashable,
so all of the arguments to the function wrapped with the cache lookup
must be hashable.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">functools_lru_cache_arguments.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">expensive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;called expensive(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>


<span class="k">def</span> <span class="nf">make_call</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">pre_hits</span> <span class="o">=</span> <span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">hits</span>
    <span class="n">expensive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">post_hits</span> <span class="o">=</span> <span class="n">expensive</span><span class="o">.</span><span class="n">cache_info</span><span class="p">()</span><span class="o">.</span><span class="n">hits</span>
    <span class="k">if</span> <span class="n">post_hits</span> <span class="o">&gt;</span> <span class="n">pre_hits</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cache hit&#39;</span><span class="p">)</span>


<span class="n">make_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">make_call</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">make_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="s1">&#39;two&#39;</span><span class="p">})</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>If any object that can’t be hashed is passed in to
the function, a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> is raised.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_lru_cache_arguments.py

(1, 2) called expensive(1, 2)
([1], 2) ERROR: unhashable type: &#39;list&#39;
(1, {&#39;2&#39;: &#39;two&#39;}) ERROR: unhashable type: &#39;dict&#39;
</pre></div>
</div>
</div>
<div class="section" id="reducing-a-data-set">
<h2>Reducing a Data Set<a class="headerlink" href="#reducing-a-data-set" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> function takes a callable and a sequence of data as
input and produces a single value as output based on invoking the
callable with the values from the sequence and accumulating the
resulting output.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">functools_reduce.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">do_reduce</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do_reduce(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="n">data</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">do_reduce</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;result: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>This example adds up the numbers in the input sequence.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_reduce.py

range(1, 5)
do_reduce(1, 2)
do_reduce(3, 3)
do_reduce(6, 4)
result: 10
</pre></div>
</div>
<p>The optional <code class="docutils literal notranslate"><span class="pre">initializer</span></code> argument is placed at the front of the
sequence and processed along with the other items. This can be used to
update a previously computed value with new inputs.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">functools_reduce_initializer.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">do_reduce</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do_reduce(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="n">data</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">do_reduce</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;result: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>In this example a previous sum of <code class="docutils literal notranslate"><span class="pre">99</span></code> is used to initialize the
value computed by <code class="docutils literal notranslate"><span class="pre">reduce()</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_reduce_initializer.py

range(1, 5)
do_reduce(99, 1)
do_reduce(100, 2)
do_reduce(102, 3)
do_reduce(105, 4)
result: 109
</pre></div>
</div>
<p>Sequences with a single item automatically reduce to that value when
no initializer is present. Empty lists generate an error, unless an
initializer is provided.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">functools_reduce_short_sequences.py</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">do_reduce</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;do_reduce(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Single item in sequence:&#39;</span><span class="p">,</span>
      <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">do_reduce</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Single item in sequence with initializer:&#39;</span><span class="p">,</span>
      <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">do_reduce</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">99</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty sequence with initializer:&#39;</span><span class="p">,</span>
      <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">do_reduce</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">99</span><span class="p">))</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty sequence:&#39;</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">do_reduce</span><span class="p">,</span> <span class="p">[]))</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Because the initializer argument serves as a default, but is also
combined with the new values if the input sequence is not empty, it is
important to consider carefully whether to use it. When it does not
make sense to combine the default with new values, it is better to
catch the <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> rather than passing an initializer.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_reduce_short_sequences.py

Single item in sequence: 1
do_reduce(99, 1)
Single item in sequence with initializer: 100
Empty sequence with initializer: 99
ERROR: reduce() of empty sequence with no initial value
</pre></div>
</div>
</div>
<div class="section" id="generic-functions">
<h2>Generic Functions<a class="headerlink" href="#generic-functions" title="Permalink to this headline">¶</a></h2>
<p>In a dynamically typed language like Python it is common to need to
perform slightly different operation based on the type of an argument,
especially when dealing with the difference between a list of items
and a single item. It is simple enough to check the type of an
argument directly, but in cases where the behavioral difference can be
isolated into separate functions <code class="docutils literal notranslate"><span class="pre">functools</span></code> provides the
<code class="docutils literal notranslate"><span class="pre">singledispatch()</span></code> decorator to register a set of <em>generic
functions</em> for automatic switching based on the type of the first
argument to a function.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">functools_singledispatch.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">singledispatch</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;default myfunc(</span><span class="si">{!r}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>


<span class="nd">@myfunc</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myfunc_int</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;myfunc_int(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>


<span class="nd">@myfunc</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myfunc_list</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;myfunc_list()&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>


<span class="n">myfunc</span><span class="p">(</span><span class="s1">&#39;string argument&#39;</span><span class="p">)</span>
<span class="n">myfunc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">myfunc</span><span class="p">(</span><span class="mf">2.3</span><span class="p">)</span>
<span class="n">myfunc</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">register()</span></code> attribute of the new function serves as another
decorator for registering alternative implementations. The first
function wrapped with <code class="docutils literal notranslate"><span class="pre">singledispatch()</span></code> is the default
implementation if no other type-specific function is found, as with
the <code class="docutils literal notranslate"><span class="pre">float</span></code> case in this example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_singledispatch.py

default myfunc(&#39;string argument&#39;)
myfunc_int(1)
default myfunc(2.3)
myfunc_list()
  a
  b
  c
</pre></div>
</div>
<p>When no exact match is found for the type, the inheritance order is
evaluated and the closest matching type is used.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">functools_singledispatch_mro.py</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">singledispatch</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;default myfunc(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>


<span class="nd">@myfunc</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myfunc_A</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;myfunc_A(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>


<span class="nd">@myfunc</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myfunc_B</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;myfunc_B(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>


<span class="nd">@myfunc</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myfunc_C</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;myfunc_C(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>


<span class="n">myfunc</span><span class="p">(</span><span class="n">A</span><span class="p">())</span>
<span class="n">myfunc</span><span class="p">(</span><span class="n">B</span><span class="p">())</span>
<span class="n">myfunc</span><span class="p">(</span><span class="n">C</span><span class="p">())</span>
<span class="n">myfunc</span><span class="p">(</span><span class="n">D</span><span class="p">())</span>
<span class="n">myfunc</span><span class="p">(</span><span class="n">E</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>In this example, classes <code class="docutils literal notranslate"><span class="pre">D</span></code> and <code class="docutils literal notranslate"><span class="pre">E</span></code> do not match exactly with any
registered generic functions, and the function selected depends on the
class hierarchy.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 functools_singledispatch_mro.py

myfunc_A(A)
myfunc_B(B)
myfunc_C(C)
myfunc_B(D)
myfunc_C(E)
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/functools.html">Standard library documentation for functools</a></li>
<li><a class="reference external" href="https://docs.python.org/reference/datamodel.html#object.__lt__">Rich comparison methods</a>
– Description of the rich comparison methods from the Python
Reference Guide.</li>
<li><a class="reference external" href="http://nedbatchelder.com/blog/201601/isolated_memoize.html">Isolated &#64;memoize</a>
– Article on creating memoizing decorators that work well with
unit tests, by Ned Batchelder.</li>
<li><span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0443"><strong>PEP 443</strong></a> – “Single-dispatch generic functions”</li>
<li><a class="reference internal" href="../inspect/index.html#module-inspect" title="inspect: Inspect live objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">inspect</span></code></a> – Introspection API for live objects.</li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../algorithm_tools.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> Algorithms</a>
<a id="next-link" href="../itertools/index.html"
   title="next chapter">itertools — Iterator Functions <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#decorators"><i class="fa fa-caret-right"></i>Decorators</a></li>
    
    <li><a href="#partial-objects"><i class="fa fa-caret-right"></i>Partial Objects</a></li>
    
    <li><a href="#acquiring-function-properties"><i class="fa fa-caret-right"></i>Acquiring Function Properties</a></li>
    
    <li><a href="#other-callables"><i class="fa fa-caret-right"></i>Other Callables</a></li>
    
    <li><a href="#methods-and-functions"><i class="fa fa-caret-right"></i>Methods and Functions</a></li>
    
    <li><a href="#acquiring-function-properties-for-decorators"><i class="fa fa-caret-right"></i>Acquiring Function Properties for Decorators</a></li>
    
    <li><a href="#comparison"><i class="fa fa-caret-right"></i>Comparison</a></li>
    
    <li><a href="#rich-comparison"><i class="fa fa-caret-right"></i>Rich Comparison</a></li>
    
    <li><a href="#collation-order"><i class="fa fa-caret-right"></i>Collation Order</a></li>
    
    <li><a href="#caching"><i class="fa fa-caret-right"></i>Caching</a></li>
    
    <li><a href="#reducing-a-data-set"><i class="fa fa-caret-right"></i>Reducing a Data Set</a></li>
    
    <li><a href="#generic-functions"><i class="fa fa-caret-right"></i>Generic Functions</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2017-01-04.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../algorithm_tools.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>Algorithms</a></li>
    <li><a href="../itertools/index.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>itertools — Iterator Functions</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAf5QTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gJCQkKCUmKCgoKCkoKSkpKSopKicnKioqLS0tMDAwMS0uMjExMjMxNTY1Pj8+Pzc5Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgY19haGVmbmxscHBwcHJvdXJzdnN0eHV2eXx5en15fH98fX98fnt8f4F+gICAgoWChIGChIWEhIaEh4aHiYyJjIqLjoeLj4+PkY+PkZORkZSRk5iTlZmUlpmWmJaXmpiZnp2dnqCdn5aan5+fn6Oeoqaho6Gho6ijpqqmq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbewsrexsrixs7iytLmztLqztbW1tbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIycjIyc3Iyc3Jys3Jy8rLy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4N/g4+Pj6Ofn7+/v8fHx////rrSdFQAAAAN0Uk5TAAoO5yEBUwAAA+FJREFUSMe1lo9301QUx6uXUmaf0qJ26iTrRoVinUzjQNR1gAyH6Lqx6XTDoVvXbU7qhA5m7CgYWaTDlLa6AiFsba3t+y+9Sdr8OvVMi7zTnLTf5H7ee9/73n11PA1PpDkcADPRWPwKt8YLG2I2n89m7gh8iluJz0dnpqe+HBsdHRn+7w3JyF1cvpbk05mCJG8Xi9uPpMLdNJ9cXV5UyBNjoyMtkR2A3B9Tt8SCfLTTqUzC2XlMvpcRbnA/IPmryYnzoyM9XuWBt8eI21FBcAy5Qk4KtxkGtQ1I+fRNbnk+evHC5NhJDwATDDIAnhNa1ImdFQTHr6WEvNyFPFeATSTYgAu/dl3/I31jNR6bnZ76eDf4yxRb2Q+71aiz/0JB8JXkrZzCdbFVqrUhRHuu54XkytLczAUvBFADUB6ARwnyqEp/t02prK9XdAXBHC9KyPWVqd6qPhyzlOG55dhsL/hLDTD1A3rYAy+dRu6eXaGKruA75wi2hbqigNd+LYSRW6XUSh64l05dXYruA1OPZfAOD3vhObL/ILDvQkRXynSdvPpaiJB+TVHAfEZuA9d9amlVF7TJd3nu+xgwyu8AqNOnDGAM8/obOLhQpWQotPYReZ/SQdKuKQpY2DwKwFJbGwI4VhCSlxchSFUnNC+CCgaV9RAKoZKh1J4le9FmQv5SFQW88aATXGhEws8wrHb7AANc0CndQS+ag5ERaieke0FXvnkxoYL/1MGi7FSmmVBXMDOu3gLK5J2PMjdXv2tmBX6pDdKSkq39DWXh3G1KI4QYVmS3AHCIPnCXE+4hHy6PcfeQ6sV2lufiL2jJ0wasp4p2k/Z2CEXeeqahDBLS1/c8+dBIXq4IkFAiWQ1QtxtnUMz/wsXfBj+1LzdUKn17dvXXzEqfMoFDNWO57QCe22dskKB5g7zXbVN+i0RKumKxonrfzaIVys2wYu7TVrd0PXn1rOnJC4JTFjF5c19/gnXLFwj6jJJz1rOjoi63LnBRfbmNM+qNunG5baSufhu9OPX5my2VTWEzrHrRbIP8dHl+dnpyrIVDBME/q1u6/E9bGmt9i2AsQmeaFaFwIb22soSlfuL8SEtgOCJKB5BsKkNltWyK7zzWMY3X4exDc6GvsljoX5FzR+BxwdCbf3jAdjTJv5/S39H2B2iXpmgXpWB7iVrB0JuVzpgP07CUO2WKqX+oiVL/benKImhgOIzHf7hx/A/IBdHsQ6Nsmruilo4afVFqB8PLn2U2H8hbxeKWjH9YvuiwxNiMaNhALZptCg5d7zh+Sczmclnx0vEOax6ajdjucSMPTcD/97/Cp54Q929ZZbgcR3o0hAAAAABJRU5ErkJggg=="/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>