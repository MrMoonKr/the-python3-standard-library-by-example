<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>shutil — High-level File Operations &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="https://feeds.feedburner.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="https://feeds.feedburner.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@pymotw" />
    <meta name="twitter:title" content="shutil — High-level File Operations" />
    <meta name="twitter:image" content="https://pymotw.com/3/_static/logo-large.png" />

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../file_access.html"><i class="fa fa-arrow-circle-up"></i> The File System</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-shutil">
<span id="shutil-high-level-file-operations"></span><h1>shutil — High-level File Operations<a class="headerlink" href="#module-shutil" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">High-level file operations.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">shutil</span></code> module includes high-level file operations such as
copying and archiving.</p>
<div class="section" id="copying-files">
<h2>Copying Files<a class="headerlink" href="#copying-files" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">copyfile()</span></code> copies the contents of the source to the destination
and raises <code class="docutils literal notranslate"><span class="pre">IOError</span></code> if it does not have permission to write to
the destination file.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">shutil_copyfile.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;shutil_copyfile.*&#39;</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s1">&#39;shutil_copyfile.py&#39;</span><span class="p">,</span> <span class="s1">&#39;shutil_copyfile.py.copy&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AFTER:&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;shutil_copyfile.*&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Because the function opens the input file for reading, regardless of
its type, special files (such as Unix device nodes) cannot be copied
as new special files with <code class="docutils literal notranslate"><span class="pre">copyfile()</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copyfile.py

BEFORE: [&#39;shutil_copyfile.py&#39;]
AFTER: [&#39;shutil_copyfile.py&#39;, &#39;shutil_copyfile.py.copy&#39;]
</pre></div>
</div>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">copyfile()</span></code> uses the lower-level function
<code class="docutils literal notranslate"><span class="pre">copyfileobj()</span></code>. While the arguments to <code class="docutils literal notranslate"><span class="pre">copyfile()</span></code> are
filenames, the arguments to <code class="docutils literal notranslate"><span class="pre">copyfileobj()</span></code> are open file
handles. The optional third argument is a buffer length to use for
reading in blocks.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">shutil_copyfileobj.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">class</span> <span class="nc">VerboseStringIO</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;read(</span><span class="si">{}</span><span class="s1">) got </span><span class="si">{}</span><span class="s1"> bytes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">next</span>


<span class="n">lorem_ipsum</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Lorem ipsum dolor sit amet, consectetuer</span>
<span class="s1">adipiscing elit.  Vestibulum aliquam mollis dolor. Donec</span>
<span class="s1">vulputate nunc ut diam. Ut rutrum mi vel sem. Vestibulum</span>
<span class="s1">ante ipsum.&#39;&#39;&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Default:&#39;</span><span class="p">)</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">VerboseStringIO</span><span class="p">(</span><span class="n">lorem_ipsum</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All at once:&#39;</span><span class="p">)</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">VerboseStringIO</span><span class="p">(</span><span class="n">lorem_ipsum</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Blocks of 256:&#39;</span><span class="p">)</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">VerboseStringIO</span><span class="p">(</span><span class="n">lorem_ipsum</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The default behavior is to read using large blocks.  Use <code class="docutils literal notranslate"><span class="pre">-1</span></code> to
read all of the input at one time or another positive integer to set a
specific block size.  This example uses several different block sizes
to show the effect.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copyfileobj.py

Default:
read(16384) got 166 bytes
read(16384) got 0 bytes

All at once:
read(-1) got 166 bytes
read(-1) got 0 bytes

Blocks of 256:
read(256) got 166 bytes
read(256) got 0 bytes
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">copy()</span></code> function interprets the output name like the Unix
command line tool <code class="docutils literal notranslate"><span class="pre">cp</span></code>. If the named destination refers to a
directory instead of a file, a new file is created in the directory
using the base name of the source.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">shutil_copy.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;example/*&#39;</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s1">&#39;shutil_copy.py&#39;</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AFTER :&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;example/*&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The permissions of the file are copied along with the contents.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copy.py

BEFORE: []
AFTER : [&#39;example/shutil_copy.py&#39;]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">copy2()</span></code> works like <code class="docutils literal notranslate"><span class="pre">copy()</span></code>, but includes the access and
modification times in the metadata copied to the new file.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">shutil_copy2.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">show_file_info</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Mode    :&#39;</span><span class="p">,</span> <span class="nb">oct</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Created :&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_ctime</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Accessed:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_atime</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Modified:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>


<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SOURCE:&#39;</span><span class="p">)</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s1">&#39;shutil_copy2.py&#39;</span><span class="p">)</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;shutil_copy2.py&#39;</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEST:&#39;</span><span class="p">)</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s1">&#39;example/shutil_copy2.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The new file has all of the same characteristics as the old version.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copy2.py

SOURCE:
  Mode    : 0o100644
  Created : Wed Dec 28 19:03:12 2016
  Accessed: Wed Dec 28 19:03:49 2016
  Modified: Wed Dec 28 19:03:12 2016
DEST:
  Mode    : 0o100644
  Created : Wed Dec 28 19:03:49 2016
  Accessed: Wed Dec 28 19:03:49 2016
  Modified: Wed Dec 28 19:03:12 2016
</pre></div>
</div>
</div>
<div class="section" id="copying-file-metadata">
<h2>Copying File Metadata<a class="headerlink" href="#copying-file-metadata" title="Permalink to this headline">¶</a></h2>
<p>By default when a new file is created under Unix, it receives
permissions based on the umask of the current user. To copy the
permissions from one file to another, use <code class="docutils literal notranslate"><span class="pre">copymode()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">shutil_copymode.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">,</span> <span class="mo">0o444</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">,</span> <span class="nb">oct</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copymode</span><span class="p">(</span><span class="s1">&#39;shutil_copymode.py&#39;</span><span class="p">,</span> <span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AFTER :&#39;</span><span class="p">,</span> <span class="nb">oct</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>This example script creates a file to be modified, then uses
<code class="docutils literal notranslate"><span class="pre">copymode()</span></code> to duplicate the permissions of the script to the
example file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copymode.py

BEFORE: 0o100444
AFTER : 0o100644
</pre></div>
</div>
<p>To copy other metadata about the file use <code class="docutils literal notranslate"><span class="pre">copystat()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">shutil_copystat.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">show_file_info</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Mode    :&#39;</span><span class="p">,</span> <span class="nb">oct</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Created :&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_ctime</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Accessed:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_atime</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Modified:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">,</span> <span class="mo">0o444</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">)</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">)</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copystat</span><span class="p">(</span><span class="s1">&#39;shutil_copystat.py&#39;</span><span class="p">,</span> <span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AFTER:&#39;</span><span class="p">)</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s1">&#39;file_to_change.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Only the permissions and dates associated with the file are duplicated
with <code class="docutils literal notranslate"><span class="pre">copystat()</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copystat.py

BEFORE:
  Mode    : 0o100444
  Created : Wed Dec 28 19:03:49 2016
  Accessed: Wed Dec 28 19:03:49 2016
  Modified: Wed Dec 28 19:03:49 2016
AFTER:
  Mode    : 0o100644
  Created : Wed Dec 28 19:03:49 2016
  Accessed: Wed Dec 28 19:03:49 2016
  Modified: Wed Dec 28 19:03:46 2016
</pre></div>
</div>
</div>
<div class="section" id="working-with-directory-trees">
<span id="shutil-directory-functions"></span><h2>Working With Directory Trees<a class="headerlink" href="#working-with-directory-trees" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">shutil</span></code> includes three functions for working with directory
trees. To copy a directory from one place to another, use
<code class="docutils literal notranslate"><span class="pre">copytree()</span></code>. It recurses through the source directory tree,
copying files to the destination. The destination directory must not
exist in advance.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">shutil_copytree.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/example/*&#39;</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s1">&#39;../shutil&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">AFTER:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/example/*&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">symlinks</span></code> argument controls whether symbolic links are copied as
links or as files. The default is to copy the contents to new
files. If the option is true, new symlinks are created within the
destination tree.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copytree.py

BEFORE:
[]

AFTER:
[&#39;/tmp/example/example&#39;,
 &#39;/tmp/example/example.out&#39;,
 &#39;/tmp/example/file_to_change.txt&#39;,
 &#39;/tmp/example/index.rst&#39;,
 &#39;/tmp/example/shutil_copy.py&#39;,
 &#39;/tmp/example/shutil_copy2.py&#39;,
 &#39;/tmp/example/shutil_copyfile.py&#39;,
 &#39;/tmp/example/shutil_copyfile.py.copy&#39;,
 &#39;/tmp/example/shutil_copyfileobj.py&#39;,
 &#39;/tmp/example/shutil_copymode.py&#39;,
 &#39;/tmp/example/shutil_copystat.py&#39;,
 &#39;/tmp/example/shutil_copytree.py&#39;,
 &#39;/tmp/example/shutil_copytree_verbose.py&#39;,
 &#39;/tmp/example/shutil_disk_usage.py&#39;,
 &#39;/tmp/example/shutil_get_archive_formats.py&#39;,
 &#39;/tmp/example/shutil_get_unpack_formats.py&#39;,
 &#39;/tmp/example/shutil_make_archive.py&#39;,
 &#39;/tmp/example/shutil_move.py&#39;,
 &#39;/tmp/example/shutil_rmtree.py&#39;,
 &#39;/tmp/example/shutil_unpack_archive.py&#39;,
 &#39;/tmp/example/shutil_which.py&#39;,
 &#39;/tmp/example/shutil_which_regular_file.py&#39;]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">copytree()</span></code> accepts two callable arguments to control its
behavior. The <code class="docutils literal notranslate"><span class="pre">ignore</span></code> argument is called with the name of each
directory or subdirectory being copied along with a list of the
contents of the directory. It should return a list of items that
should be copied. The <code class="docutils literal notranslate"><span class="pre">copy_function</span></code> argument is called to actually
copy the file.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">shutil_copytree_verbose.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">shutil</span>


<span class="k">def</span> <span class="nf">verbose_copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;copying</span><span class="se">\n</span><span class="s1"> </span><span class="si">{!r}</span><span class="se">\n</span><span class="s1"> to </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/example/*&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
    <span class="s1">&#39;../shutil&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/example&#39;</span><span class="p">,</span>
    <span class="n">copy_function</span><span class="o">=</span><span class="n">verbose_copy</span><span class="p">,</span>
    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s1">&#39;*.py&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">AFTER:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/example/*&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>In the example, <code class="docutils literal notranslate"><span class="pre">ignore_patterns()</span></code> is used to create an ignore
function to skip copying Python source files. <code class="docutils literal notranslate"><span class="pre">verbose_copy()</span></code>
prints the names of files as they are copied then uses <code class="docutils literal notranslate"><span class="pre">copy2()</span></code>,
the default copy function, to make the copies.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_copytree_verbose.py

BEFORE:
[]

copying
 &#39;../shutil/example.out&#39;
 to &#39;/tmp/example/example.out&#39;
copying
 &#39;../shutil/file_to_change.txt&#39;
 to &#39;/tmp/example/file_to_change.txt&#39;
copying
 &#39;../shutil/index.rst&#39;
 to &#39;/tmp/example/index.rst&#39;

AFTER:
[&#39;/tmp/example/example&#39;,
 &#39;/tmp/example/example.out&#39;,
 &#39;/tmp/example/file_to_change.txt&#39;,
 &#39;/tmp/example/index.rst&#39;]
</pre></div>
</div>
<p>To remove a directory and its contents, use <code class="docutils literal notranslate"><span class="pre">rmtree()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">shutil_rmtree.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/example/*&#39;</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;/tmp/example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">AFTER:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/example/*&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Errors are raised as exceptions by default, but can be ignored if the
second argument is true, and a special error handler function can be
provided in the third argument.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_rmtree.py

BEFORE:
[&#39;/tmp/example/example&#39;,
 &#39;/tmp/example/example.out&#39;,
 &#39;/tmp/example/file_to_change.txt&#39;,
 &#39;/tmp/example/index.rst&#39;]

AFTER:
[]
</pre></div>
</div>
<p>To move a file or directory from one place to another, use
<code class="docutils literal notranslate"><span class="pre">move()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">shutil_move.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;contents&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BEFORE: &#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;example*&#39;</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;example.out&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AFTER : &#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;example*&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The semantics are similar to those of the Unix command <code class="docutils literal notranslate"><span class="pre">mv</span></code>. If the
source and destination are within the same file system, the source is
renamed.  Otherwise the source is copied to the destination and then
the source is removed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_move.py

BEFORE:  [&#39;example.txt&#39;]
AFTER :  [&#39;example.out&#39;]
</pre></div>
</div>
</div>
<div class="section" id="finding-files">
<h2>Finding Files<a class="headerlink" href="#finding-files" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">which()</span></code> function scans a search path looking for a named
file. The typical use case is to find an executable program on the
shell’s search path defined in the environment variable <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">shutil_which.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="nb">print</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s1">&#39;virtualenv&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s1">&#39;tox&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s1">&#39;no-such-program&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>If no file matching the search parameters can be found, <code class="docutils literal notranslate"><span class="pre">which()</span></code>
returns <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_which.py

/Users/dhellmann/Library/Python/3.5/bin/virtualenv
/Users/dhellmann/Library/Python/3.5/bin/tox
None
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">which()</span></code> takes arguments to filter based on the permissions the
file has, and the search path to examine. The <code class="docutils literal notranslate"><span class="pre">path</span></code> argument defaults
to <code class="docutils literal notranslate"><span class="pre">os.environ('PATH')</span></code>, but can be any string containing directory
names separated by <code class="docutils literal notranslate"><span class="pre">os.pathsep</span></code>. The <code class="docutils literal notranslate"><span class="pre">mode</span></code> argument should be
a bitmask matching the permissions of the file. By default the mask
looks for executable files, but the following example uses a readable
bitmask and an alternate search path to find a configuration file.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">shutil_which_regular_file.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
    <span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/pymotw&#39;</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">F_OK</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span>
    <span class="s1">&#39;config.ini&#39;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>There is still a race condition searching for readable files this way,
because in the time between finding the file and actually trying to
use it, the file can be deleted or its permissions can be changed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ touch config.ini
$ python3 shutil_which_regular_file.py

./config.ini
</pre></div>
</div>
</div>
<div class="section" id="archives">
<h2>Archives<a class="headerlink" href="#archives" title="Permalink to this headline">¶</a></h2>
<p>Python’s standard library includes many modules for managing archive
files such as <a class="reference internal" href="../tarfile/index.html#module-tarfile" title="tarfile: Tar archive access"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> and <a class="reference internal" href="../zipfile/index.html#module-zipfile" title="zipfile: ZIP archive access"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipfile</span></code></a>. There are also
several higher-level functions for creating and extracting archives in
<code class="docutils literal notranslate"><span class="pre">shutil</span></code>. <code class="docutils literal notranslate"><span class="pre">get_archive_formats()</span></code> returns a sequence of names
and descriptions for formats supported on the current system.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">shutil_get_archive_formats.py</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">for</span> <span class="nb">format</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_archive_formats</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;5}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">description</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The formats supported depend on which modules and underlying libraries
are available, so the output for this example may change based on
where it is run.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_get_archive_formats.py

bztar: bzip2&#39;ed tar-file
gztar: gzip&#39;ed tar-file
tar  : uncompressed tar file
xztar: xz&#39;ed tar-file
zip  : ZIP file
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">make_archive()</span></code> to create a new archive file. Its inputs are
designed to best support archiving an entire directory and all of its
contents, recursively. By default it uses the current working
directory, so that all of the files and subdirectories appear at the
top level of the archive. To change that behavior, use the <code class="docutils literal notranslate"><span class="pre">root_dir</span></code>
argument to move to a new relative position on the filesystem and the
<code class="docutils literal notranslate"><span class="pre">base_dir</span></code> argument to specify a directory to add to the archive.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">shutil_make_archive.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tarfile</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pymotw&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating archive:&#39;</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span>
    <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="s1">&#39;gztar&#39;</span><span class="p">,</span>
    <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;..&#39;</span><span class="p">,</span>
    <span class="n">base_dir</span><span class="o">=</span><span class="s1">&#39;shutil&#39;</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Archive contents:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;example.tar.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">getnames</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This example starts within the source directory for the examples for
<code class="docutils literal notranslate"><span class="pre">shutil</span></code> and moves up one level in the file system, then adds the
<code class="docutils literal notranslate"><span class="pre">shutil</span></code> directory to a tar archive compressed with gzip. The
<a class="reference internal" href="../logging/index.html#module-logging" title="logging: Report status, error, and informational messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> module is configured to show messages from
<code class="docutils literal notranslate"><span class="pre">make_archive()</span></code> about what it is doing.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_make_archive.py

Creating archive:
changing into &#39;..&#39;
Creating tar archive
changing back to &#39;...&#39;

Archive contents:
shutil
shutil/config.ini
shutil/example.out
shutil/file_to_change.txt
shutil/index.rst
shutil/shutil_copy.py
shutil/shutil_copy2.py
shutil/shutil_copyfile.py
shutil/shutil_copyfileobj.py
shutil/shutil_copymode.py
shutil/shutil_copystat.py
shutil/shutil_copytree.py
shutil/shutil_copytree_verbose.py
shutil/shutil_disk_usage.py
shutil/shutil_get_archive_formats.py
shutil/shutil_get_unpack_formats.py
shutil/shutil_make_archive.py
shutil/shutil_move.py
shutil/shutil_rmtree.py
shutil/shutil_unpack_archive.py
shutil/shutil_which.py
shutil/shutil_which_regular_file.py
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">shutil</span></code> maintains a registry of formats that can be unpacked on
the current system, accessible via <code class="docutils literal notranslate"><span class="pre">get_unpack_formats()</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">shutil_get_unpack_formats.py</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">for</span> <span class="nb">format</span><span class="p">,</span> <span class="n">exts</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_unpack_formats</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;5}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">, names ending in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="nb">format</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">exts</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>This registry is different from the registry for creating archives
because it also includes common file extensions used for each format
so that the function for extracting an archive can guess which format
to use based on the file extension.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_get_unpack_formats.py

bztar: bzip2&#39;ed tar-file, names ending in [&#39;.tar.bz2&#39;, &#39;.tbz2&#39;]
gztar: gzip&#39;ed tar-file, names ending in [&#39;.tar.gz&#39;, &#39;.tgz&#39;]
tar  : uncompressed tar file, names ending in [&#39;.tar&#39;]
xztar: xz&#39;ed tar-file, names ending in [&#39;.tar.xz&#39;, &#39;.txz&#39;]
zip  : ZIP file, names ending in [&#39;.zip&#39;]
</pre></div>
</div>
<p>Extract the archive with <code class="docutils literal notranslate"><span class="pre">unpack_archive()</span></code>, passing the archive
file name and optionally the directory where it should be
extracted. If no directory is given, the current directory is used.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">shutil_unpack_archive.py</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unpacking archive:&#39;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span>
        <span class="s1">&#39;example.tar.gz&#39;</span><span class="p">,</span>
        <span class="n">extract_dir</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Created:&#39;</span><span class="p">)</span>
    <span class="n">prefix_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">extracted</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">extracted</span><span class="p">)[</span><span class="n">prefix_len</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<p>In this example <code class="docutils literal notranslate"><span class="pre">unpack_archive()</span></code> is able to determine the format
of the archive because the filename ends with <code class="docutils literal notranslate"><span class="pre">tar.gz</span></code>, and that
value is associated with the <code class="docutils literal notranslate"><span class="pre">gztar</span></code> format in the unpack format
registry.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_unpack_archive.py

Unpacking archive:

Created:
shutil
shutil/config.ini
shutil/example.out
shutil/file_to_change.txt
shutil/index.rst
shutil/shutil_copy.py
shutil/shutil_copy2.py
shutil/shutil_copyfile.py
shutil/shutil_copyfileobj.py
shutil/shutil_copymode.py
shutil/shutil_copystat.py
shutil/shutil_copytree.py
shutil/shutil_copytree_verbose.py
shutil/shutil_disk_usage.py
shutil/shutil_get_archive_formats.py
shutil/shutil_get_unpack_formats.py
shutil/shutil_make_archive.py
shutil/shutil_move.py
shutil/shutil_rmtree.py
shutil/shutil_unpack_archive.py
shutil/shutil_which.py
shutil/shutil_which_regular_file.py
</pre></div>
</div>
</div>
<div class="section" id="file-system-space">
<h2>File System Space<a class="headerlink" href="#file-system-space" title="Permalink to this headline">¶</a></h2>
<p>It can be useful to examine the local file system to see how much
space is available before performing a long running operation that may
exhaust that space. <code class="docutils literal notranslate"><span class="pre">disk_usage()</span></code> returns a tuple with the total
space, the amount currently being used, and the amount remaining free.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">shutil_disk_usage.py</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">total_b</span><span class="p">,</span> <span class="n">used_b</span><span class="p">,</span> <span class="n">free_b</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="n">gib</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">30</span>  <span class="c1"># GiB == gibibyte</span>
<span class="n">gb</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>   <span class="c1"># GB == gigabyte</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total: </span><span class="si">{:6.2f}</span><span class="s1"> GB  </span><span class="si">{:6.2f}</span><span class="s1"> GiB&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">total_b</span> <span class="o">/</span> <span class="n">gb</span><span class="p">,</span> <span class="n">total_b</span> <span class="o">/</span> <span class="n">gib</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Used : </span><span class="si">{:6.2f}</span><span class="s1"> GB  </span><span class="si">{:6.2f}</span><span class="s1"> GiB&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">used_b</span> <span class="o">/</span> <span class="n">gb</span><span class="p">,</span> <span class="n">used_b</span> <span class="o">/</span> <span class="n">gib</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Free : </span><span class="si">{:6.2f}</span><span class="s1"> GB  </span><span class="si">{:6.2f}</span><span class="s1"> GiB&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">free_b</span> <span class="o">/</span> <span class="n">gb</span><span class="p">,</span> <span class="n">free_b</span> <span class="o">/</span> <span class="n">gib</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The values returned by <code class="docutils literal notranslate"><span class="pre">disk_usage()</span></code> are the number of bytes, so
the example program converts them to more readable units before
printing them.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 shutil_disk_usage.py

Total: 499.42 GB  465.12 GiB
Used : 246.68 GB  229.73 GiB
Free : 252.48 GB  235.14 GiB
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/shutil.html">Standard library documentation for shutil</a></li>
<li><a class="reference internal" href="../compression.html"><span class="doc">Data Compression and Archiving</span></a> – Modules for dealing with archive and
compression formats.</li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../tempfile/index.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> tempfile — Temporary File System Objects</a>
<a id="next-link" href="../filecmp/index.html"
   title="next chapter">filecmp — Compare Files <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#copying-files"><i class="fa fa-caret-right"></i>Copying Files</a></li>
    
    <li><a href="#copying-file-metadata"><i class="fa fa-caret-right"></i>Copying File Metadata</a></li>
    
    <li><a href="#working-with-directory-trees"><i class="fa fa-caret-right"></i>Working With Directory Trees</a></li>
    
    <li><a href="#finding-files"><i class="fa fa-caret-right"></i>Finding Files</a></li>
    
    <li><a href="#archives"><i class="fa fa-caret-right"></i>Archives</a></li>
    
    <li><a href="#file-system-space"><i class="fa fa-caret-right"></i>File System Space</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2016-12-28.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../tempfile/index.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>tempfile — Temporary File System Objects</a></li>
    <li><a href="../filecmp/index.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>filecmp — Compare Files</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAf5QTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gJCQkKCUmKCgoKCkoKSkpKSopKicnKioqLS0tMDAwMS0uMjExMjMxNTY1Pj8+Pzc5Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgY19haGVmbmxscHBwcHJvdXJzdnN0eHV2eXx5en15fH98fX98fnt8f4F+gICAgoWChIGChIWEhIaEh4aHiYyJjIqLjoeLj4+PkY+PkZORkZSRk5iTlZmUlpmWmJaXmpiZnp2dnqCdn5aan5+fn6Oeoqaho6Gho6ijpqqmq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbewsrexsrixs7iytLmztLqztbW1tbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIycjIyc3Iyc3Jys3Jy8rLy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4N/g4+Pj6Ofn7+/v8fHx////rrSdFQAAAAN0Uk5TAAoO5yEBUwAAA+FJREFUSMe1lo9301QUx6uXUmaf0qJ26iTrRoVinUzjQNR1gAyH6Lqx6XTDoVvXbU7qhA5m7CgYWaTDlLa6AiFsba3t+y+9Sdr8OvVMi7zTnLTf5H7ee9/73n11PA1PpDkcADPRWPwKt8YLG2I2n89m7gh8iluJz0dnpqe+HBsdHRn+7w3JyF1cvpbk05mCJG8Xi9uPpMLdNJ9cXV5UyBNjoyMtkR2A3B9Tt8SCfLTTqUzC2XlMvpcRbnA/IPmryYnzoyM9XuWBt8eI21FBcAy5Qk4KtxkGtQ1I+fRNbnk+evHC5NhJDwATDDIAnhNa1ImdFQTHr6WEvNyFPFeATSTYgAu/dl3/I31jNR6bnZ76eDf4yxRb2Q+71aiz/0JB8JXkrZzCdbFVqrUhRHuu54XkytLczAUvBFADUB6ARwnyqEp/t02prK9XdAXBHC9KyPWVqd6qPhyzlOG55dhsL/hLDTD1A3rYAy+dRu6eXaGKruA75wi2hbqigNd+LYSRW6XUSh64l05dXYruA1OPZfAOD3vhObL/ILDvQkRXynSdvPpaiJB+TVHAfEZuA9d9amlVF7TJd3nu+xgwyu8AqNOnDGAM8/obOLhQpWQotPYReZ/SQdKuKQpY2DwKwFJbGwI4VhCSlxchSFUnNC+CCgaV9RAKoZKh1J4le9FmQv5SFQW88aATXGhEws8wrHb7AANc0CndQS+ag5ERaieke0FXvnkxoYL/1MGi7FSmmVBXMDOu3gLK5J2PMjdXv2tmBX6pDdKSkq39DWXh3G1KI4QYVmS3AHCIPnCXE+4hHy6PcfeQ6sV2lufiL2jJ0wasp4p2k/Z2CEXeeqahDBLS1/c8+dBIXq4IkFAiWQ1QtxtnUMz/wsXfBj+1LzdUKn17dvXXzEqfMoFDNWO57QCe22dskKB5g7zXbVN+i0RKumKxonrfzaIVys2wYu7TVrd0PXn1rOnJC4JTFjF5c19/gnXLFwj6jJJz1rOjoi63LnBRfbmNM+qNunG5baSufhu9OPX5my2VTWEzrHrRbIP8dHl+dnpyrIVDBME/q1u6/E9bGmt9i2AsQmeaFaFwIb22soSlfuL8SEtgOCJKB5BsKkNltWyK7zzWMY3X4exDc6GvsljoX5FzR+BxwdCbf3jAdjTJv5/S39H2B2iXpmgXpWB7iVrB0JuVzpgP07CUO2WKqX+oiVL/benKImhgOIzHf7hx/A/IBdHsQ6Nsmruilo4afVFqB8PLn2U2H8hbxeKWjH9YvuiwxNiMaNhALZptCg5d7zh+Sczmclnx0vEOax6ajdjucSMPTcD/97/Cp54Q929ZZbgcR3o0hAAAAABJRU5ErkJggg=="/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>