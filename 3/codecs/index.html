<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>codecs — String Encoding and Decoding &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="https://feeds.feedburner.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="https://feeds.feedburner.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@pymotw" />
    <meta name="twitter:title" content="codecs — String Encoding and Decoding" />
    <meta name="twitter:image" content="https://pymotw.com/3/_static/logo-large.png" />

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../file_access.html"><i class="fa fa-arrow-circle-up"></i> The File System</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-codecs">
<span id="codecs-string-encoding-and-decoding"></span><h1>codecs — String Encoding and Decoding<a class="headerlink" href="#module-codecs" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Encoders and decoders for converting text between different
representations.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">codecs</span></code> module provides stream and file interfaces for
transcoding data.  It is most commonly used to work with Unicode text,
but other encodings are also available for other purposes.</p>
<div class="section" id="unicode-primer">
<h2>Unicode Primer<a class="headerlink" href="#unicode-primer" title="Permalink to this headline">¶</a></h2>
<p>CPython 3.x differentiates between <em>text</em> and <em>byte</em> strings.
<code class="docutils literal notranslate"><span class="pre">bytes</span></code> instances use a sequence of 8-bit byte values.  In
contrast, <code class="docutils literal notranslate"><span class="pre">str</span></code> strings are managed internally as a sequence of
Unicode <em>code points</em>.  The code point values are saved as a sequence
of 2 or 4 bytes each, depending on the options given when Python was
compiled.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">str</span></code> values are output, they are encoded using one of
several standard schemes so that the sequence of bytes can be
reconstructed as the same string of text later.  The bytes of the
encoded value are not necessarily the same as the code point values,
and the encoding defines a way to translate between the two sets of
values.  Reading Unicode data also requires knowing the encoding so
that the incoming bytes can be converted to the internal
representation used by the <code class="docutils literal notranslate"><span class="pre">unicode</span></code> class.</p>
<p>The most common encodings for Western languages are <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> and
<code class="docutils literal notranslate"><span class="pre">UTF-16</span></code>, which use sequences of one and two byte values
respectively to represent each code point.  Other encodings can be
more efficient for storing languages where most of the characters are
represented by code points that do not fit into two bytes.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For more introductory information about Unicode, refer to the list
of references at the end of this section.  The <em>Python Unicode
HOWTO</em> is especially helpful.</p>
</div>
<div class="section" id="encodings">
<h3>Encodings<a class="headerlink" href="#encodings" title="Permalink to this headline">¶</a></h3>
<p>The best way to understand encodings is to look at the different
series of bytes produced by encoding the same string in different
ways.  The following examples use this function to format the byte
string to make it easier to read.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">codecs_to_hex.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">binascii</span>


<span class="k">def</span> <span class="nf">to_hex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format text t as a sequence of nbyte long values</span>
<span class="sd">    separated by spaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chars_per_item</span> <span class="o">=</span> <span class="n">nbytes</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">hex_version</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">hex_version</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="n">chars_per_item</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hex_version</span><span class="p">),</span> <span class="n">chars_per_item</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">to_hex</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;abcdef&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">to_hex</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;abcdef&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The function uses <code class="xref py py-mod docutils literal notranslate"><span class="pre">binascii</span></code> to get a hexadecimal representation
of the input byte string, then insert a space between every <code class="docutils literal notranslate"><span class="pre">nbytes</span></code>
bytes before returning the value.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_to_hex.py

b&#39;61 62 63 64 65 66&#39;
b&#39;6162 6364 6566&#39;
</pre></div>
</div>
<p>The first encoding example begins by printing the text <code class="docutils literal notranslate"><span class="pre">'français'</span></code>
using the raw representation of the <code class="docutils literal notranslate"><span class="pre">unicode</span></code> class, followed
by the name of each character from the Unicode database.  The next two
lines encode the string as UTF-8 and UTF-16 respectively, and show the
hexadecimal values resulting from the encoding.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">codecs_encodings.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Raw   : </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{!r}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UTF-8 : </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_hex</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UTF-16: </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_hex</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-16&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<p>The result of encoding a <code class="docutils literal notranslate"><span class="pre">str</span></code> is a <code class="docutils literal notranslate"><span class="pre">bytes</span></code> object.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encodings.py

Raw   : &#39;français&#39;
  &#39;f&#39;: LATIN SMALL LETTER F
  &#39;r&#39;: LATIN SMALL LETTER R
  &#39;a&#39;: LATIN SMALL LETTER A
  &#39;n&#39;: LATIN SMALL LETTER N
  &#39;ç&#39;: LATIN SMALL LETTER C WITH CEDILLA
  &#39;a&#39;: LATIN SMALL LETTER A
  &#39;i&#39;: LATIN SMALL LETTER I
  &#39;s&#39;: LATIN SMALL LETTER S
UTF-8 : b&#39;66 72 61 6e c3 a7 61 69 73&#39;
UTF-16: b&#39;fffe 6600 7200 6100 6e00 e700 6100 6900 7300&#39;
</pre></div>
</div>
<p>Given a sequence of encoded bytes as a <code class="docutils literal notranslate"><span class="pre">bytes</span></code> instance, the
<code class="docutils literal notranslate"><span class="pre">decode()</span></code> method translates them to code points and returns the
sequence as a <code class="docutils literal notranslate"><span class="pre">str</span></code> instance.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">codecs_decode.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">encoded</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Encoded  :&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">encoded</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decoded  :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">decoded</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">decoded</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The choice of encoding used does not change the output type.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_decode.py

Original : &#39;français&#39;
Encoded  : b&#39;66 72 61 6e c3 a7 61 69 73&#39; &lt;class &#39;bytes&#39;&gt;
Decoded  : &#39;français&#39; &lt;class &#39;str&#39;&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default encoding is set during the interpreter start-up process,
when <a class="reference internal" href="../site/index.html#module-site" title="site: Site-wide configuration"><code class="xref py py-mod docutils literal notranslate"><span class="pre">site</span></code></a> is loaded.  Refer to the
<a class="reference internal" href="../sys/interpreter.html#sys-unicode-defaults"><span class="std std-ref">Unicode Defaults</span></a> section from the discussion of
<a class="reference internal" href="../sys/index.html#module-sys" title="sys: System-specific configuration"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a> for a description of the default encoding settings.</p>
</div>
</div>
</div>
<div class="section" id="working-with-files">
<h2>Working with Files<a class="headerlink" href="#working-with-files" title="Permalink to this headline">¶</a></h2>
<p>Encoding and decoding strings is especially important when dealing
with I/O operations.  Whether writing to a file, socket, or other
stream, the data must use the proper encoding.  In general, all text
data needs to be decoded from its byte representation as it is read,
and encoded from the internal values to a specific representation as
it is written.  A program can explicitly encode and decode data, but
depending on the encoding used it can be non-trivial to determine
whether enough bytes have been read in order to fully decode the data.
<code class="docutils literal notranslate"><span class="pre">codecs</span></code> provides classes that manage the data encoding and
decoding, so applications do not have to do that work.</p>
<p>The simplest interface provided by <code class="docutils literal notranslate"><span class="pre">codecs</span></code> is an alternative to
the built-in <code class="docutils literal notranslate"><span class="pre">open()</span></code> function.  The new version works just like
the built-in, but adds two new arguments to specify the encoding and
desired error handling technique.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">codecs_open_write.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">encoding</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">encoding</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing to&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;français&#39;</span><span class="p">)</span>

<span class="c1"># Determine the byte grouping to use for to_hex()</span>
<span class="n">nbytes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;utf-8&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;utf-16&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;utf-32&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Show the raw bytes in the file</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File contents:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">to_hex</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">nbytes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>This example starts with a <code class="docutils literal notranslate"><span class="pre">unicode</span></code> string with “ç” and saves the
text to a file using an encoding specified on the command line.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_open_write.py utf-8

Writing to utf-8.txt
File contents:
b&#39;66 72 61 6e c3 a7 61 69 73&#39;

$ python3 codecs_open_write.py utf-16

Writing to utf-16.txt
File contents:
b&#39;fffe 6600 7200 6100 6e00 e700 6100 6900 7300&#39;

$ python3 codecs_open_write.py utf-32

Writing to utf-32.txt
File contents:
b&#39;fffe0000 66000000 72000000 61000000 6e000000 e7000000 61000000
69000000 73000000&#39;
</pre></div>
</div>
<p>Reading the data with <code class="docutils literal notranslate"><span class="pre">open()</span></code> is straightforward, with one catch:
the encoding must be known in advance, in order to set up the decoder
correctly.  Some data formats, such as XML, specify the encoding as
part of the file, but usually it is up to the application to manage.
<code class="docutils literal notranslate"><span class="pre">codecs</span></code> simply takes the encoding as an argument and assumes it
is correct.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">codecs_open_read.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">encoding</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">encoding</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading from&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<p>This example reads the files created by the previous program, and
prints the representation of the resulting <code class="docutils literal notranslate"><span class="pre">unicode</span></code> object to
the console.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_open_read.py utf-8

Reading from utf-8.txt
&#39;français&#39;

$ python3 codecs_open_read.py utf-16

Reading from utf-16.txt
&#39;français&#39;

$ python3 codecs_open_read.py utf-32

Reading from utf-32.txt
&#39;français&#39;
</pre></div>
</div>
</div>
<div class="section" id="byte-order">
<h2>Byte Order<a class="headerlink" href="#byte-order" title="Permalink to this headline">¶</a></h2>
<p>Multi-byte encodings such as UTF-16 and UTF-32 pose a problem when
transferring the data between different computer systems, either by
copying the file directly or with network communication.  Different
systems use different ordering of the high and low order bytes.  This
characteristic of the data, known as its <em>endianness</em>, depends on
factors such as the hardware architecture and choices made by the
operating system and application developer.  There is not always a way
to know in advance what byte order to use for a given set of data, so
the multi-byte encodings include a <em>byte-order marker</em> (BOM) as the
first few bytes of encoded output.  For example, UTF-16 is defined in
such a way that 0xFFFE and 0xFEFF are not valid characters, and can be
used to indicate the byte order.  <code class="docutils literal notranslate"><span class="pre">codecs</span></code> defines constants for
the byte order markers used by UTF-16 and UTF-32.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">codecs_bom.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="n">BOM_TYPES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;BOM&#39;</span><span class="p">,</span> <span class="s1">&#39;BOM_BE&#39;</span><span class="p">,</span> <span class="s1">&#39;BOM_LE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BOM_UTF8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BOM_UTF16&#39;</span><span class="p">,</span> <span class="s1">&#39;BOM_UTF16_BE&#39;</span><span class="p">,</span> <span class="s1">&#39;BOM_UTF16_LE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BOM_UTF32&#39;</span><span class="p">,</span> <span class="s1">&#39;BOM_UTF32_BE&#39;</span><span class="p">,</span> <span class="s1">&#39;BOM_UTF32_LE&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">BOM_TYPES</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:12}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">codecs</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BOM</span></code>, <code class="docutils literal notranslate"><span class="pre">BOM_UTF16</span></code>, and <code class="docutils literal notranslate"><span class="pre">BOM_UTF32</span></code> are automatically set to the
appropriate big-endian or little-endian values depending on the
current system’s native byte order.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_bom.py

BOM          : b&#39;fffe&#39;
BOM_BE       : b&#39;feff&#39;
BOM_LE       : b&#39;fffe&#39;
BOM_UTF8     : b&#39;efbb bf&#39;
BOM_UTF16    : b&#39;fffe&#39;
BOM_UTF16_BE : b&#39;feff&#39;
BOM_UTF16_LE : b&#39;fffe&#39;
BOM_UTF32    : b&#39;fffe 0000&#39;
BOM_UTF32_BE : b&#39;0000 feff&#39;
BOM_UTF32_LE : b&#39;fffe 0000&#39;
</pre></div>
</div>
<p>Byte ordering is detected and handled automatically by the decoders in
<code class="docutils literal notranslate"><span class="pre">codecs</span></code>, but an explicit ordering can be specified when
encoding.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">codecs_bom_create_file.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="c1"># Pick the nonnative version of UTF-16 encoding</span>
<span class="k">if</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16</span> <span class="o">==</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_BE</span><span class="p">:</span>
    <span class="n">bom</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_LE</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf_16_le&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">bom</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_BE</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf_16_be&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Native order  :&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected order:&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">bom</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Encode the text.</span>
<span class="n">encoded_text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:14}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">encoded_text</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nonnative-encoded.txt&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1"># Write the selected byte-order marker.  It is not included</span>
    <span class="c1"># in the encoded text because the byte order was given</span>
    <span class="c1"># explicitly when selecting the encoding.</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bom</span><span class="p">)</span>
    <span class="c1"># Write the byte string for the encoded text.</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encoded_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">codecs_bom_create_file.py</span></code> figures out the native byte ordering,
then uses the alternate form explicitly so the next example can
demonstrate auto-detection while reading.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_bom_create_file.py

Native order  : b&#39;fffe&#39;
Selected order: b&#39;feff&#39;
utf_16_be     : b&#39;0066 0072 0061 006e 00e7 0061 0069 0073&#39;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">codecs_bom_detection.py</span></code> does not specify a byte order when opening
the file, so the decoder uses the BOM value in the first two bytes of
the file to determine it.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">codecs_bom_detection.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="c1"># Look at the raw data</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;nonnative-encoded.txt&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">raw_bytes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Raw    :&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">raw_bytes</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Re-open the file and let codecs detect the BOM</span>
<span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;nonnative-encoded.txt&#39;</span><span class="p">,</span>
                 <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                 <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-16&#39;</span><span class="p">,</span>
                 <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">decoded_text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decoded:&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">decoded_text</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Since the first two bytes of the file are used for byte order
detection, they are not included in the data returned by <code class="docutils literal notranslate"><span class="pre">read()</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_bom_detection.py

Raw    : b&#39;feff 0066 0072 0061 006e 00e7 0061 0069 0073&#39;
Decoded: &#39;français&#39;
</pre></div>
</div>
</div>
<div class="section" id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<p>The previous sections pointed out the need to know the encoding being
used when reading and writing Unicode files.  Setting the encoding
correctly is important for two reasons.  If the encoding is configured
incorrectly while reading from a file, the data will be interpreted
wrong and may be corrupted or simply fail to decode.  Not all Unicode
characters can be represented in all encodings, so if the wrong
encoding is used while writing then an error will be generated and
data may be lost.</p>
<p><code class="docutils literal notranslate"><span class="pre">codecs</span></code> uses the same five error handling options that are
provided by the <code class="docutils literal notranslate"><span class="pre">encode()</span></code> method of <code class="docutils literal notranslate"><span class="pre">str</span></code> and the
<code class="docutils literal notranslate"><span class="pre">decode()</span></code> method of <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, listed in the table below.</p>
<table border="1" class="docutils" id="id9">
<caption><span class="caption-text">Codec Error Handling Modes</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Error Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">strict</span></code></td>
<td>Raises an exception if the data cannot be converted.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">replace</span></code></td>
<td>Substitutes a special marker character for data that cannot be encoded.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ignore</span></code></td>
<td>Skips the data.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">xmlcharrefreplace</span></code></td>
<td>XML character (encoding only)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">backslashreplace</span></code></td>
<td>escape sequence (encoding only)</td>
</tr>
</tbody>
</table>
<div class="section" id="encoding-errors">
<h3>Encoding Errors<a class="headerlink" href="#encoding-errors" title="Permalink to this headline">¶</a></h3>
<p>The most common error condition is receiving a <code class="docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code>
when writing Unicode data to an ASCII output stream, such as a regular
file or <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> without a more robust encoding set.  This
sample program can be used to experiment with the different error
handling modes.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">codecs_encode_error.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">error_handling</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Save the data, encoded as ASCII, using the error</span>
    <span class="c1"># handling mode specified on the command line.</span>
    <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;encode_error.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                     <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span>
                     <span class="n">errors</span><span class="o">=</span><span class="n">error_handling</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="c1"># If there was no error writing to the file,</span>
    <span class="c1"># show what it contains.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;encode_error.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File contents: </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<p>While <code class="docutils literal notranslate"><span class="pre">strict</span></code> mode is safest for ensuring an application explicitly
sets the correct encoding for all I/O operations, it can lead to
program crashes when an exception is raised.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encode_error.py strict

ERROR: &#39;ascii&#39; codec can&#39;t encode character &#39;\xe7&#39; in position
4: ordinal not in range(128)
</pre></div>
</div>
<p>Some of the other error modes are more flexible.  For example,
<code class="docutils literal notranslate"><span class="pre">replace</span></code> ensures that no error is raised, at the expense of
possibly losing data that cannot be converted to the requested
encoding.  The Unicode character for pi still cannot be encoded in
ASCII, but instead of raising an exception the character is replaced
with <code class="docutils literal notranslate"><span class="pre">?</span></code> in the output.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encode_error.py replace

File contents: b&#39;fran?ais&#39;
</pre></div>
</div>
<p>To skip over problem data entirely, use <code class="docutils literal notranslate"><span class="pre">ignore</span></code>.  Any data that
cannot be encoded is discarded.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encode_error.py ignore

File contents: b&#39;franais&#39;
</pre></div>
</div>
<p>There are two lossless error handling options, both of which replace
the character with an alternate representation defined by a standard
separate from the encoding.  <code class="docutils literal notranslate"><span class="pre">xmlcharrefreplace</span></code> uses an XML
character reference as a substitute (the list of character references
is specified in the W3C document <em>XML Entity Definitions for Characters</em>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encode_error.py xmlcharrefreplace

File contents: b&#39;fran&amp;#231;ais&#39;
</pre></div>
</div>
<p>The other lossless error handling scheme is <code class="docutils literal notranslate"><span class="pre">backslashreplace</span></code>, which
produces an output format like the value returned when <code class="docutils literal notranslate"><span class="pre">repr()</span></code> of
a <code class="docutils literal notranslate"><span class="pre">unicode</span></code> object is printed.  Unicode characters are replaced
with <code class="docutils literal notranslate"><span class="pre">\u</span></code> followed by the hexadecimal value of the code point.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encode_error.py backslashreplace

File contents: b&#39;fran\\xe7ais&#39;
</pre></div>
</div>
</div>
<div class="section" id="decoding-errors">
<h3>Decoding Errors<a class="headerlink" href="#decoding-errors" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to see errors when decoding data, especially if
the wrong encoding is used.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">codecs_decode_error.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="n">error_handling</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original     :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

<span class="c1"># Save the data with one encoding</span>
<span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;decode_error.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                 <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-16&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># Dump the bytes from the file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;decode_error.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File contents:&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Try to read the data with the wrong encoding</span>
<span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;decode_error.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
                 <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                 <span class="n">errors</span><span class="o">=</span><span class="n">error_handling</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Read         :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>As with encoding, <code class="docutils literal notranslate"><span class="pre">strict</span></code> error handling mode raises an exception
if the byte stream cannot be properly decoded.  In this case, a
<code class="docutils literal notranslate"><span class="pre">UnicodeDecodeError</span></code> results from trying to convert part of the
UTF-16 BOM to a character using the UTF-8 decoder.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_decode_error.py strict

Original     : &#39;français&#39;
File contents: b&#39;ff fe 66 00 72 00 61 00 6e 00 e7 00 61 00 69 00
73 00&#39;
ERROR: &#39;utf-8&#39; codec can&#39;t decode byte 0xff in position 0:
invalid start byte
</pre></div>
</div>
<p>Switching to <code class="docutils literal notranslate"><span class="pre">ignore</span></code> causes the decoder to skip over the invalid
bytes.  The result is still not quite what is expected, though, since
it includes embedded null bytes.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_decode_error.py ignore

Original     : &#39;français&#39;
File contents: b&#39;ff fe 66 00 72 00 61 00 6e 00 e7 00 61 00 69 00
73 00&#39;
Read         : &#39;f\x00r\x00a\x00n\x00\x00a\x00i\x00s\x00&#39;
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">replace</span></code> mode invalid bytes are replaced with <code class="docutils literal notranslate"><span class="pre">\uFFFD</span></code>, the
official Unicode replacement character, which looks like a diamond
with a black background containing a white question mark.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_decode_error.py replace

Original     : &#39;français&#39;
File contents: b&#39;ff fe 66 00 72 00 61 00 6e 00 e7 00 61 00 69 00
73 00&#39;
Read         : &#39;��f\x00r\x00a\x00n\x00�\x00a\x00i\x00s\x00&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="encoding-translation">
<h2>Encoding Translation<a class="headerlink" href="#encoding-translation" title="Permalink to this headline">¶</a></h2>
<p>Although most applications will work with <code class="docutils literal notranslate"><span class="pre">str</span></code> data
internally, decoding or encoding it as part of an I/O operation, there
are times when changing a file’s encoding without holding on to that
intermediate data format is useful.  <code class="docutils literal notranslate"><span class="pre">EncodedFile()</span></code> takes an open
file handle using one encoding and wraps it with a class that
translates the data to another encoding as the I/O occurs.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">codecs_encodedfile.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="c1"># Raw version of the original data.</span>
<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>

<span class="c1"># Manually encode it as UTF-8.</span>
<span class="n">utf8</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start as UTF-8   :&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">utf8</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Set up an output buffer, then wrap it as an EncodedFile.</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="n">encoded_file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">EncodedFile</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">data_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                                  <span class="n">file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-16&#39;</span><span class="p">)</span>
<span class="n">encoded_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">utf8</span><span class="p">)</span>

<span class="c1"># Fetch the buffer contents as a UTF-16 encoded byte string</span>
<span class="n">utf16</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Encoded to UTF-16:&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">utf16</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Set up another buffer with the UTF-16 data for reading,</span>
<span class="c1"># and wrap it with another EncodedFile.</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">utf16</span><span class="p">)</span>
<span class="n">encoded_file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">EncodedFile</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">data_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                                  <span class="n">file_encoding</span><span class="o">=</span><span class="s1">&#39;utf-16&#39;</span><span class="p">)</span>

<span class="c1"># Read the UTF-8 encoded version of the data.</span>
<span class="n">recoded</span> <span class="o">=</span> <span class="n">encoded_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Back to UTF-8    :&#39;</span><span class="p">,</span> <span class="n">to_hex</span><span class="p">(</span><span class="n">recoded</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>This example shows reading from and writing to separate handles
returned by <code class="docutils literal notranslate"><span class="pre">EncodedFile()</span></code>.  No matter whether the handle is used
for reading or writing, the <code class="docutils literal notranslate"><span class="pre">file_encoding</span></code> always refers to the
encoding in use by the open file handle passed as the first argument,
and <code class="docutils literal notranslate"><span class="pre">data_encoding</span></code> value refers to the encoding in use by the data
passing through the <code class="docutils literal notranslate"><span class="pre">read()</span></code> and <code class="docutils literal notranslate"><span class="pre">write()</span></code> calls.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_encodedfile.py

Start as UTF-8   : b&#39;66 72 61 6e c3 a7 61 69 73&#39;
Encoded to UTF-16: b&#39;fffe 6600 7200 6100 6e00 e700 6100 6900
7300&#39;
Back to UTF-8    : b&#39;66 72 61 6e c3 a7 61 69 73&#39;
</pre></div>
</div>
</div>
<div class="section" id="non-unicode-encodings">
<h2>Non-Unicode Encodings<a class="headerlink" href="#non-unicode-encodings" title="Permalink to this headline">¶</a></h2>
<p>Although most of the earlier examples use Unicode encodings,
<code class="docutils literal notranslate"><span class="pre">codecs</span></code> can be used for many other data translations.  For
example, Python includes codecs for working with base-64, bzip2,
ROT-13, ZIP, and other data formats.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">codecs_rot13.py</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s1">&#39;rot_13&#39;</span><span class="p">)(</span><span class="n">buffer</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>

<span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original:&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ROT-13  :&#39;</span><span class="p">,</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>Any transformation that can be expressed as a function taking a single
input argument and returning a byte or Unicode string can be
registered as a codec. For the <code class="docutils literal notranslate"><span class="pre">'rot_13'</span></code> codec, the input should be
a Unicode string and the output will also be a Unicode string.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_rot13.py

Original: abcdefghijklmnopqrstuvwxyz
ROT-13  : nopqrstuvwxyzabcdefghijklm
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">codecs</span></code> to wrap a data stream provides a simpler interface
than working directly with <a class="reference internal" href="../zlib/index.html#module-zlib" title="zlib: GNU zlib compression library"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">codecs_zlib.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s1">&#39;zlib&#39;</span><span class="p">)(</span><span class="n">buffer</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">50</span>

<span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original length :&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="n">compressed_data</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ZIP compressed  :&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">compressed_data</span><span class="p">))</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">compressed_data</span><span class="p">)</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="s1">&#39;zlib&#39;</span><span class="p">)(</span><span class="n">buffer</span><span class="p">)</span>

<span class="n">first_line</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Read first line :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">first_line</span><span class="p">))</span>

<span class="n">uncompressed_data</span> <span class="o">=</span> <span class="n">first_line</span> <span class="o">+</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Uncompressed    :&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">uncompressed_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Same            :&#39;</span><span class="p">,</span> <span class="n">text</span> <span class="o">==</span> <span class="n">uncompressed_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Not all of the compression or encoding systems support reading a
portion of the data through the stream interface using
<code class="docutils literal notranslate"><span class="pre">readline()</span></code> or <code class="docutils literal notranslate"><span class="pre">read()</span></code> because they need to find the end of
a compressed segment to expand it.  If a program cannot hold the
entire uncompressed data set in memory, use the incremental access
features of the compression library, instead of <code class="docutils literal notranslate"><span class="pre">codecs</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_zlib.py

Original length : 1350
ZIP compressed  : 48
Read first line : b&#39;abcdefghijklmnopqrstuvwxyz\n&#39;
Uncompressed    : 1350
Same            : True
</pre></div>
</div>
</div>
<div class="section" id="incremental-encoding">
<h2>Incremental Encoding<a class="headerlink" href="#incremental-encoding" title="Permalink to this headline">¶</a></h2>
<p>Some of the encodings provided, especially <code class="docutils literal notranslate"><span class="pre">bz2</span></code> and <code class="docutils literal notranslate"><span class="pre">zlib</span></code>, may
dramatically change the length of the data stream as they work on it.
For large data sets, these encodings operate better incrementally,
working on one small chunk of data at a time.  The
<code class="docutils literal notranslate"><span class="pre">IncrementalEncoder</span></code> and <code class="docutils literal notranslate"><span class="pre">IncrementalDecoder</span></code> API is
designed for this purpose.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">codecs_incremental_bz2.py</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">codecs_to_hex</span> <span class="k">import</span> <span class="n">to_hex</span>

<span class="n">text</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">repetitions</span> <span class="o">=</span> <span class="mi">50</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Text length :&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Repetitions :&#39;</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Expected len:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">repetitions</span><span class="p">)</span>

<span class="c1"># Encode the text several times to build up a</span>
<span class="c1"># large amount of data</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="s1">&#39;bz2&#39;</span><span class="p">)()</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Encoding:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">last</span> <span class="o">=</span> <span class="n">repetitions</span> <span class="o">-</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
    <span class="n">en_c</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">last</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">en_c</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Encoded : </span><span class="si">{}</span><span class="s1"> bytes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">en_c</span><span class="p">)))</span>
        <span class="n">encoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">en_c</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="n">all_encoded</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total encoded length:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_encoded</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Decode the byte string one byte at a time</span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="s1">&#39;bz2&#39;</span><span class="p">)()</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decoding:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_encoded</span><span class="p">):</span>
    <span class="n">final</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">b</span><span class="p">]),</span> <span class="n">final</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Decoded : </span><span class="si">{}</span><span class="s1"> characters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decoding:&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">restored</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total uncompressed length:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">restored</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Each time data is passed to the encoder or decoder its internal state
is updated.  When the state is consistent (as defined by the codec),
data is returned and the state resets.  Until that point, calls to
<code class="docutils literal notranslate"><span class="pre">encode()</span></code> or <code class="docutils literal notranslate"><span class="pre">decode()</span></code> will not return any data.  When the
last bit of data is passed in, the argument <code class="docutils literal notranslate"><span class="pre">final</span></code> should be set to
<code class="docutils literal notranslate"><span class="pre">True</span></code> so the codec knows to flush any remaining buffered data.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_incremental_bz2.py

Text length : 27
Repetitions : 50
Expected len: 1350

Encoding: .................................................
Encoded : 99 bytes

Total encoded length: 99

Decoding: ......................................................
..................................
Decoded : 1350 characters
Decoding: ..........

Total uncompressed length: 1350
</pre></div>
</div>
</div>
<div class="section" id="unicode-data-and-network-communication">
<h2>Unicode Data and Network Communication<a class="headerlink" href="#unicode-data-and-network-communication" title="Permalink to this headline">¶</a></h2>
<p>Network sockets are byte-streams, and unlike the standard input and
output streams they do not support encoding by default. That means
programs that want to send or receive Unicode data over the network
must encode into bytes before it is written to a socket.  This server
echos data it receives back to the sender.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">codecs_socket_fail.py</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socketserver</span>


<span class="k">class</span> <span class="nc">Echo</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get some bytes and echo them back to the client.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">codecs</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="kn">import</span> <span class="nn">threading</span>

    <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># let the kernel assign a port</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">Echo</span><span class="p">)</span>
    <span class="n">ip</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">server_address</span>  <span class="c1"># what port was assigned?</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># don&#39;t hang on exit</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Connect to the server</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="c1"># Send the data</span>
    <span class="c1"># WRONG: Not encoded first!</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>
    <span class="n">len_sent</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1"># Receive a response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">len_sent</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>

    <span class="c1"># Clean up</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The data could be encoded explicitly before each call to <code class="docutils literal notranslate"><span class="pre">send()</span></code>,
but missing one call to <code class="docutils literal notranslate"><span class="pre">send()</span></code> would result in an encoding
error.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_socket_fail.py

Traceback (most recent call last):
  File &quot;codecs_socket_fail.py&quot;, line 43, in &lt;module&gt;
    len_sent = s.send(text)
TypeError: a bytes-like object is required, not &#39;str&#39;
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">makefile()</span></code> to get a file-like handle for the socket, and
then wrapping that with a stream-based reader or writer, means Unicode
strings will be encoded on the way in to and out of the socket.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">codecs_socket.py</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socketserver</span>


<span class="k">class</span> <span class="nc">Echo</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get some bytes and echo them back to the client.</span>

<span class="sd">        There is no need to decode them, since they are not used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PassThrough</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading :&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">codecs</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="kn">import</span> <span class="nn">threading</span>

    <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># let the kernel assign a port</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">Echo</span><span class="p">)</span>
    <span class="n">ip</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">server_address</span>  <span class="c1"># what port was assigned?</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># don&#39;t hang on exit</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c1"># Connect to the server</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="c1"># Wrap the socket with a reader and writer.</span>
    <span class="n">read_file</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">incoming</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)(</span><span class="n">PassThrough</span><span class="p">(</span><span class="n">read_file</span><span class="p">))</span>
    <span class="n">write_file</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="n">outgoing</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)(</span><span class="n">PassThrough</span><span class="p">(</span><span class="n">write_file</span><span class="p">))</span>

    <span class="c1"># Send the data</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;français&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sending :&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">outgoing</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">outgoing</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="c1"># Receive a response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">incoming</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received:&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>

    <span class="c1"># Clean up</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>This example uses <code class="docutils literal notranslate"><span class="pre">PassThrough</span></code> to show that the data is
encoded before being sent, and the response is decoded after it is
received in the client.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_socket.py

Sending : &#39;français&#39;
Writing : b&#39;fran\xc3\xa7ais&#39;
Reading : b&#39;fran\xc3\xa7ais&#39;
Reading : b&#39;&#39;
Received: &#39;français&#39;
</pre></div>
</div>
</div>
<div class="section" id="defining-a-custom-encoding">
<h2>Defining a Custom Encoding<a class="headerlink" href="#defining-a-custom-encoding" title="Permalink to this headline">¶</a></h2>
<p>Since Python comes with a large number of standard codecs already, it
is unlikely that an application will need to define a custom encoder
or decoder.  When it is necessary, though, there are several base
classes in <code class="docutils literal notranslate"><span class="pre">codecs</span></code> to make the process easier.</p>
<p>The first step is to understand the nature of the transformation
described by the encoding.  These examples will use an “invertcaps”
encoding which converts uppercase letters to lowercase, and lowercase
letters to uppercase.  Here is a simple definition of an encoding
function that performs this transformation on an input string.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">codecs_invertcaps.py</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>


<span class="k">def</span> <span class="nf">invertcaps</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return new string with the case of all letters switched.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
        <span class="k">else</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span>
        <span class="k">else</span> <span class="n">c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">text</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">invertcaps</span><span class="p">(</span><span class="s1">&#39;ABCdef&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">invertcaps</span><span class="p">(</span><span class="s1">&#39;abcDEF&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>In this case, the encoder and decoder are the same function (as is
also the case with <code class="docutils literal notranslate"><span class="pre">ROT-13</span></code>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_invertcaps.py

abcDEF
ABCdef
</pre></div>
</div>
<p>Although it is easy to understand, this implementation is not
efficient, especially for very large text strings.  Fortunately,
<code class="docutils literal notranslate"><span class="pre">codecs</span></code> includes some helper functions for creating <em>character
map</em> based codecs such as invertcaps.  A character map encoding is
made up of two dictionaries.  The <em>encoding map</em> converts character
values from the input string to byte values in the output and the
<em>decoding map</em> goes the other way.  Create the decoding map first,
and then use <code class="docutils literal notranslate"><span class="pre">make_encoding_map()</span></code> to convert it to an encoding
map.  The C functions <code class="docutils literal notranslate"><span class="pre">charmap_encode()</span></code> and
<code class="docutils literal notranslate"><span class="pre">charmap_decode()</span></code> use the maps to convert their input data
efficiently.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">codecs_invertcaps_charmap.py</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="c1"># Map every character to itself</span>
<span class="n">decoding_map</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">make_identity_dict</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>

<span class="c1"># Make a list of pairs of ordinal values for the lower</span>
<span class="c1"># and uppercase letters</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">],</span>
    <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">],</span>
<span class="p">))</span>

<span class="c1"># Modify the mapping to convert upper to lower and</span>
<span class="c1"># lower to upper.</span>
<span class="n">decoding_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="n">upper</span><span class="p">:</span> <span class="n">lower</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
    <span class="ow">in</span> <span class="n">pairs</span>
<span class="p">})</span>
<span class="n">decoding_map</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="n">lower</span><span class="p">:</span> <span class="n">upper</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
    <span class="ow">in</span> <span class="n">pairs</span>
<span class="p">})</span>

<span class="c1"># Create a separate encoding map.</span>
<span class="n">encoding_map</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">make_encoding_map</span><span class="p">(</span><span class="n">decoding_map</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">(</span><span class="s1">&#39;abcDEF&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
                                <span class="n">encoding_map</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;abcDEF&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span>
                                <span class="n">decoding_map</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">encoding_map</span> <span class="o">==</span> <span class="n">decoding_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Although the encoding and decoding maps for invertcaps are the same,
that may not always be the case.  <code class="docutils literal notranslate"><span class="pre">make_encoding_map()</span></code> detects
situations where more than one input character is encoded to the same
output byte and replaces the encoding value with <code class="docutils literal notranslate"><span class="pre">None</span></code> to mark the
encoding as undefined.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_invertcaps_charmap.py

(b&#39;ABCdef&#39;, 6)
(&#39;ABCdef&#39;, 6)
True
</pre></div>
</div>
<p>The character map encoder and decoder support all of the standard
error handling methods described earlier, so no extra work is needed
to comply with that part of the API.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">codecs_invertcaps_error.py</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">codecs_invertcaps_charmap</span> <span class="k">import</span> <span class="n">encoding_map</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;pi: </span><span class="se">\u03c0</span><span class="s1">&#39;</span>

<span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">encoding_map</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:7}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">encoded</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Because the Unicode code point for π is not in the encoding map,
the strict error handling mode raises an exception.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_invertcaps_error.py

ignore : (b&#39;PI: &#39;, 5)
replace: (b&#39;PI: ?&#39;, 5)
strict : &#39;charmap&#39; codec can&#39;t encode character &#39;\u03c0&#39; in
position 4: character maps to &lt;undefined&gt;
</pre></div>
</div>
<p>After the encoding and decoding maps are defined, a few
additional classes need to be set up, and the encoding should be
registered.  <code class="docutils literal notranslate"><span class="pre">register()</span></code> adds a search function to the registry
so that when a user wants to use the encoding <code class="docutils literal notranslate"><span class="pre">codecs</span></code> can locate
it.  The search function must take a single string argument with the
name of the encoding, and return a <code class="docutils literal notranslate"><span class="pre">CodecInfo</span></code> object if it
knows the encoding, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if it does not.</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">codecs_register.py</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">encodings</span>


<span class="k">def</span> <span class="nf">search1</span><span class="p">(</span><span class="n">encoding</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;search1: Searching for:&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">search2</span><span class="p">(</span><span class="n">encoding</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;search2: Searching for:&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="n">codecs</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">search1</span><span class="p">)</span>
<span class="n">codecs</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">search2</span><span class="p">)</span>

<span class="n">utf8</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UTF-8:&#39;</span><span class="p">,</span> <span class="n">utf8</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">unknown</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;no-such-encoding&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">LookupError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Multiple search functions can be registered, and each will be called
in turn until one returns a <code class="docutils literal notranslate"><span class="pre">CodecInfo</span></code> or the list is
exhausted.  The internal search function registered by <code class="docutils literal notranslate"><span class="pre">codecs</span></code>
knows how to load the standard codecs such as UTF-8 from
<code class="xref py py-mod docutils literal notranslate"><span class="pre">encodings</span></code>, so those names will never be passed to custom search
functions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_register.py

UTF-8: &lt;codecs.CodecInfo object for encoding utf-8 at
0x1007773a8&gt;
search1: Searching for: no-such-encoding
search2: Searching for: no-such-encoding
ERROR: unknown encoding: no-such-encoding
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CodecInfo</span></code> instance returned by the search function tells
<code class="docutils literal notranslate"><span class="pre">codecs</span></code> how to encode and decode using all of the different
mechanisms supported: stateless, incremental, and stream.
<code class="docutils literal notranslate"><span class="pre">codecs</span></code> includes base classes to help with setting up a character
map encoding.  This example puts all of the pieces together to
register a search function that returns a <code class="docutils literal notranslate"><span class="pre">CodecInfo</span></code> instance
configured for the invertcaps codec.</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">codecs_invertcaps_register.py</span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span>

<span class="kn">from</span> <span class="nn">codecs_invertcaps_charmap</span> <span class="k">import</span> <span class="n">encoding_map</span><span class="p">,</span> <span class="n">decoding_map</span>


<span class="k">class</span> <span class="nc">InvertCapsCodec</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">Codec</span><span class="p">):</span>
    <span class="s2">&quot;Stateless encoder/decoder&quot;</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">encoding_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">decoding_map</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InvertCapsIncrementalEncoder</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">IncrementalEncoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">nbytes</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_encode</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
                                             <span class="n">encoding_map</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>


<span class="k">class</span> <span class="nc">InvertCapsIncrementalDecoder</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">IncrementalDecoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">nbytes</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">charmap_decode</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
                                             <span class="n">decoding_map</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>


<span class="k">class</span> <span class="nc">InvertCapsStreamReader</span><span class="p">(</span><span class="n">InvertCapsCodec</span><span class="p">,</span>
                             <span class="n">codecs</span><span class="o">.</span><span class="n">StreamReader</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">InvertCapsStreamWriter</span><span class="p">(</span><span class="n">InvertCapsCodec</span><span class="p">,</span>
                             <span class="n">codecs</span><span class="o">.</span><span class="n">StreamWriter</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">find_invertcaps</span><span class="p">(</span><span class="n">encoding</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the codec for &#39;invertcaps&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s1">&#39;invertcaps&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">CodecInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invertcaps&#39;</span><span class="p">,</span>
            <span class="n">encode</span><span class="o">=</span><span class="n">InvertCapsCodec</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">,</span>
            <span class="n">decode</span><span class="o">=</span><span class="n">InvertCapsCodec</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">,</span>
            <span class="n">incrementalencoder</span><span class="o">=</span><span class="n">InvertCapsIncrementalEncoder</span><span class="p">,</span>
            <span class="n">incrementaldecoder</span><span class="o">=</span><span class="n">InvertCapsIncrementalDecoder</span><span class="p">,</span>
            <span class="n">streamreader</span><span class="o">=</span><span class="n">InvertCapsStreamReader</span><span class="p">,</span>
            <span class="n">streamwriter</span><span class="o">=</span><span class="n">InvertCapsStreamWriter</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="n">codecs</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">find_invertcaps</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c1"># Stateless encoder/decoder</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getencoder</span><span class="p">(</span><span class="s1">&#39;invertcaps&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;abcDEF&#39;</span>
    <span class="n">encoded_text</span><span class="p">,</span> <span class="n">consumed</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Encoded &quot;</span><span class="si">{}</span><span class="s1">&quot; to &quot;</span><span class="si">{}</span><span class="s1">&quot;, consuming </span><span class="si">{}</span><span class="s1"> characters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">encoded_text</span><span class="p">,</span> <span class="n">consumed</span><span class="p">))</span>

    <span class="c1"># Stream writer</span>
    <span class="kn">import</span> <span class="nn">io</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s1">&#39;invertcaps&#39;</span><span class="p">)(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;StreamWriter for io buffer: &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  writing &quot;abcDEF&quot;&#39;</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;abcDEF&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  buffer contents: &#39;</span><span class="p">,</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="c1"># Incremental decoder</span>
    <span class="n">decoder_factory</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementaldecoder</span><span class="p">(</span><span class="s1">&#39;invertcaps&#39;</span><span class="p">)</span>
    <span class="n">decoder</span> <span class="o">=</span> <span class="n">decoder_factory</span><span class="p">()</span>
    <span class="n">decoded_text_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">encoded_text</span><span class="p">:</span>
        <span class="n">decoded_text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">]),</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">decoded_text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">decoded_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decoded_text_parts</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IncrementalDecoder converted </span><span class="si">{!r}</span><span class="s1"> to </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">encoded_text</span><span class="p">,</span> <span class="n">decoded_text</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The stateless encoder/decoder base class is <code class="docutils literal notranslate"><span class="pre">Codec</span></code>.  Override
<code class="docutils literal notranslate"><span class="pre">encode()</span></code> and <code class="docutils literal notranslate"><span class="pre">decode()</span></code> with the new implementation (in this
case, calling <code class="docutils literal notranslate"><span class="pre">charmap_encode()</span></code> and <code class="docutils literal notranslate"><span class="pre">charmap_decode()</span></code>
respectively).  Each method must return a tuple containing the
transformed data and the number of the input bytes or characters
consumed.  Conveniently, <code class="docutils literal notranslate"><span class="pre">charmap_encode()</span></code> and
<code class="docutils literal notranslate"><span class="pre">charmap_decode()</span></code> already return that information.</p>
<p><code class="docutils literal notranslate"><span class="pre">IncrementalEncoder</span></code> and <code class="docutils literal notranslate"><span class="pre">IncrementalDecoder</span></code> serve as
base classes for the incremental interfaces.  The <code class="docutils literal notranslate"><span class="pre">encode()</span></code> and
<code class="docutils literal notranslate"><span class="pre">decode()</span></code> methods of the incremental classes are defined in such
a way that they only return the actual transformed data.  Any
information about buffering is maintained as internal state.  The
invertcaps encoding does not need to buffer data (it uses a one-to-one
mapping).  For encodings that produce a different amount of output
depending on the data being processed, such as compression algorithms,
<code class="docutils literal notranslate"><span class="pre">BufferedIncrementalEncoder</span></code> and
<code class="docutils literal notranslate"><span class="pre">BufferedIncrementalDecoder</span></code> are more appropriate base classes,
since they manage the unprocessed portion of the input.</p>
<p><code class="docutils literal notranslate"><span class="pre">StreamReader</span></code> and <code class="docutils literal notranslate"><span class="pre">StreamWriter</span></code> need <code class="docutils literal notranslate"><span class="pre">encode()</span></code>
and <code class="docutils literal notranslate"><span class="pre">decode()</span></code> methods, too, and since they are expected to return
the same value as the version from <code class="docutils literal notranslate"><span class="pre">Codec</span></code> multiple
inheritance can be used for the implementation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 codecs_invertcaps_register.py

Encoded &quot;abcDEF&quot; to &quot;b&#39;ABCdef&#39;&quot;, consuming 6 characters
StreamWriter for io buffer:
  writing &quot;abcDEF&quot;
  buffer contents:  b&#39;ABCdef&#39;
IncrementalDecoder converted b&#39;ABCdef&#39; to &#39;abcDEF&#39;
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/codecs.html">Standard library documentation for codecs</a></li>
<li><a class="reference internal" href="../locale/index.html#module-locale" title="locale: POSIX cultural localization API"><code class="xref py py-mod docutils literal notranslate"><span class="pre">locale</span></code></a> – Accessing and managing the localization-based
configuration settings and behaviors.</li>
<li><a class="reference internal" href="../io/index.html#module-io" title="io: Implements file I/O and provides classes for working with buffers using file-like API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">io</span></code></a> – The <code class="docutils literal notranslate"><span class="pre">io</span></code> module includes file and stream wrappers
that handle encoding and decoding, too.</li>
<li><a class="reference internal" href="../socketserver/index.html#module-socketserver" title="socketserver: Creating network servers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">socketserver</span></code></a> – For a more detailed example of an echo
server, see the <code class="docutils literal notranslate"><span class="pre">socketserver</span></code> module.</li>
<li><code class="xref py py-mod docutils literal notranslate"><span class="pre">encodings</span></code> – Package in the standard library containing
the encoder/decoder implementations provided by Python.</li>
<li><span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0100"><strong>PEP 100</strong></a> – Python Unicode Integration PEP.</li>
<li><a class="reference external" href="https://docs.python.org/3/howto/unicode.html">Unicode HOWTO</a> – The official guide for using Unicode with Python.</li>
<li><a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit">Text vs. Data Instead of Unicode vs. 8-bit</a>
– Section of the “What’s New” article for Python 3.0 covering
the text handling changes.</li>
<li><a class="reference external" href="http://effbot.org/zone/unicode-objects.htm">Python Unicode Objects</a> – Fredrik Lundh’s
article about using non-ASCII character sets in Python 2.0.</li>
<li><a class="reference external" href="http://evanjones.ca/python-utf8.html">How to Use UTF-8 with Python</a> – Evan Jones’ quick
guide to working with Unicode, including XML data and the
Byte-Order Marker.</li>
<li><a class="reference external" href="http://www.tbray.org/ongoing/When/200x/2003/04/06/Unicode">On the Goodness of Unicode</a> –
Introduction to internationalization and Unicode by Tim Bray.</li>
<li><a class="reference external" href="http://www.tbray.org/ongoing/When/200x/2003/04/13/Strings">On Character Strings</a> –
A look at the history of string processing in programming
languages, by Tim Bray.</li>
<li><a class="reference external" href="http://www.tbray.org/ongoing/When/200x/2003/04/26/UTF">Characters vs. Bytes</a> –
Part one of Tim Bray’s “essay on modern character string
processing for computer programmers.”  This installment covers
in-memory representation of text in formats other than ASCII
bytes.</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Endianness">Endianness</a> –
Explanation of endianness in Wikipedia.</li>
<li><a class="reference external" href="http://www.w3.org/TR/xml-entity-names/">W3C XML Entity Definitions for Characters</a> – Specification for
XML representations of character references that cannot be
represented in an encoding.</li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../mmap/index.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> mmap — Memory-map Files</a>
<a id="next-link" href="../io/index.html"
   title="next chapter">io — Text, Binary, and Raw Stream I/O Tools <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#unicode-primer"><i class="fa fa-caret-right"></i>Unicode Primer</a></li>
    
    <li><a href="#encodings"><i class="fa fa-caret-right"></i>Encodings</a></li>
    
    <li><a href="#working-with-files"><i class="fa fa-caret-right"></i>Working with Files</a></li>
    
    <li><a href="#byte-order"><i class="fa fa-caret-right"></i>Byte Order</a></li>
    
    <li><a href="#error-handling"><i class="fa fa-caret-right"></i>Error Handling</a></li>
    
    <li><a href="#encoding-errors"><i class="fa fa-caret-right"></i>Encoding Errors</a></li>
    
    <li><a href="#decoding-errors"><i class="fa fa-caret-right"></i>Decoding Errors</a></li>
    
    <li><a href="#encoding-translation"><i class="fa fa-caret-right"></i>Encoding Translation</a></li>
    
    <li><a href="#non-unicode-encodings"><i class="fa fa-caret-right"></i>Non-Unicode Encodings</a></li>
    
    <li><a href="#incremental-encoding"><i class="fa fa-caret-right"></i>Incremental Encoding</a></li>
    
    <li><a href="#unicode-data-and-network-communication"><i class="fa fa-caret-right"></i>Unicode Data and Network Communication</a></li>
    
    <li><a href="#defining-a-custom-encoding"><i class="fa fa-caret-right"></i>Defining a Custom Encoding</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2016-12-28.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../mmap/index.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>mmap — Memory-map Files</a></li>
    <li><a href="../io/index.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>io — Text, Binary, and Raw Stream I/O Tools</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="https://feeds.feedburner.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAf5QTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gJCQkKCUmKCgoKCkoKSkpKSopKicnKioqLS0tMDAwMS0uMjExMjMxNTY1Pj8+Pzc5Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgY19haGVmbmxscHBwcHJvdXJzdnN0eHV2eXx5en15fH98fX98fnt8f4F+gICAgoWChIGChIWEhIaEh4aHiYyJjIqLjoeLj4+PkY+PkZORkZSRk5iTlZmUlpmWmJaXmpiZnp2dnqCdn5aan5+fn6Oeoqaho6Gho6ijpqqmq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbewsrexsrixs7iytLmztLqztbW1tbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIycjIyc3Iyc3Jys3Jy8rLy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4N/g4+Pj6Ofn7+/v8fHx////rrSdFQAAAAN0Uk5TAAoO5yEBUwAAA+FJREFUSMe1lo9301QUx6uXUmaf0qJ26iTrRoVinUzjQNR1gAyH6Lqx6XTDoVvXbU7qhA5m7CgYWaTDlLa6AiFsba3t+y+9Sdr8OvVMi7zTnLTf5H7ee9/73n11PA1PpDkcADPRWPwKt8YLG2I2n89m7gh8iluJz0dnpqe+HBsdHRn+7w3JyF1cvpbk05mCJG8Xi9uPpMLdNJ9cXV5UyBNjoyMtkR2A3B9Tt8SCfLTTqUzC2XlMvpcRbnA/IPmryYnzoyM9XuWBt8eI21FBcAy5Qk4KtxkGtQ1I+fRNbnk+evHC5NhJDwATDDIAnhNa1ImdFQTHr6WEvNyFPFeATSTYgAu/dl3/I31jNR6bnZ76eDf4yxRb2Q+71aiz/0JB8JXkrZzCdbFVqrUhRHuu54XkytLczAUvBFADUB6ARwnyqEp/t02prK9XdAXBHC9KyPWVqd6qPhyzlOG55dhsL/hLDTD1A3rYAy+dRu6eXaGKruA75wi2hbqigNd+LYSRW6XUSh64l05dXYruA1OPZfAOD3vhObL/ILDvQkRXynSdvPpaiJB+TVHAfEZuA9d9amlVF7TJd3nu+xgwyu8AqNOnDGAM8/obOLhQpWQotPYReZ/SQdKuKQpY2DwKwFJbGwI4VhCSlxchSFUnNC+CCgaV9RAKoZKh1J4le9FmQv5SFQW88aATXGhEws8wrHb7AANc0CndQS+ag5ERaieke0FXvnkxoYL/1MGi7FSmmVBXMDOu3gLK5J2PMjdXv2tmBX6pDdKSkq39DWXh3G1KI4QYVmS3AHCIPnCXE+4hHy6PcfeQ6sV2lufiL2jJ0wasp4p2k/Z2CEXeeqahDBLS1/c8+dBIXq4IkFAiWQ1QtxtnUMz/wsXfBj+1LzdUKn17dvXXzEqfMoFDNWO57QCe22dskKB5g7zXbVN+i0RKumKxonrfzaIVys2wYu7TVrd0PXn1rOnJC4JTFjF5c19/gnXLFwj6jJJz1rOjoi63LnBRfbmNM+qNunG5baSufhu9OPX5my2VTWEzrHrRbIP8dHl+dnpyrIVDBME/q1u6/E9bGmt9i2AsQmeaFaFwIb22soSlfuL8SEtgOCJKB5BsKkNltWyK7zzWMY3X4exDc6GvsljoX5FzR+BxwdCbf3jAdjTJv5/S39H2B2iXpmgXpWB7iVrB0JuVzpgP07CUO2WKqX+oiVL/benKImhgOIzHf7hx/A/IBdHsQ6Nsmruilo4afVFqB8PLn2U2H8hbxeKWjH9YvuiwxNiMaNhALZptCg5d7zh+Sczmclnx0vEOax6ajdjucSMPTcD/97/Cp54Q929ZZbgcR3o0hAAAAABJRU5ErkJggg=="/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/books/the-python-3-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>